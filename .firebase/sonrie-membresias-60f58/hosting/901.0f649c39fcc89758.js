"use strict";(self.webpackChunksonrie_membresias=self.webpackChunksonrie_membresias||[]).push([[901],{9901:(rA,Hl,U)=>{U.r(Hl),U.d(Hl,{MainModule:()=>tA});var V,sr=U(6814),Vi=U(9692),h=U(5879),_=U(5861),dp=U(8645),Ci=U(534),Zl=U(4537),je=U(7879),G=U(9058),fp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qe={},co=co||{},b=fp||self;function Si(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function or(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var ho="closure_uid_"+(1e9*Math.random()>>>0),gp=0;function pp(n,e,t){return n.call.apply(n.bind,arguments)}function _p(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Ee(n,e,t){return(Ee=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?pp:_p).apply(null,arguments)}function Ri(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ce(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function mt(){this.s=this.s,this.o=this.o}mt.prototype.s=!1,mt.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function mp(n){Object.prototype.hasOwnProperty.call(n,ho)&&n[ho]||(n[ho]=++gp)}(this)},mt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Yl=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function fo(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Jl(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Si(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Ie(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ie.prototype.h=function(){this.defaultPrevented=!0};var vp=function(){if(!b.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};b.addEventListener("test",t,e),b.removeEventListener("test",t,e)}catch{}return n}();function ar(n){return/^[\s\xa0]*$/.test(n)}function Pi(){var n=b.navigator;return n&&(n=n.userAgent)?n:""}function $e(n){return-1!=Pi().indexOf(n)}function mo(n){return mo[" "](n),n}mo[" "]=function(){};var po,n,Ip=$e("Opera"),fn=$e("Trident")||$e("MSIE"),Xl=$e("Edge"),go=Xl||fn,ec=$e("Gecko")&&!(-1!=Pi().toLowerCase().indexOf("webkit")&&!$e("Edge"))&&!($e("Trident")||$e("MSIE"))&&!$e("Edge"),Tp=-1!=Pi().toLowerCase().indexOf("webkit")&&!$e("Edge");function tc(){var n=b.document;return n?n.documentMode:void 0}e:{var _o="",yo=(n=Pi(),ec?/rv:([^\);]+)(\)|;)/.exec(n):Xl?/Edge\/([\d\.]+)/.exec(n):fn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):Tp?/WebKit\/(\S+)/.exec(n):Ip?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(yo&&(_o=yo?yo[1]:""),fn){var vo=tc();if(null!=vo&&vo>parseFloat(_o)){po=String(vo);break e}}po=_o}var Ap=b.document&&fn&&(tc()||parseInt(po,10))||void 0;function ur(n,e){if(Ie.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(ec){e:{try{mo(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:wp[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&ur.$.h.call(this)}}ce(ur,Ie);var wp={2:"touch",3:"pen",4:"mouse"};ur.prototype.h=function(){ur.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var lr="closure_listenable_"+(1e6*Math.random()|0),Vp=0;function Cp(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++Vp,this.fa=this.ia=!1}function Di(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Io(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function rc(n){const e={};for(const t in n)e[t]=n[t];return e}const ic="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function sc(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<ic.length;s++)t=ic[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function xi(n){this.src=n,this.g={},this.h=0}function To(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Yl(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Di(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Ao(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}xi.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var o=Ao(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new Cp(e,this.src,s,!!r,i)).ia=t,n.push(e)),e};var wo="closure_lm_"+(1e6*Math.random()|0),Vo={};function oc(n,e,t,r,i){if(r&&r.once)return uc(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)oc(n,e[s],t,r,i);return null}return t=Po(t),n&&n[lr]?n.O(e,t,or(r)?!!r.capture:!!r,i):ac(n,e,t,!1,r,i)}function ac(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=or(i)?!!i.capture:!!i,a=So(n);if(a||(n[wo]=a=new xi(n)),(t=a.add(e,t,r,o,s)).proxy)return t;if(r=function Rp(){const e=Pp;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)vp||(i=o),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(cc(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function uc(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)uc(n,e[s],t,r,i);return null}return t=Po(t),n&&n[lr]?n.P(e,t,or(r)?!!r.capture:!!r,i):ac(n,e,t,!0,r,i)}function lc(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)lc(n,e[s],t,r,i);else r=or(r)?!!r.capture:!!r,t=Po(t),n&&n[lr]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Ao(s=n.g[e],t,r,i))&&(Di(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=So(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Ao(e,t,r,i)),(t=-1<n?e[n]:null)&&Co(t))}function Co(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[lr])To(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(cc(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=So(e))?(To(t,n),0==t.h&&(t.src=null,e[wo]=null)):Di(n)}}}function cc(n){return n in Vo?Vo[n]:Vo[n]="on"+n}function Pp(n,e){if(n.fa)n=!0;else{e=new ur(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Co(n),n=t.call(r,e)}return n}function So(n){return(n=n[wo])instanceof xi?n:null}var Ro="__closure_events_fn_"+(1e9*Math.random()>>>0);function Po(n){return"function"==typeof n?n:(n[Ro]||(n[Ro]=function(e){return n.handleEvent(e)}),n[Ro])}function he(){mt.call(this),this.i=new xi(this),this.S=this,this.J=null}function ge(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new Ie(e,n);else if(e instanceof Ie)e.target=e.target||n;else{var i=e;sc(e=new Ie(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=bi(o,r,!0,e)&&i}if(i=bi(o=e.g=n,r,!0,e)&&i,i=bi(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=bi(o=e.g=t[s],r,!1,e)&&i}function bi(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&To(n.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}ce(he,mt),he.prototype[lr]=!0,he.prototype.removeEventListener=function(n,e,t,r){lc(this,n,e,t,r)},he.prototype.N=function(){if(he.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Di(t[r]);delete n.g[e],n.h--}}this.J=null},he.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},he.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Do=b.JSON.stringify;function xp(){var n=xo;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var hc=new class Dp{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Np,n=>n.reset());class Np{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Mp(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function Fp(n){b.setTimeout(()=>{throw n},0)}let cr,hr=!1,xo=new class bp{constructor(){this.h=this.g=null}add(e,t){const r=hc.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},dc=()=>{const n=b.Promise.resolve(void 0);cr=()=>{n.then(kp)}};var kp=()=>{for(var n;n=xp();){try{n.h.call(n.g)}catch(t){Fp(t)}var e=hc;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}hr=!1};function Ni(n,e){he.call(this),this.h=n||1,this.g=e||b,this.j=Ee(this.qb,this),this.l=Date.now()}function bo(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function No(n,e,t){if("function"==typeof n)t&&(n=Ee(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=Ee(n.handleEvent,n)}return 2147483647<Number(e)?-1:b.setTimeout(n,e||0)}function fc(n){n.g=No(()=>{n.g=null,n.i&&(n.i=!1,fc(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}ce(Ni,he),(V=Ni.prototype).ga=!1,V.T=null,V.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ge(this,"tick"),this.ga&&(bo(this),this.start()))}},V.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},V.N=function(){Ni.$.N.call(this),bo(this),delete this.g};class Op extends mt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:fc(this)}N(){super.N(),this.g&&(b.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function dr(n){mt.call(this),this.h=n,this.g={}}ce(dr,mt);var mc=[];function gc(n,e,t,r){Array.isArray(t)||(t&&(mc[0]=t.toString()),t=mc);for(var i=0;i<t.length;i++){var s=oc(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function pc(n){Io(n.g,function(e,t){this.g.hasOwnProperty(t)&&Co(e)},n),n.g={}}function Mi(){this.g=!0}function mn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function qp(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Do(t)}catch{return e}}(n,t)+(r?" "+r:"")})}dr.prototype.N=function(){dr.$.N.call(this),pc(this)},dr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Mi.prototype.Ea=function(){this.g=!1},Mi.prototype.info=function(){};var Bt={},_c=null;function Fi(){return _c=_c||new he}function yc(n){Ie.call(this,Bt.Ta,n)}function fr(n){const e=Fi();ge(e,new yc(e))}function vc(n,e){Ie.call(this,Bt.STAT_EVENT,n),this.stat=e}function Ce(n){const e=Fi();ge(e,new vc(e,n))}function Ec(n,e){Ie.call(this,Bt.Ua,n),this.size=e}function mr(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return b.setTimeout(function(){n()},e)}Bt.Ta="serverreachability",ce(yc,Ie),Bt.STAT_EVENT="statevent",ce(vc,Ie),Bt.Ua="timingevent",ce(Ec,Ie);var ki={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Ic={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Mo(){}function Ac(){}Mo.prototype.h=null;var Oo,gr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Fo(){Ie.call(this,"d")}function ko(){Ie.call(this,"c")}function Oi(){}function pr(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new dr(this),this.P=Gp,this.V=new Ni(n=go?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new wc}function wc(){this.i=null,this.g="",this.h=!1}ce(Fo,Ie),ce(ko,Ie),ce(Oi,Mo),Oi.prototype.g=function(){return new XMLHttpRequest},Oi.prototype.i=function(){return{}},Oo=new Oi;var Gp=45e3,Vc={},Lo={};function Bo(n,e,t){n.L=1,n.A=qi(nt(e)),n.u=t,n.S=!0,Cc(n,null)}function Cc(n,e){n.G=Date.now(),_r(n),n.B=nt(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),kc(t.i,"t",r),n.o=0,t=n.l.J,n.h=new wc,n.g=oh(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Op(Ee(n.Pa,n,n.g),n.O)),gc(n.U,n.g,"readystatechange",n.nb),e=n.I?rc(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),fr(),function Lp(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var l=a[u].split("=");if(1<l.length){var c=l[0];l=l[1];var d=c.split("_");o=2<=d.length&&"type"==d[1]?o+(c+"=")+l+"&":o+(c+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.v,n.B,n.m,n.W,n.u)}function Sc(n){return!!n.g&&"GET"==n.v&&2!=n.L&&n.l.Ha}function Rc(n,e,t){let i,r=!0;for(;!n.J&&n.o<t.length;){if(i=zp(n,t),i==Lo){4==e&&(n.s=4,Ce(14),r=!1),mn(n.j,n.m,null,"[Incomplete Response]");break}if(i==Vc){n.s=4,Ce(15),mn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}mn(n.j,n.m,i,null),Uo(n,i)}Sc(n)&&0!=n.o&&(n.h.g=n.h.g.slice(n.o),n.o=0),4!=e||0!=t.length||n.h.h||(n.s=1,Ce(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Qo(e),e.M=!0,Ce(11))):(mn(n.j,n.m,t,"[Invalid Chunked Response]"),Ut(n),yr(n))}function zp(n,e){var t=n.o,r=e.indexOf("\n",t);return-1==r?Lo:(t=Number(e.substring(t,r)),isNaN(t)?Vc:(r+=1)+t>e.length?Lo:(e=e.slice(r,r+t),n.o=r+t,e))}function _r(n){n.Y=Date.now()+n.P,Pc(n,n.P)}function Pc(n,e){if(null!=n.C)throw Error("WatchDog timer not null");n.C=mr(Ee(n.lb,n),e)}function Li(n){n.C&&(b.clearTimeout(n.C),n.C=null)}function yr(n){0==n.l.H||n.J||nh(n.l,n)}function Ut(n){Li(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,bo(n.V),pc(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Uo(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||qo(t.i,n)))if(!n.K&&qo(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;Qi(t),$i(t)}Ko(t),Ce(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&0==t.A&&!t.v&&(t.v=mr(Ee(t.ib,t),6e3));if(1>=Bc(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Gt(t,11)}else if((n.K||t.g==n)&&Qi(t),!ar(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let l=i[e];if(t.V=l[0],l=l[1],2==t.H)if("c"==l[0]){t.K=l[1],t.pa=l[2];const c=l[3];null!=c&&(t.ra=c,t.l.info("VER="+t.ra));const d=l[4];null!=d&&(t.Ga=d,t.l.info("SVER="+t.Ga));const f=l[5];null!=f&&"number"==typeof f&&0<f&&(t.L=r=1.5*f,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const g=n.g;if(g){const E=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(E){var s=r.i;s.g||-1==E.indexOf("spdy")&&-1==E.indexOf("quic")&&-1==E.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Go(s,s.h),s.h=null))}if(r.F){const T=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null;T&&(r.Da=T,H(r.I,r.F,T))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=sh(r,r.J?r.pa:null,r.Y),o.K){Uc(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(Li(a),_r(a)),r.g=o}else eh(r);0<t.j.length&&Ki(t)}else"stop"!=l[0]&&"close"!=l[0]||Gt(t,7);else 3==t.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?Gt(t,7):$o(t):"noop"!=l[0]&&t.h&&t.h.Aa(l),t.A=0)}fr()}catch{}}function Dc(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Si(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function $p(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Si(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function jp(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(Si(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(V=pr.prototype).setTimeout=function(n){this.P=n},V.nb=function(n){n=n.target;const e=this.M;e&&3==Ke(n)?e.l():this.Pa(n)},V.Pa=function(n){try{if(n==this.g)e:{const c=Ke(this.g);var e=this.g.Ia();if(this.g.da(),!(3>c)&&(3!=c||go||this.g&&(this.h.h||this.g.ja()||Wc(this.g)))){this.J||4!=c||7==e||fr(),Li(this);var t=this.g.da();this.ca=t;t:if(Sc(this)){var r=Wc(this.g);n="";var i=r.length,s=4==Ke(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Ut(this),yr(this);var o="";break t}this.h.i=new b.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function Bp(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+o})}(this.j,this.v,this.B,this.m,this.W,c,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ar(a)){var l=a;break t}}l=null}if(!(t=l)){this.i=!1,this.s=3,Ce(12),Ut(this),yr(this);break e}mn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Uo(this,t)}this.S?(Rc(this,c,o),go&&this.i&&3==c&&(gc(this.U,this.V,"tick",this.mb),this.V.start())):(mn(this.j,this.m,o,null),Uo(this,o)),4==c&&Ut(this),this.i&&!this.J&&(4==c?nh(this.l,this):(this.i=!1,_r(this)))}else(function l_(n){const e={};n=(n.g&&2<=Ke(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(ar(n[r]))continue;var t=Mp(n[r]);const i=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}!function Sp(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.s=3,Ce(12)):(this.s=0,Ce(13)),Ut(this),yr(this)}}}catch{}},V.mb=function(){if(this.g){var n=Ke(this.g),e=this.g.ja();this.o<e.length&&(Li(this),Rc(this,n,e),this.i&&4!=n&&_r(this))}},V.cancel=function(){this.J=!0,Ut(this)},V.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(function Up(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.B),2!=this.L&&(fr(),Ce(17)),Ut(this),this.s=2,yr(this)):Pc(this,this.Y-n)};var xc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qt(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof qt){this.h=n.h,Bi(this,n.j),this.s=n.s,this.g=n.g,Ui(this,n.m),this.l=n.l;var e=n.i,t=new Ir;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),bc(this,t),this.o=n.o}else n&&(e=String(n).match(xc))?(this.h=!1,Bi(this,e[1]||"",!0),this.s=vr(e[2]||""),this.g=vr(e[3]||"",!0),Ui(this,e[4]),this.l=vr(e[5]||"",!0),bc(this,e[6]||"",!0),this.o=vr(e[7]||"")):(this.h=!1,this.i=new Ir(null,this.h))}function nt(n){return new qt(n)}function Bi(n,e,t){n.j=t?vr(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Ui(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function bc(n,e,t){e instanceof Ir?(n.i=e,function Jp(n,e){e&&!n.j&&(gt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Mc(this,r),kc(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Er(e,Zp)),n.i=new Ir(e,n.h))}function H(n,e,t){n.i.set(e,t)}function qi(n){return H(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function vr(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Er(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Qp),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Qp(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}qt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Er(e,Nc,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Er(e,Nc,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Er(t,"/"==t.charAt(0)?Hp:Wp,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Er(t,Yp)),n.join("")};var Nc=/[#\/\?@]/g,Wp=/[#\?:]/g,Hp=/[#\?]/g,Zp=/[#\?@]/g,Yp=/#/g;function Ir(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function gt(n){n.g||(n.g=new Map,n.h=0,n.i&&function Kp(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Mc(n,e){gt(n),e=gn(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Fc(n,e){return gt(n),e=gn(n,e),n.g.has(e)}function kc(n,e,t){Mc(n,e),0<t.length&&(n.i=null,n.g.set(gn(n,e),fo(t)),n.h+=t.length)}function gn(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Oc(n){this.l=n||e_,n=b.PerformanceNavigationTiming?0<(n=b.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(b.g&&b.g.Ka&&b.g.Ka()&&b.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(V=Ir.prototype).add=function(n,e){gt(this),this.i=null,n=gn(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},V.forEach=function(n,e){gt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},V.ta=function(){gt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},V.Z=function(n){gt(this);let e=[];if("string"==typeof n)Fc(this,n)&&(e=e.concat(this.g.get(gn(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},V.set=function(n,e){return gt(this),this.i=null,Fc(this,n=gn(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},V.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},V.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};var e_=10;function Lc(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Bc(n){return n.h?1:n.g?n.g.size:0}function qo(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Go(n,e){n.g?n.g.add(e):n.h=e}function Uc(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function qc(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return fo(n.i)}Oc.prototype.cancel=function(){if(this.i=qc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var t_=class{stringify(n){return b.JSON.stringify(n,void 0)}parse(n){return b.JSON.parse(n,void 0)}};function n_(){this.g=new t_}function r_(n,e,t){const r=t||"";try{Dc(n,function(i,s){let o=i;or(i)&&(o=Do(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Gi(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Tr(n){this.l=n.ec||null,this.j=n.ob||!1}function zi(n,e){he.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=zo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ce(Tr,Mo),Tr.prototype.g=function(){return new zi(this.l,this.j)},Tr.prototype.i=function(n){return function(){return n}}({}),ce(zi,he);var zo=0;function Gc(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function Ar(n){n.readyState=4,n.l=null,n.j=null,n.A=null,wr(n)}function wr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(V=zi.prototype).open=function(n,e){if(this.readyState!=zo)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,wr(this)},V.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||b).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},V.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ar(this)),this.readyState=zo},V.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,wr(this)),this.g&&(this.readyState=3,wr(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof b.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Gc(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},V.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Ar(this):wr(this),3==this.readyState&&Gc(this)}},V.Za=function(n){this.g&&(this.response=this.responseText=n,Ar(this))},V.Ya=function(n){this.g&&(this.response=n,Ar(this))},V.ka=function(){this.g&&Ar(this)},V.setRequestHeader=function(n,e){this.v.append(n,e)},V.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},V.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(zi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var s_=b.JSON.parse;function te(n){he.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=zc,this.L=this.M=!1}ce(te,he);var zc="",o_=/^https?$/i,a_=["POST","PUT"];function jc(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,$c(n),ji(n)}function $c(n){n.F||(n.F=!0,ge(n,"complete"),ge(n,"error"))}function Kc(n){if(n.h&&typeof co<"u"&&(!n.C[1]||4!=Ke(n)||2!=n.da()))if(n.v&&4==Ke(n))No(n.La,0,n);else if(ge(n,"readystatechange"),4==Ke(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var i=String(n.I).match(xc)[1]||null;!i&&b.self&&b.self.location&&(i=b.self.location.protocol.slice(0,-1)),r=!o_.test(i?i.toLowerCase():"")}t=r}if(t)ge(n,"complete"),ge(n,"success");else{n.m=6;try{var s=2<Ke(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",$c(n)}}finally{ji(n)}}}function ji(n,e){if(n.g){Qc(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||ge(n,"ready");try{t.onreadystatechange=r}catch{}}}function Qc(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(b.clearTimeout(n.A),n.A=null)}function Ke(n){return n.g?n.g.readyState:0}function Wc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case zc:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Hc(n){let e="";return Io(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function jo(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Hc(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):H(n,e,t))}function Vr(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Zc(n){this.Ga=0,this.j=[],this.l=new Mi,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Vr("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Vr("baseRetryDelayMs",5e3,n),this.hb=Vr("retryDelaySeedMs",1e4,n),this.eb=Vr("forwardChannelMaxRetries",2,n),this.xa=Vr("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Oc(n&&n.concurrentRequestLimit),this.Ja=new n_,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function $o(n){if(Yc(n),3==n.H){var e=n.W++,t=nt(n.I);if(H(t,"SID",n.K),H(t,"RID",e),H(t,"TYPE","terminate"),Cr(n,t),(e=new pr(n,n.l,e)).L=2,e.A=qi(nt(t)),t=!1,b.navigator&&b.navigator.sendBeacon)try{t=b.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&b.Image&&((new Image).src=e.A,t=!0),t||(e.g=oh(e.l,null),e.g.ha(e.A)),e.G=Date.now(),_r(e)}ih(n)}function $i(n){n.g&&(Qo(n),n.g.cancel(),n.g=null)}function Yc(n){$i(n),n.u&&(b.clearTimeout(n.u),n.u=null),Qi(n),n.i.cancel(),n.m&&("number"==typeof n.m&&b.clearTimeout(n.m),n.m=null)}function Ki(n){if(!Lc(n.i)&&!n.m){n.m=!0;var e=n.Na;cr||dc(),hr||(cr(),hr=!0),xo.add(e,n),n.C=0}}function Jc(n,e){var t;t=e?e.m:n.W++;const r=nt(n.I);H(r,"SID",n.K),H(r,"RID",t),H(r,"AID",n.V),Cr(n,r),n.o&&n.s&&jo(r,n.o,n.s),t=new pr(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Xc(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Go(n.i,t),Bo(t,r,e)}function Cr(n,e){n.na&&Io(n.na,function(t,r){H(e,r,t)}),n.h&&Dc({},function(t,r){H(e,r,t)})}function Xc(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Ee(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];-1==s?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let l=i[u].g;const c=i[u].map;if(l-=s,0>l)s=Math.max(0,i[u].g-100),a=!1;else try{r_(c,o,"req"+l+"_")}catch{r&&r(c)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function eh(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;cr||dc(),hr||(cr(),hr=!0),xo.add(e,n),n.A=0}}function Ko(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=mr(Ee(n.Ma,n),rh(n,n.A)),n.A++,0))}function Qo(n){null!=n.B&&(b.clearTimeout(n.B),n.B=null)}function th(n){n.g=new pr(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=nt(n.wa);H(e,"RID","rpc"),H(e,"SID",n.K),H(e,"AID",n.V),H(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&H(e,"TO",n.qa),H(e,"TYPE","xmlhttp"),Cr(n,e),n.o&&n.s&&jo(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=qi(nt(e)),t.u=null,t.S=!0,Cc(t,n)}function Qi(n){null!=n.v&&(b.clearTimeout(n.v),n.v=null)}function nh(n,e){var t=null;if(n.g==e){Qi(n),Qo(n),n.g=null;var r=2}else{if(!qo(n.i,e))return;t=e.F,Uc(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;ge(r=Fi(),new Ec(r,t)),Ki(n)}else eh(n);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function c_(n,e){return!(Bc(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=mr(Ee(n.Na,n,e),rh(n,n.C)),n.C++,0)))}(n,e)||2==r&&Ko(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Gt(n,5);break;case 4:Gt(n,10);break;case 3:Gt(n,6);break;default:Gt(n,2)}}function rh(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Gt(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=Ee(n.pb,n);t||(t=new qt("//www.google.com/images/cleardot.gif"),b.location&&"http"==b.location.protocol||Bi(t,"https"),qi(t)),function i_(n,e){const t=new Mi;if(b.Image){const r=new Image;r.onload=Ri(Gi,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ri(Gi,t,r,"TestLoadImage: error",!1,e),r.onabort=Ri(Gi,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ri(Gi,t,r,"TestLoadImage: timeout",!1,e),b.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Ce(2);n.H=0,n.h&&n.h.za(e),ih(n),Yc(n)}function ih(n){if(n.H=0,n.ma=[],n.h){const e=qc(n.i);(0!=e.length||0!=n.j.length)&&(Jl(n.ma,e),Jl(n.ma,n.j),n.i.i.length=0,fo(n.j),n.j.length=0),n.h.ya()}}function sh(n,e,t){var r=t instanceof qt?nt(t):new qt(t);if(""!=r.g)e&&(r.g=e+"."+r.g),Ui(r,r.m);else{var i=b.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new qt(null);r&&Bi(s,r),e&&(s.g=e),i&&Ui(s,i),t&&(s.l=t),r=s}return e=n.Da,(t=n.F)&&e&&H(r,t,e),H(r,"VER",n.ra),Cr(n,r),r}function oh(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new te(n.Ha&&!n.va?new Tr({ob:t}):n.va)).Oa(n.J),e}function ah(){}function Wi(){if(fn&&!(10<=Number(Ap)))throw Error("Environmental error: no available transport.")}function Me(n,e){he.call(this),this.g=new Zc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!ar(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!ar(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new pn(this)}function uh(n){Fo.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function lh(){ko.call(this),this.status=1}function pn(n){this.g=n}function Ge(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Wo(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var s=n.g[3],o=(e=n.g[0])+(s^(t=n.g[1])&((i=n.g[2])^s))+r[0]+3614090360&4294967295;o=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=(t=(i=(s=(e=t+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^t&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(t^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(t^s&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(t^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(t^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(t^i&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^t&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^t^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(t|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(t|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=t+((o=e+(i^(t|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(t^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}function j(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=0|n[i];r&&s==e||(t[i]=s,r=!1)}this.g=t}(V=te.prototype).Oa=function(n){this.M=n},V.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Oo.g(),this.C=function Tc(n){return n.h||(n.h=n.i())}(this.u?this.u:Oo),this.g.onreadystatechange=Ee(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){return void jc(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=b.FormData&&n instanceof b.FormData,!(0<=Yl(a_,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Qc(this),0<this.B&&((this.L=function u_(n){return fn&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ee(this.ua,this)):this.A=No(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){jc(this,s)}},V.ua=function(){typeof co<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ge(this,"timeout"),this.abort(8))},V.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ge(this,"complete"),ge(this,"abort"),ji(this))},V.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ji(this,!0)),te.$.N.call(this)},V.La=function(){this.s||(this.G||this.v||this.l?Kc(this):this.kb())},V.kb=function(){Kc(this)},V.isActive=function(){return!!this.g},V.da=function(){try{return 2<Ke(this)?this.g.status:-1}catch{return-1}},V.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},V.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),s_(e)}},V.Ia=function(){return this.m},V.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(V=Zc.prototype).ra=8,V.H=1,V.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new pr(this,this.l,n);let s=this.s;if(this.U&&(s?(s=rc(s),sc(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Xc(this,i,e),H(t=nt(this.I),"RID",n),H(t,"CVER",22),this.F&&H(t,"X-HTTP-Session-Id",this.F),Cr(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Hc(s)))+"&"+e:this.o&&jo(t,this.o,s)),Go(this.i,i),this.bb&&H(t,"TYPE","init"),this.P?(H(t,"$req",e),H(t,"SID","null"),i.aa=!0,Bo(i,t,null)):Bo(i,t,e),this.H=2}}else 3==this.H&&(n?Jc(this,n):0==this.j.length||Lc(this.i)||Jc(this))},V.Ma=function(){if(this.u=null,th(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=mr(Ee(this.jb,this),n)}},V.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ce(10),$i(this),th(this))},V.ib=function(){null!=this.v&&(this.v=null,$i(this),Ko(this),Ce(19))},V.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Ce(2)):(this.l.info("Failed to ping google.com"),Ce(1))},V.isActive=function(){return!!this.h&&this.h.isActive(this)},(V=ah.prototype).Ba=function(){},V.Aa=function(){},V.za=function(){},V.ya=function(){},V.isActive=function(){return!0},V.Va=function(){},Wi.prototype.g=function(n,e){return new Me(n,e)},ce(Me,he),Me.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Ce(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=sh(n,null,n.Y),Ki(n)},Me.prototype.close=function(){$o(this.g)},Me.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Do(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&Ki(e)},Me.prototype.N=function(){this.g.h=null,delete this.j,$o(this.g),delete this.g,Me.$.N.call(this)},ce(uh,Fo),ce(lh,ko),ce(pn,ah),pn.prototype.Ba=function(){ge(this.g,"a")},pn.prototype.Aa=function(n){ge(this.g,new uh(n))},pn.prototype.za=function(n){ge(this.g,new lh)},pn.prototype.ya=function(){ge(this.g,"b")},ce(Ge,function h_(){this.blockSize=-1}),Ge.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ge.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=t;)Wo(this,n,s),s+=this.blockSize;if("string"==typeof n){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Wo(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Wo(this,r),i=0;break}}this.h=i,this.i+=e},Ge.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var d_={};function Ho(n){return-128<=n&&128>n?function Ep(n,e){var t=d_;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new j([0|e],0>e?-1:0)}):new j([0|n],0>n?-1:0)}function Qe(n){if(isNaN(n)||!isFinite(n))return _n;if(0>n)return pe(Qe(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Zo;return new j(e,0)}var Zo=4294967296,_n=Ho(0),Yo=Ho(1),hh=Ho(16777216);function rt(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function Le(n){return-1==n.h}function pe(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new j(t,~n.h).add(Yo)}function Hi(n,e){return n.add(pe(e))}function Zi(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Sr(n,e){this.g=n,this.h=e}function Yi(n,e){if(rt(e))throw Error("division by zero");if(rt(n))return new Sr(_n,_n);if(Le(n))return e=Yi(pe(n),e),new Sr(pe(e.g),pe(e.h));if(Le(e))return e=Yi(n,pe(e)),new Sr(pe(e.g),e.h);if(30<n.g.length){if(Le(n)||Le(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Yo,r=e;0>=r.X(n);)t=dh(t),r=dh(r);var i=yn(t,1),s=yn(r,1);for(r=yn(r,2),t=yn(t,2);!rt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=yn(r,1),t=yn(t,1)}return e=Hi(n,i.R(e)),new Sr(i,e)}for(i=_n;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(s=Qe(t)).R(e);Le(o)||0<o.X(n);)o=(s=Qe(t-=r)).R(e);rt(s)&&(s=Yo),i=i.add(s),n=Hi(n,o)}return new Sr(i,n)}function dh(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new j(t,n.h)}function yn(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new j(i,n.h)}(V=j.prototype).ea=function(){if(Le(this))return-pe(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Zo+r)*e,e*=Zo}return n},V.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(rt(this))return"0";if(Le(this))return"-"+pe(this).toString(n);for(var e=Qe(Math.pow(n,6)),t=this,r="";;){var i=Yi(t,e).g,s=((0<(t=Hi(t,i.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(rt(t=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},V.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},V.X=function(n){return Le(n=Hi(this,n))?-1:rt(n)?0:1},V.abs=function(){return Le(this)?pe(this):this},V.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&n.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,t[i]=(o&=65535)<<16|(s&=65535)}return new j(t,-2147483648&t[t.length-1]?-1:0)},V.R=function(n){if(rt(this)||rt(n))return _n;if(Le(this))return Le(n)?pe(this).R(pe(n)):pe(pe(this).R(n));if(Le(n))return pe(this.R(pe(n)));if(0>this.X(hh)&&0>n.X(hh))return Qe(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=n.D(i)>>>16,u=65535&n.D(i);t[2*r+2*i]+=o*u,Zi(t,2*r+2*i),t[2*r+2*i+1]+=s*u,Zi(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,Zi(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,Zi(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new j(t,0)},V.gb=function(n){return Yi(this,n).h},V.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new j(t,this.h&n.h)},V.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new j(t,this.h|n.h)},V.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new j(t,this.h^n.h)},Wi.prototype.createWebChannel=Wi.prototype.g,Me.prototype.send=Me.prototype.u,Me.prototype.open=Me.prototype.m,Me.prototype.close=Me.prototype.close,ki.NO_ERROR=0,ki.TIMEOUT=8,ki.HTTP_ERROR=6,Ic.COMPLETE="complete",Ac.EventType=gr,gr.OPEN="a",gr.CLOSE="b",gr.ERROR="c",gr.MESSAGE="d",he.prototype.listen=he.prototype.O,te.prototype.listenOnce=te.prototype.P,te.prototype.getLastError=te.prototype.Sa,te.prototype.getLastErrorCode=te.prototype.Ia,te.prototype.getStatus=te.prototype.da,te.prototype.getResponseJson=te.prototype.Wa,te.prototype.getResponseText=te.prototype.ja,te.prototype.send=te.prototype.ha,te.prototype.setWithCredentials=te.prototype.Oa,Ge.prototype.digest=Ge.prototype.l,Ge.prototype.reset=Ge.prototype.reset,Ge.prototype.update=Ge.prototype.j,j.prototype.add=j.prototype.add,j.prototype.multiply=j.prototype.R,j.prototype.modulo=j.prototype.gb,j.prototype.compare=j.prototype.X,j.prototype.toNumber=j.prototype.ea,j.prototype.toString=j.prototype.toString,j.prototype.getBits=j.prototype.D,j.fromNumber=Qe,j.fromString=function ch(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return pe(ch(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Qe(Math.pow(e,8)),r=_n,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Qe(Math.pow(e,s)),r=r.R(s).add(Qe(o))):r=(r=r.R(t)).add(Qe(o))}return r};var f_=qe.createWebChannelTransport=function(){return new Wi},m_=qe.getStatEventTarget=function(){return Fi()},Jo=qe.ErrorCode=ki,g_=qe.EventType=Ic,p_=qe.Event=Bt,fh=qe.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},__=qe.FetchXmlHttpFactory=Tr,Ji=qe.WebChannel=Ac,y_=qe.XhrIo=te,v_=qe.Md5=Ge,vn=qe.Integer=j;const mh="@firebase/firestore";class de{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}de.UNAUTHENTICATED=new de(null),de.GOOGLE_CREDENTIALS=new de("google-credentials-uid"),de.FIRST_PARTY=new de("first-party-uid"),de.MOCK_USER=new de("mock-user");let En="10.11.1";const pt=new je.Yd("@firebase/firestore");function In(){return pt.logLevel}function v(n,...e){if(pt.logLevel<=je.in.DEBUG){const t=e.map(Xo);pt.debug(`Firestore (${En}): ${n}`,...t)}}function ie(n,...e){if(pt.logLevel<=je.in.ERROR){const t=e.map(Xo);pt.error(`Firestore (${En}): ${n}`,...t)}}function xe(n,...e){if(pt.logLevel<=je.in.WARN){const t=e.map(Xo);pt.warn(`Firestore (${En}): ${n}`,...t)}}function Xo(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function C(n="Unexpected state"){const e=`FIRESTORE (${En}) INTERNAL ASSERTION FAILED: `+n;throw ie(e),new Error(e)}function S(n,e){n||C()}function A(n,e){return n}const p={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class y extends G.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ue{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class gh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class T_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(de.UNAUTHENTICATED))}shutdown(){}}class A_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class w_{constructor(e){this.t=e,this.currentUser=de.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=l=>this.i!==i?(i=this.i,t(l)):Promise.resolve();let o=new ue;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ue,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const l=o;e.enqueueRetryable((0,_.Z)(function*(){yield l.promise,yield s(r.currentUser)}))},u=l=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?u(l):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ue)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(S("string"==typeof r.accessToken),new gh(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return S(null===e||"string"==typeof e),new de(e)}}class V_{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=de.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class C_{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new V_(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(de.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ph{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class S_{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{null!=s.error&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,v("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(S("string"==typeof t.token),this.R=t.token,new ph(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function R_(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class _h{static newId(){const t=62*Math.floor(256/62);let r="";for(;r.length<20;){const i=R_(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return r}}function x(n,e){return n<e?-1:n>e?1:0}function Tn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function yh(n){return n+"\0"}class X{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(p.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(p.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(p.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(p.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return X.fromMillis(Date.now())}static fromDate(e){return X.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new X(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?x(this.nanoseconds,e.nanoseconds):x(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class P{constructor(e){this.timestamp=e}static fromTimestamp(e){return new P(e)}static min(){return new P(new X(0,0))}static max(){return new P(new X(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Rr{constructor(e,t,r){void 0===t?t=0:t>e.length&&C(),void 0===r?r=e.length-t:r>e.length-t&&C(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Rr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Rr?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class O extends Rr{construct(e,t,r){return new O(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new y(p.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new O(t)}static emptyPath(){return new O([])}}const P_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Z extends Rr{construct(e,t,r){return new Z(e,t,r)}static isValidIdentifier(e){return P_.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Z.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Z(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new y(p.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new y(p.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new y(p.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new y(p.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Z(t)}static emptyPath(){return new Z([])}}class w{constructor(e){this.path=e}static fromPath(e){return new w(O.fromString(e))}static fromName(e){return new w(O.fromString(e).popFirst(5))}static empty(){return new w(O.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===O.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return O.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new w(new O(e.slice()))}}class An{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function ea(n){return n.fields.find(e=>2===e.kind)}function zt(n){return n.fields.filter(e=>2!==e.kind)}An.UNKNOWN_ID=-1;class jt{constructor(e,t){this.fieldPath=e,this.kind=t}}class wn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new wn(0,Fe.min())}}function vh(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=P.fromTimestamp(1e9===r?new X(t+1,0):new X(t,r));return new Fe(i,w.empty(),e)}function Eh(n){return new Fe(n.readTime,n.key,-1)}class Fe{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Fe(P.min(),w.empty(),-1)}static max(){return new Fe(P.max(),w.empty(),-1)}}function ta(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=w.comparator(n.documentKey,e.documentKey),0!==t?t:x(n.largestBatchId,e.largestBatchId))}const Ih="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Th{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function _t(n){return na.apply(this,arguments)}function na(){return na=(0,_.Z)(function*(n){if(n.code!==p.FAILED_PRECONDITION||n.message!==Ih)throw n;v("LocalStore","Unexpectedly lost primary lease")}),na.apply(this,arguments)}class m{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&C(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new m((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof m?t:m.resolve(t)}catch(t){return m.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):m.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):m.reject(t)}static resolve(e){return new m((t,r)=>{t(e)})}static reject(e){return new m((t,r)=>{r(e)})}static waitFor(e){return new m((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=m.resolve(!1);for(const r of e)t=t.next(i=>i?m.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new m((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const l=u;t(e[l]).next(c=>{o[l]=c,++a,a===s&&r(o)},c=>i(c))}})}static doWhile(e,t){return new m((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Xi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new ue,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Pr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=ra(r.target.error);this.V.reject(new Pr(e,i))}}static open(e,t,r,i){try{return new Xi(t,e.transaction(i,r))}catch(s){throw new Pr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(v("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new N_(t)}}class We{constructor(e,t,r){this.name=e,this.version=t,this.p=r,12.2===We.S((0,G.z$)())&&ie("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return v("SimpleDb","Removing database:",e),$t(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,G.hl)())return!1;if(We.C())return!0;const e=(0,G.z$)(),t=We.S(e),r=0<t&&t<10,i=Ah(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.v)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){var t=this;return(0,_.Z)(function*(){return t.db||(v("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=o=>{r(o.target.result)},s.onblocked=()=>{i(new Pr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=o=>{const a=o.target.error;i("VersionError"===a.name?new y(p.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new y(p.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Pr(e,a))},s.onupgradeneeded=o=>{v("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.p.O(o.target.result,s.transaction,o.oldVersion,t.version).next(()=>{v("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=r=>t.N(r)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,_.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{s.db=yield s.M(e);const u=Xi.open(s.db,e,o?"readonly":"readwrite",r),l=i(u).next(c=>(u.g(),c)).catch(c=>(u.abort(c),m.reject(c))).toPromise();return l.catch(()=>{}),yield u.m,l}catch(u){const l=u,c="FirebaseError"!==l.name&&a<3;if(v("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),s.close(),!c)return Promise.reject(l)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function Ah(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class b_{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return $t(this.B.delete())}}class Pr extends y{constructor(e,t){super(p.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function yt(n){return"IndexedDbTransactionError"===n.name}class N_{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(v("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),$t(r)}add(e){return v("SimpleDb","ADD",this.store.name,e,e),$t(this.store.add(e))}get(e){return $t(this.store.get(e)).next(t=>(void 0===t&&(t=null),v("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return v("SimpleDb","DELETE",this.store.name,e),$t(this.store.delete(e))}count(){return v("SimpleDb","COUNT",this.store.name),$t(this.store.count())}U(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(r.range);return new m((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{const s=this.cursor(r),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){v("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.W(i,t)}Y(e){const t=this.cursor({});return new m((r,i)=>{t.onerror=s=>{const o=ra(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new m((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const u=new b_(a),l=t(a.primaryKey,a.value,u);if(l instanceof m){const c=l.catch(d=>(u.done(),m.reject(d)));r.push(c)}u.isDone?i():null===u.K?a.continue():a.continue(u.K)}}).next(()=>m.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function $t(n){return new m((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=ra(r.target.error);t(i)}})}let wh=!1;function ra(n){const e=We.S((0,G.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return wh||(wh=!0,setTimeout(()=>{throw r},0)),r}}return n}class M_{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;v("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,_.Z)(function*(){t.task=null;try{v("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(r){yt(r)?v("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",r):yield _t(r)}yield t.X(6e4)}))}}class F_{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,_.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.te(r,e))})()}te(e,t){const r=new Set;let i=t,s=!0;return m.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return v("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(v("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=Eh(s);ta(o,r)>0&&(r=o)}),new Fe(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let ke=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function Dr(n){return null==n}function xr(n){return 0===n&&1/n==-1/0}function Vh(n){return"number"==typeof n&&Number.isInteger(n)&&!xr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Te(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Ch(e)),e=k_(n.get(t),e);return Ch(e)}function k_(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Ch(n){return n+"\x01\x01"}function He(n){const e=n.length;if(S(e>=2),2===e)return S("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),O.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("\x01",s);switch((o<0||o>t)&&C(),n.charAt(o+1)){case"\x01":const a=n.substring(s,o);let u;0===i.length?u=a:(i+=a,u=i,i=""),r.push(u);break;case"\x10":i+=n.substring(s,o),i+="\0";break;case"\x11":i+=n.substring(s,o+1);break;default:C()}s=o+2}return new O(r)}const Sh=["userId","batchId"];function es(n,e){return[n,Te(e)]}function Rh(n,e,t){return[n,Te(e),t]}const O_={},L_=["prefixPath","collectionGroup","readTime","documentId"],B_=["prefixPath","collectionGroup","documentId"],U_=["collectionGroup","readTime","prefixPath","documentId"],q_=["canonicalId","targetId"],G_=["targetId","path"],z_=["path","targetId"],j_=["collectionId","parent"],$_=["indexId","uid"],K_=["uid","sequenceNumber"],Q_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],W_=["indexId","uid","orderedDocumentKey"],H_=["userId","collectionPath","documentId"],Z_=["userId","collectionPath","largestBatchId"],Y_=["userId","collectionGroup","largestBatchId"],Ph=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],J_=[...Ph,"documentOverlays"],Dh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],xh=Dh,bh=[...xh,"indexConfiguration","indexState","indexEntries"],X_=bh;class ia extends Th{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function fe(n,e){const t=A(n);return We.F(t._e,e)}function Nh(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function vt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Mh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Q{constructor(e,t){this.comparator=e,this.root=t||_e.EMPTY}insert(e,t){return new Q(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,_e.BLACK,null,null))}remove(e){return new Q(this.comparator,this.root.remove(e,this.comparator).copy(null,null,_e.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ts(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ts(this.root,e,this.comparator,!1)}getReverseIterator(){return new ts(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ts(this.root,e,this.comparator,!0)}}class ts{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class _e{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??_e.RED,this.left=i??_e.EMPTY,this.right=s??_e.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new _e(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return _e.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return _e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,_e.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,_e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw C();const e=this.left.check();if(e!==this.right.check())throw C();return e+(this.isRed()?0:1)}}_e.EMPTY=null,_e.RED=!0,_e.BLACK=!1,_e.EMPTY=new class{constructor(){this.size=0}get key(){throw C()}get value(){throw C()}get color(){throw C()}get left(){throw C()}get right(){throw C()}copy(e,t,r,i,s){return this}insert(e,t,r){return new _e(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class K{constructor(e){this.comparator=e,this.data=new Q(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Fh(this.data.getIterator())}getIteratorFrom(e){return new Fh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof K)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new K(this.comparator);return t.data=e,t}}class Fh{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Vn(n){return n.hasNext()?n.getNext():void 0}class be{constructor(e){this.fields=e,e.sort(Z.comparator)}static empty(){return new be([])}unionWith(e){let t=new K(Z.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new be(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Tn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class kh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class le{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new kh("Invalid base64 string: "+s):s}}(e);return new le(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new le(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return x(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}le.EMPTY_BYTE_STRING=new le("");const ty=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function it(n){if(S(!!n),"string"==typeof n){let e=0;const t=ty.exec(n);if(S(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ne(n.seconds),nanos:ne(n.nanos)}}function ne(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function st(n){return"string"==typeof n?le.fromBase64String(n):le.fromUint8Array(n)}function ns(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=n?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function rs(n){const e=n.mapValue.fields.__previous_value__;return ns(e)?rs(e):e}function br(n){const e=it(n.mapValue.fields.__local_write_time__.timestampValue);return new X(e.seconds,e.nanos)}class ny{constructor(e,t,r,i,s,o,a,u,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=l}}class Et{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Et("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Et&&e.projectId===this.projectId&&e.database===this.database}}const It={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},is={nullValue:"NULL_VALUE"};function Tt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ns(n)?4:Uh(n)?9007199254740991:10:C()}function Ze(n,e){if(n===e)return!0;const t=Tt(n);if(t!==Tt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return br(n).isEqual(br(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=it(i.timestampValue),a=it(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,st(n.bytesValue).isEqual(st(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ne(i.geoPointValue.latitude)===ne(s.geoPointValue.latitude)&&ne(i.geoPointValue.longitude)===ne(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ne(i.integerValue)===ne(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=ne(i.doubleValue),a=ne(s.doubleValue);return o===a?xr(o)===xr(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Tn(n.arrayValue.values||[],e.arrayValue.values||[],Ze);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(Nh(o)!==Nh(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===a[u]||!Ze(o[u],a[u])))return!1;return!0}(n,e);default:return C()}var s}function Nr(n,e){return void 0!==(n.values||[]).find(t=>Ze(t,e))}function At(n,e){if(n===e)return 0;const t=Tt(n),r=Tt(e);if(t!==r)return x(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return x(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=ne(s.integerValue||s.doubleValue),u=ne(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return Oh(n.timestampValue,e.timestampValue);case 4:return Oh(br(n),br(e));case 5:return x(n.stringValue,e.stringValue);case 6:return function(s,o){const a=st(s),u=st(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),u=o.split("/");for(let l=0;l<a.length&&l<u.length;l++){const c=x(a[l],u[l]);if(0!==c)return c}return x(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=x(ne(s.latitude),ne(o.latitude));return 0!==a?a:x(ne(s.longitude),ne(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],u=o.values||[];for(let l=0;l<a.length&&l<u.length;++l){const c=At(a[l],u[l]);if(c)return c}return x(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===It.mapValue&&o===It.mapValue)return 0;if(s===It.mapValue)return 1;if(o===It.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),l=o.fields||{},c=Object.keys(l);u.sort(),c.sort();for(let d=0;d<u.length&&d<c.length;++d){const f=x(u[d],c[d]);if(0!==f)return f;const g=At(a[u[d]],l[c[d]]);if(0!==g)return g}return x(u.length,c.length)}(n.mapValue,e.mapValue);default:throw C()}}function Oh(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return x(n,e);const t=it(n),r=it(e),i=x(t.seconds,r.seconds);return 0!==i?i:x(t.nanos,r.nanos)}function Cn(n){return sa(n)}function sa(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=it(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?st(n.bytesValue).toBase64():"referenceValue"in n?w.fromName(n.referenceValue).toString():"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=sa(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${sa(t.fields[o])}`;return i+"}"}(n.mapValue):C()}function Kt(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function oa(n){return!!n&&"integerValue"in n}function Mr(n){return!!n&&"arrayValue"in n}function Lh(n){return!!n&&"nullValue"in n}function Bh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function os(n){return!!n&&"mapValue"in n}function Fr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return vt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Fr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Fr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Uh(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function ry(n){return"nullValue"in n?is:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Kt(Et.empty(),w.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:C()}function iy(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Kt(Et.empty(),w.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?It:C()}function qh(n,e){const t=At(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Gh(n,e){const t=At(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class ye{constructor(e){this.value=e}static empty(){return new ye({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!os(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Fr(t)}setAll(e){let t=Z.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Fr(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());os(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ze(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];os(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){vt(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new ye(Fr(this.value))}}function zh(n){const e=[];return vt(n.fields,(t,r)=>{const i=new Z([t]);if(os(r)){const s=zh(r.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new be(e)}class Y{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Y(e,0,P.min(),P.min(),P.min(),ye.empty(),0)}static newFoundDocument(e,t,r,i){return new Y(e,1,t,P.min(),r,i,0)}static newNoDocument(e,t){return new Y(e,2,t,P.min(),P.min(),ye.empty(),0)}static newUnknownDocument(e,t){return new Y(e,3,t,P.min(),P.min(),ye.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(P.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ye.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ye.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=P.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Y&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Y(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class wt{constructor(e,t){this.position=e,this.inclusive=t}}function jh(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(r=s.field.isKeyField()?w.comparator(w.fromName(o.referenceValue),t.key):At(o,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function $h(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ze(n.position[t],e.position[t]))return!1;return!0}class kr{constructor(e,t="asc"){this.field=e,this.dir=t}}function sy(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Kh{}class L extends Kh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new oy(e,t,r):"array-contains"===t?new ly(e,r):"in"===t?new Jh(e,r):"not-in"===t?new cy(e,r):"array-contains-any"===t?new hy(e,r):new L(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new ay(e,r):new uy(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(At(t,this.value)):null!==t&&Tt(this.value)===Tt(t)&&this.matchesComparison(At(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return C()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class $ extends Kh{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new $(e,t)}matches(e){return Sn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Sn(n){return"and"===n.op}function aa(n){return"or"===n.op}function ua(n){return Qh(n)&&Sn(n)}function Qh(n){for(const e of n.filters)if(e instanceof $)return!1;return!0}function la(n){if(n instanceof L)return n.field.canonicalString()+n.op.toString()+Cn(n.value);if(ua(n))return n.filters.map(e=>la(e)).join(",");{const e=n.filters.map(t=>la(t)).join(",");return`${n.op}(${e})`}}function Wh(n,e){return n instanceof L?(r=n,(i=e)instanceof L&&r.op===i.op&&r.field.isEqual(i.field)&&Ze(r.value,i.value)):n instanceof $?function(r,i){return i instanceof $&&r.op===i.op&&r.filters.length===i.filters.length&&r.filters.reduce((s,o,a)=>s&&Wh(o,i.filters[a]),!0)}(n,e):void C();var r,i}function Hh(n,e){const t=n.filters.concat(e);return $.create(t,n.op)}function Zh(n){return n instanceof L?`${(t=n).field.canonicalString()} ${t.op} ${Cn(t.value)}`:n instanceof $?function(t){return t.op.toString()+" {"+t.getFilters().map(Zh).join(" ,")+"}"}(n):"Filter";var t}class oy extends L{constructor(e,t,r){super(e,t,r),this.key=w.fromName(r.referenceValue)}matches(e){const t=w.comparator(e.key,this.key);return this.matchesComparison(t)}}class ay extends L{constructor(e,t){super(e,"in",t),this.keys=Yh(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class uy extends L{constructor(e,t){super(e,"not-in",t),this.keys=Yh(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Yh(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>w.fromName(r.referenceValue))}class ly extends L{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Mr(t)&&Nr(t.arrayValue,this.value)}}class Jh extends L{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Nr(this.value.arrayValue,t)}}class cy extends L{constructor(e,t){super(e,"not-in",t)}matches(e){if(Nr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Nr(this.value.arrayValue,t)}}class hy extends L{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Mr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Nr(this.value.arrayValue,r))}}class dy{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}}function ca(n,e=null,t=[],r=[],i=null,s=null,o=null){return new dy(n,e,t,r,i,s,o)}function Qt(n){const e=A(n);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>la(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Dr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Cn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Cn(r)).join(",")),e.ue=t}return e.ue}function Or(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!sy(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Wh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!$h(n.startAt,e.startAt)&&$h(n.endAt,e.endAt)}function as(n){return w.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function us(n,e){return n.filters.filter(t=>t instanceof L&&t.field.isEqual(e))}function Xh(n,e,t){let r=is,i=!0;for(const s of us(n,e)){let o=is,a=!0;switch(s.op){case"<":case"<=":o=ry(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=is}qh({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];qh({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}function ed(n,e,t){let r=It,i=!0;for(const s of us(n,e)){let o=It,a=!0;switch(s.op){case">=":case">":o=iy(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=It}Gh({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Gh({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}return{value:r,inclusive:i}}class ot{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null}}function td(n,e,t,r,i,s,o,a){return new ot(n,e,t,r,i,s,o,a)}function Rn(n){return new ot(n)}function nd(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function ha(n){return null!==n.collectionGroup}function Pn(n){const e=A(n);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new K(Z.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new kr(s,r))}),t.has(Z.keyField().canonicalString())||e.ce.push(new kr(Z.keyField(),r))}return e.ce}function Se(n){const e=A(n);return e.le||(e.le=function rd(n,e){if("F"===n.limitType)return ca(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>new kr(i.field,"desc"===i.dir?"asc":"desc"));const t=n.endAt?new wt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new wt(n.startAt.position,n.startAt.inclusive):null;return ca(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}(e,Pn(n))),e.le}function da(n,e){const t=n.filters.concat([e]);return new ot(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ls(n,e,t){return new ot(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Lr(n,e){return Or(Se(n),Se(e))&&n.limitType===e.limitType}function id(n){return`${Qt(Se(n))}|lt:${n.limitType}`}function Dn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Zh(i)).join(", ")}]`),Dr(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Cn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Cn(i)).join(",")),`Target(${r})`}(Se(n))}; limitType=${n.limitType})`}function Br(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return null!==r.collectionGroup?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):w.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of Pn(r))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&(i=e,!((r=n).startAt&&!function(o,a,u){const l=jh(o,a,u);return o.inclusive?l<=0:l<0}(r.startAt,Pn(r),i)||r.endAt&&!function(o,a,u){const l=jh(o,a,u);return o.inclusive?l>=0:l>0}(r.endAt,Pn(r),i)));var r,i}function sd(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function od(n){return(e,t)=>{let r=!1;for(const i of Pn(n)){const s=fy(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function fy(n,e,t){const r=n.field.isKeyField()?w.comparator(e.key,t.key):function(s,o,a){const u=o.data.field(s),l=a.data.field(s);return null!==u&&null!==l?At(u,l):C()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return C()}}class at{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){vt(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Mh(this.inner)}size(){return this.innerSize}}const my=new Q(w.comparator);function Ne(){return my}const ad=new Q(w.comparator);function Ur(...n){let e=ad;for(const t of n)e=e.insert(t.key,t);return e}function ud(n){let e=ad;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ye(){return qr()}function ld(){return qr()}function qr(){return new at(n=>n.toString(),(n,e)=>n.isEqual(e))}const gy=new Q(w.comparator),py=new K(w.comparator);function F(...n){let e=py;for(const t of n)e=e.add(t);return e}const _y=new K(x);function fa(){return _y}function cd(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xr(e)?"-0":e}}function hd(n){return{integerValue:""+n}}function dd(n,e){return Vh(e)?hd(e):cd(n,e)}class cs{constructor(){this._=void 0}}function yy(n,e,t){return n instanceof xn?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ns(s)&&(s=rs(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Wt?md(n,e):n instanceof Ht?gd(n,e):function(i,s){const o=fd(i,s),a=pd(o)+pd(i.Pe);return oa(o)&&oa(i.Pe)?hd(a):cd(i.serializer,a)}(n,e)}function vy(n,e,t){return n instanceof Wt?md(n,e):n instanceof Ht?gd(n,e):t}function fd(n,e){return n instanceof bn?oa(r=e)||(s=r)&&"doubleValue"in s?e:{integerValue:0}:null;var r,s}class xn extends cs{}class Wt extends cs{constructor(e){super(),this.elements=e}}function md(n,e){const t=_d(e);for(const r of n.elements)t.some(i=>Ze(i,r))||t.push(r);return{arrayValue:{values:t}}}class Ht extends cs{constructor(e){super(),this.elements=e}}function gd(n,e){let t=_d(e);for(const r of n.elements)t=t.filter(i=>!Ze(i,r));return{arrayValue:{values:t}}}class bn extends cs{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function pd(n){return ne(n.integerValue||n.doubleValue)}function _d(n){return Mr(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Gr{constructor(e,t){this.field=e,this.transform=t}}class Iy{constructor(e,t){this.version=e,this.transformResults=t}}class ee{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ee}static exists(e){return new ee(void 0,e)}static updateTime(e){return new ee(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function hs(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class ds{}function yd(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Mn(n.key,ee.none()):new Nn(n.key,n.data,ee.none());{const t=n.data,r=ye.empty();let i=new K(Z.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?r.delete(s):r.set(s,o),i=i.add(s)}return new ut(n.key,r,new be(i.toArray()),ee.none())}}function Ty(n,e,t){n instanceof Nn?function(i,s,o){const a=i.value.clone(),u=Id(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof ut?function(i,s,o){if(!hs(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=Id(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(Ed(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function zr(n,e,t,r){return n instanceof Nn?function(s,o,a,u){if(!hs(s.precondition,o))return a;const l=s.value.clone(),c=Td(s.fieldTransforms,u,o);return l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(n,e,t,r):n instanceof ut?function(s,o,a,u){if(!hs(s.precondition,o))return a;const l=Td(s.fieldTransforms,u,o),c=o.data;return c.setAll(Ed(s)),c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(d=>d.field))}(n,e,t,r):(a=t,hs(n.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function Ay(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=fd(r.transform,i||null);null!=s&&(null===t&&(t=ye.empty()),t.set(r.field,s))}return t||null}function vd(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(r=n.fieldTransforms)&&void 0===i||r&&i&&Tn(r,i,(s,o)=>function Ey(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(r=n.transform)instanceof Wt&&i instanceof Wt||r instanceof Ht&&i instanceof Ht?Tn(r.elements,i.elements,Ze):r instanceof bn&&i instanceof bn?Ze(r.Pe,i.Pe):r instanceof xn&&i instanceof xn);var r,i}(s,o))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var r,i}class Nn extends ds{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ut extends ds{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ed(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Id(n,e,t){const r=new Map;S(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,vy(o,a,t[i]))}return r}function Td(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,yy(s,o,e))}return r}class Mn extends ds{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ma extends ds{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ga{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Ty(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=zr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=zr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=ld();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const u=yd(o,a);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(P.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),F())}isEqual(e){return this.batchId===e.batchId&&Tn(this.mutations,e.mutations,(t,r)=>vd(t,r))&&Tn(this.baseMutations,e.baseMutations,(t,r)=>vd(t,r))}}class pa{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){S(e.mutations.length===r.length);let i=gy;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new pa(e,t,r,i)}}class _a{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Vy{constructor(e,t){this.count=e,this.unchangedNames=t}}var ae,B;function Ad(n){switch(n){default:return C();case p.CANCELLED:case p.UNKNOWN:case p.DEADLINE_EXCEEDED:case p.RESOURCE_EXHAUSTED:case p.INTERNAL:case p.UNAVAILABLE:case p.UNAUTHENTICATED:return!1;case p.INVALID_ARGUMENT:case p.NOT_FOUND:case p.ALREADY_EXISTS:case p.PERMISSION_DENIED:case p.FAILED_PRECONDITION:case p.ABORTED:case p.OUT_OF_RANGE:case p.UNIMPLEMENTED:case p.DATA_LOSS:return!0}}function wd(n){if(void 0===n)return ie("GRPC error has no .code"),p.UNKNOWN;switch(n){case ae.OK:return p.OK;case ae.CANCELLED:return p.CANCELLED;case ae.UNKNOWN:return p.UNKNOWN;case ae.DEADLINE_EXCEEDED:return p.DEADLINE_EXCEEDED;case ae.RESOURCE_EXHAUSTED:return p.RESOURCE_EXHAUSTED;case ae.INTERNAL:return p.INTERNAL;case ae.UNAVAILABLE:return p.UNAVAILABLE;case ae.UNAUTHENTICATED:return p.UNAUTHENTICATED;case ae.INVALID_ARGUMENT:return p.INVALID_ARGUMENT;case ae.NOT_FOUND:return p.NOT_FOUND;case ae.ALREADY_EXISTS:return p.ALREADY_EXISTS;case ae.PERMISSION_DENIED:return p.PERMISSION_DENIED;case ae.FAILED_PRECONDITION:return p.FAILED_PRECONDITION;case ae.ABORTED:return p.ABORTED;case ae.OUT_OF_RANGE:return p.OUT_OF_RANGE;case ae.UNIMPLEMENTED:return p.UNIMPLEMENTED;case ae.DATA_LOSS:return p.DATA_LOSS;default:return C()}}(B=ae||(ae={}))[B.OK=0]="OK",B[B.CANCELLED=1]="CANCELLED",B[B.UNKNOWN=2]="UNKNOWN",B[B.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",B[B.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",B[B.NOT_FOUND=5]="NOT_FOUND",B[B.ALREADY_EXISTS=6]="ALREADY_EXISTS",B[B.PERMISSION_DENIED=7]="PERMISSION_DENIED",B[B.UNAUTHENTICATED=16]="UNAUTHENTICATED",B[B.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",B[B.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",B[B.ABORTED=10]="ABORTED",B[B.OUT_OF_RANGE=11]="OUT_OF_RANGE",B[B.UNIMPLEMENTED=12]="UNIMPLEMENTED",B[B.INTERNAL=13]="INTERNAL",B[B.UNAVAILABLE=14]="UNAVAILABLE",B[B.DATA_LOSS=15]="DATA_LOSS";function Vd(){return new TextEncoder}const Cy=new vn([4294967295,4294967295],0);function Cd(n){const e=Vd().encode(n),t=new v_;return t.update(e),new Uint8Array(t.digest())}function Sd(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new vn([t,r],0),new vn([i,s],0)]}class ya{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new jr(`Invalid padding: ${t}`);if(r<0)throw new jr(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new jr(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new jr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=vn.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(vn.fromNumber(r)));return 1===i.compare(Cy)&&(i=new vn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Cd(e),[r,i]=Sd(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new ya(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.Ie)return;const t=Cd(e),[r,i]=Sd(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class jr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class $r{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Kr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new $r(P.min(),i,new Q(x),Ne(),F())}}class Kr{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Kr(r,t,F(),F(),F())}}class ms{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}}class Rd{constructor(e,t){this.targetId=e,this.me=t}}class Pd{constructor(e,t,r=le.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Dd{constructor(){this.fe=0,this.ge=bd(),this.pe=le.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=F(),t=F(),r=F();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:C()}}),new Kr(this.pe,this.ye,e,t,r)}ve(){this.we=!1,this.ge=bd()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,S(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Sy{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ne(),this.qe=xd(),this.Qe=new Q(x)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:C()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,r=e.me.count,i=this.Je(t);if(i){const s=i.target;if(as(s))if(0===r){const o=new w(s.path);this.Ue(t,o,Y.newNoDocument(o,P.min()))}else S(1===r);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),u=a?this.Xe(a,e,o):1;0!==u&&(this.je(t),this.Qe=this.Qe.insert(t,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=st(r).toUint8Array()}catch(u){if(u instanceof kh)return xe("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new ya(o,i,s)}catch(u){return xe(u instanceof jr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return 0===a.Ie?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,o)=>{const a=this.Je(o);if(a){if(s.current&&as(a.target)){const u=new w(a.target.path);null!==this.ke.get(u)||this.it(o,u)||this.Ue(o,u,Y.newNoDocument(u,e))}s.be&&(t.set(o,s.Ce()),s.ve())}});let r=F();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{const l=this.Je(u);return!l||"TargetPurposeLimboResolution"===l.purpose||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));const i=new $r(e,t,this.Qe,this.ke,r);return this.ke=Ne(),this.qe=xd(),this.Qe=new Q(x),i}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Dd,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new K(x),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||v("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Dd),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function xd(){return new Q(w.comparator)}function bd(){return new Q(w.comparator)}const Ry={asc:"ASCENDING",desc:"DESCENDING"},Py={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Dy={and:"AND",or:"OR"};class xy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function va(n,e){return n.useProto3Json||Dr(e)?e:{value:e}}function Fn(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Nd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function by(n,e){return Fn(n,e.toTimestamp())}function se(n){return S(!!n),P.fromTimestamp(function(t){const r=it(t);return new X(r.seconds,r.nanos)}(n))}function Ea(n,e){return Ia(n,e).canonicalString()}function Ia(n,e){const t=(i=n,new O(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function Md(n){const e=O.fromString(n);return S(jd(e)),e}function Qr(n,e){return Ea(n.databaseId,e.path)}function Je(n,e){const t=Md(e);if(t.get(1)!==n.databaseId.projectId)throw new y(p.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(p.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new w(Od(t))}function Fd(n,e){return Ea(n.databaseId,e)}function kd(n){const e=Md(n);return 4===e.length?O.emptyPath():Od(e)}function Ta(n){return new O(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Od(n){return S(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Ld(n,e,t){return{name:Qr(n,e),fields:t.value.mapValue.fields}}function Bd(n,e,t){const r=Je(n,e.name),i=se(e.updateTime),s=e.createTime?se(e.createTime):P.min(),o=new ye({mapValue:{fields:e.fields}}),a=Y.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Wr(n,e){let t;if(e instanceof Nn)t={update:Ld(n,e.key,e.value)};else if(e instanceof Mn)t={delete:Qr(n,e.key)};else if(e instanceof ut)t={update:Ld(n,e.key,e.data),updateMask:Uy(e.fieldMask)};else{if(!(e instanceof ma))return C();t={verify:Qr(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof xn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Wt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ht)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof bn)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw C()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:by(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:C()),t;var s}function Aa(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?ee.updateTime(se(s.updateTime)):void 0!==s.exists?ee.exists(s.exists):ee.none():ee.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;"setToServerValue"in a?(S("REQUEST_TIME"===a.setToServerValue),u=new xn):"appendMissingElements"in a?u=new Wt(a.appendMissingElements.values||[]):"removeAllFromArray"in a?u=new Ht(a.removeAllFromArray.values||[]):"increment"in a?u=new bn(o,a.increment):C();const l=Z.fromServerFormat(a.fieldPath);return new Gr(l,u)}(n,i)):[];var s;if(e.update){const i=Je(n,e.update.name),s=new ye({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new be((e.updateMask.fieldPaths||[]).map(c=>Z.fromServerFormat(c)));return new ut(i,s,o,t,r)}return new Nn(i,s,t,r)}if(e.delete){const i=Je(n,e.delete);return new Mn(i,t)}if(e.verify){const i=Je(n,e.verify);return new ma(i,t)}return C()}function Ud(n,e){return{documents:[Fd(n,e.path)]}}function wa(n,e){const t={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Fd(n,i);const s=function(l){if(0!==l.length)return zd($.create(l,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(l){if(0!==l.length)return l.map(c=>{return{field:Vt((f=c).field),direction:Oy(f.dir)};var f})}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=va(n,e.limit);return null!==a&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt={before:(l=e.startAt).inclusive,values:l.position}),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{_t:t,parent:i};var l}function qd(n){let e=kd(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){S(1===r);const c=t.from[0];c.allDescendants?i=c.collectionId:e=e.child(c.collectionId)}let s=[];t.where&&(s=function(d){const f=Gd(d);return f instanceof $&&ua(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(f=>{return new kr(kn((E=f).field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction));var E}));let a=null;t.limit&&(a=function(d){let f;return f="object"==typeof d?d.value:d,Dr(f)?null:f}(t.limit));let u=null;var d;t.startAt&&(u=new wt((d=t.startAt).values||[],!!d.before));let l=null;return t.endAt&&(l=function(d){return new wt(d.values||[],!d.before)}(t.endAt)),td(e,i,o,s,a,"F",u,l)}function Gd(n){return void 0!==n.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=kn(t.unaryFilter.field);return L.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=kn(t.unaryFilter.field);return L.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=kn(t.unaryFilter.field);return L.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=kn(t.unaryFilter.field);return L.create(o,"!=",{nullValue:"NULL_VALUE"});default:return C()}}(n):void 0!==n.fieldFilter?L.create(kn((t=n).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return C()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==n.compositeFilter?function(t){return $.create(t.compositeFilter.filters.map(r=>Gd(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return C()}}(t.compositeFilter.op))}(n):C();var t}function Oy(n){return Ry[n]}function Ly(n){return Py[n]}function By(n){return Dy[n]}function Vt(n){return{fieldPath:n.canonicalString()}}function kn(n){return Z.fromServerFormat(n.fieldPath)}function zd(n){return n instanceof L?function(t){if("=="===t.op){if(Bh(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NAN"}};if(Lh(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Bh(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NOT_NAN"}};if(Lh(t.value))return{unaryFilter:{field:Vt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Vt(t.field),op:Ly(t.op),value:t.value}}}(n):n instanceof $?function(t){const r=t.getFilters().map(i=>zd(i));return 1===r.length?r[0]:{compositeFilter:{op:By(t.op),filters:r}}}(n):C()}function Uy(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function jd(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class lt{constructor(e,t,r,i,s=P.min(),o=P.min(),a=le.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new lt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new lt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new lt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new lt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class $d{constructor(e){this.ut=e}}function Kd(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:gs(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Qr(s=n.ut,(o=e).key),fields:o.data.value.mapValue.fields,updateTime:Fn(s,o.version.toTimestamp()),createTime:Fn(s,o.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Zt(e.version)};else{if(!e.isUnknownDocument())return C();r.unknownDocument={path:t.path.toArray(),version:Zt(e.version)}}var s,o;return r}function gs(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Zt(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Yt(n){const e=new X(n.seconds,n.nanoseconds);return P.fromTimestamp(e)}function Jt(n,e){const t=(e.baseMutations||[]).map(s=>Aa(n.ut,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const r=e.mutations.map(s=>Aa(n.ut,s)),i=X.fromMillis(e.localWriteTimeMs);return new ga(e.batchId,i,t,r)}function Hr(n){const e=Yt(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Yt(n.lastLimboFreeSnapshotVersion):P.min();let r;return r=void 0!==n.query.documents?(S(1===(s=n.query).documents.length),Se(Rn(kd(s.documents[0])))):function(s){return Se(qd(s))}(n.query),new lt(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,le.fromBase64String(n.resumeToken));var s}function Qd(n,e){const t=Zt(e.snapshotVersion),r=Zt(e.lastLimboFreeSnapshotVersion);let i;i=as(e.target)?Ud(n.ut,e.target):wa(n.ut,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Qt(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Va(n){const e=qd({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?ls(e,e.limit,"L"):e}function Ca(n,e){return new _a(e.largestBatchId,Aa(n.ut,e.overlayMutation))}function Wd(n,e){const t=e.path.lastSegment();return[n,Te(e.path.popLast()),t]}function Hd(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Zt(r.readTime),documentKey:Te(r.documentKey.path),largestBatchId:r.largestBatchId}}class Gy{getBundleMetadata(e,t){return Zd(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:Yt(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Zd(e).put({bundleId:(i=t).id,createTime:Zt(se(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Yd(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:Va(s.bundledQuery),readTime:Yt(s.readTime)};var s})}saveNamedQuery(e,t){return Yd(e).put({name:(i=t).name,readTime:Zt(se(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Zd(n){return fe(n,"bundles")}function Yd(n){return fe(n,"namedQueries")}class ps{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){return new ps(e,t.uid||"")}getOverlay(e,t){return Zr(e).get(Wd(this.userId,t)).next(r=>r?Ca(this.serializer,r):null)}getOverlays(e,t){const r=Ye();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const a=new _a(t,o);i.push(this.lt(e,a))}),m.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(Te(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Zr(e).j("collectionPathOverlayIndex",a))}),m.waitFor(s)}getOverlaysForCollection(e,t,r){const i=Ye(),s=Te(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Zr(e).U("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const l=Ca(this.serializer,u);i.set(l.getKey(),l)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=Ye();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Zr(e).J({index:"collectionGroupOverlayIndex",range:a},(u,l,c)=>{const d=Ca(this.serializer,l);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):c.done()}).next(()=>s)}lt(e,t){return Zr(e).put(function(i,s,o){const[a,u,l]=Wd(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:l,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Wr(i.ut,o.mutation)}}(this.serializer,this.userId,t))}}function Zr(n){return fe(n,"documentOverlays")}class Xt{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(ne(e.integerValue));else if("doubleValue"in e){const r=ne(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),xr(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Tt(t,20),"string"==typeof r&&(r=it(r)),t.dt(`${r.seconds||""}`),t.Et(r.nanos||0)}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(st(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?Uh(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):C()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const r=e.fields||{};this.Tt(t,55);for(const i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){const r=e.values||[];this.Tt(t,50);for(const i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),w.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}function zy(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Jd(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=zy(255&r[s]);if(i+=o,8!==o)break}return i}(n);return Math.ceil(e/8)}Xt.St=new Xt;class jy{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{const i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){const t=this.Lt(e),r=Jd(t);this.Bt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){const t=this.Lt(e),r=Jd(t);this.Bt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Bt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Lt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){const t=255&e;0===t?(this.Qt(0),this.Qt(255)):255===t?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){const t=255&e;0===t?(this.$t(0),this.$t(255)):255===t?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Bt(1),this.buffer[this.position++]=e}$t(e){this.Bt(1),this.buffer[this.position++]=~e}Bt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class $y{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class Ky{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class Yr{constructor(){this.Wt=new jy,this.Gt=new $y(this.Wt),this.zt=new Ky(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return 0===e?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class en{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new en(this.indexId,this.documentKey,this.arrayValue,r)}}function Ct(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=Xd(n.arrayValue,e.arrayValue),0!==t?t:(t=Xd(n.directionalValue,e.directionalValue),0!==t?t:w.comparator(n.documentKey,e.documentKey)))}function Xd(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class ef{constructor(e){this.Jt=new K((t,r)=>Z.comparator(t.field,r.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(S(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=ea(e);if(void 0!==t&&!this.tn(t))return!1;const r=zt(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){const a=this.Jt.getIterator().getNext();if(!i.has(a.field.canonicalString())){const u=r[s];if(!this.nn(a,u)||!this.rn(this.Yt[o++],u))return!1}++s}for(;s<r.length;++s)if(o>=this.Yt.length||!this.rn(this.Yt[o++],r[s]))return!1;return!0}sn(){if(this.Xt)return null;let e=new K(Z.comparator);const t=[];for(const r of this.Zt)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new jt(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new jt(r.field,0))}for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new jt(r.field,"asc"===r.dir?0:1)));return new An(An.UNKNOWN_ID,this.collectionId,t,wn.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function tf(n){var e,t;if(S(n instanceof L||n instanceof $),n instanceof L){if(n instanceof Jh){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>L.create(n.field,"==",s)))||[];return $.create(i,"or")}return n}const r=n.filters.map(i=>tf(i));return $.create(r,n.op)}function Qy(n){if(0===n.getFilters().length)return[];const e=Pa(tf(n));return S(nf(e)),Sa(e)||Ra(e)?[e]:e.getFilters()}function Sa(n){return n instanceof L}function Ra(n){return n instanceof $&&ua(n)}function nf(n){return Sa(n)||Ra(n)||function(t){if(t instanceof $&&aa(t)){for(const r of t.getFilters())if(!Sa(r)&&!Ra(r))return!1;return!0}return!1}(n)}function Pa(n){if(S(n instanceof L||n instanceof $),n instanceof L)return n;if(1===n.filters.length)return Pa(n.filters[0]);const e=n.filters.map(r=>Pa(r));let t=$.create(e,n.op);return t=_s(t),nf(t)?t:(S(t instanceof $),S(Sn(t)),S(t.filters.length>1),t.filters.reduce((r,i)=>Da(r,i)))}function Da(n,e){let t;return S(n instanceof L||n instanceof $),S(e instanceof L||e instanceof $),t=n instanceof L?e instanceof L?$.create([n,e],"and"):rf(n,e):e instanceof L?rf(e,n):function(i,s){if(S(i.filters.length>0&&s.filters.length>0),Sn(i)&&Sn(s))return Hh(i,s.getFilters());const o=aa(i)?i:s,a=aa(i)?s:i,u=o.filters.map(l=>Da(l,a));return $.create(u,"or")}(n,e),_s(t)}function rf(n,e){if(Sn(e))return Hh(e,n.getFilters());{const t=e.filters.map(r=>Da(n,r));return $.create(t,"or")}}function _s(n){if(S(n instanceof L||n instanceof $),n instanceof L)return n;const e=n.getFilters();if(1===e.length)return _s(e[0]);if(Qh(n))return n;const t=e.map(i=>_s(i)),r=[];return t.forEach(i=>{i instanceof L?r.push(i):i instanceof $&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:$.create(r,n.op)}class Wy{constructor(){this.on=new xa}addToCollectionParentIndex(e,t){return this.on.add(t),m.resolve()}getCollectionParents(e,t){return m.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return m.resolve()}deleteFieldIndex(e,t){return m.resolve()}deleteAllFieldIndexes(e){return m.resolve()}createTargetIndexes(e,t){return m.resolve()}getDocumentsMatchingTarget(e,t){return m.resolve(null)}getIndexType(e,t){return m.resolve(0)}getFieldIndexes(e,t){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,t){return m.resolve(Fe.min())}getMinOffsetFromCollectionGroup(e,t){return m.resolve(Fe.min())}updateCollectionGroup(e,t,r){return m.resolve()}updateIndexEntries(e,t){return m.resolve()}}class xa{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new K(O.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new K(O.comparator)).toArray()}}const ys=new Uint8Array(0);class Hy{constructor(e,t){this.databaseId=t,this._n=new xa,this.an=new at(r=>Qt(r),(r,i)=>Or(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});const s={collectionId:r,parent:Te(i)};return sf(e).put(s)}return m.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[yh(t),""],!1,!0);return sf(e).U(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(He(o.parent))}return r})}addFieldIndex(e,t){const r=Jr(e),i={indexId:(a=t).indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])};var a;delete i.indexId;const s=r.add(i);if(t.indexState){const o=Ln(e);return s.next(a=>{o.put(Hd(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=Jr(e),i=Ln(e),s=On(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Jr(e),r=On(e),i=Ln(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return m.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(0===i||1===i){const s=new ef(r).sn();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=On(e);let i=!0;const s=new Map;return m.forEach(this.un(t),o=>this.cn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=F();const a=[];return m.forEach(s,(u,l)=>{var R;v("IndexedDbIndexManager",`Using index ${R=u,`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(M=>`${M.fieldPath}:${M.kind}`).join(",")}`} to execute ${Qt(t)}`);const c=function(R,M){const q=ea(M);if(void 0===q)return null;for(const z of us(R,q.fieldPath))switch(z.op){case"array-contains-any":return z.value.arrayValue.values||[];case"array-contains":return[z.value]}return null}(l,u),d=function(R,M){const q=new Map;for(const z of zt(M))for(const oe of us(R,z.fieldPath))switch(oe.op){case"==":case"in":q.set(z.fieldPath.canonicalString(),oe.value);break;case"not-in":case"!=":return q.set(z.fieldPath.canonicalString(),oe.value),Array.from(q.values())}return null}(l,u),f=function(R,M){const q=[];let z=!0;for(const oe of zt(M)){const Ue=0===oe.kind?Xh(R,oe.fieldPath,R.startAt):ed(R,oe.fieldPath,R.startAt);q.push(Ue.value),z&&(z=Ue.inclusive)}return new wt(q,z)}(l,u),g=function(R,M){const q=[];let z=!0;for(const oe of zt(M)){const Ue=0===oe.kind?ed(R,oe.fieldPath,R.endAt):Xh(R,oe.fieldPath,R.endAt);q.push(Ue.value),z&&(z=Ue.inclusive)}return new wt(q,z)}(l,u),E=this.ln(u,l,f),T=this.ln(u,l,g),I=this.hn(u,l,d),D=this.Pn(u.indexId,c,E,f.inclusive,T,g.inclusive,I);return m.forEach(D,N=>r.G(N,t.limit).next(R=>{R.forEach(M=>{const q=w.fromSegments(M.documentKey);o.has(q)||(o=o.add(q),a.push(q))})}))}).next(()=>a)}return m.resolve(null)})}un(e){let t=this.an.get(e);return t||(t=0===e.filters.length?[e]:Qy($.create(e.filters,"and")).map(r=>ca(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,s.length),l=u/(null!=t?t.length:1),c=[];for(let d=0;d<u;++d){const f=t?this.In(t[d/l]):ys,g=this.Tn(e,f,r[d%l],i),E=this.En(e,f,s[d%l],o),T=a.map(I=>this.Tn(e,f,I,!0));c.push(...this.createRange(g,E,T))}return c}Tn(e,t,r,i){const s=new en(e,w.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){const s=new en(e,w.empty(),t,r);return i?s.Ht():s}cn(e,t){const r=new ef(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const i=this.un(t);return m.forEach(i,s=>this.cn(e,s).next(o=>{o?0!==r&&o.fields.length<function(u){let l=new K(Z.comparator),c=!1;for(const d of u.filters)for(const f of d.getFlattenedFilters())f.field.isKeyField()||("array-contains"===f.op||"array-contains-any"===f.op?c=!0:l=l.add(f.field));for(const d of u.orderBy)d.field.isKeyField()||(l=l.add(d.field));return l.size+(c?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}dn(e,t){const r=new Yr;for(const i of zt(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const o=r.jt(i.kind);Xt.St.ht(s,o)}return r.Ut()}In(e){const t=new Yr;return Xt.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const r=new Yr;return Xt.St.ht(Kt(this.databaseId,t),r.jt(function(s){const o=zt(s);return 0===o.length?0:o[o.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(null===r)return[];let i=[];i.push(new Yr);let s=0;for(const o of zt(e)){const a=r[s++];for(const u of i)if(this.Rn(t,o.fieldPath)&&Mr(a))i=this.Vn(i,o,a);else{const l=u.jt(o.kind);Xt.St.ht(a,l)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const u=new Yr;u.seed(a.Ut()),Xt.St.ht(o,u.jt(t.kind)),s.push(u)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof L&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Jr(e),i=Ln(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{const o=[];return m.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(c,d){const f=d?new wn(d.sequenceNumber,new Fe(Yt(d.readTime),new w(He(d.documentKey)),d.largestBatchId)):wn.empty(),g=c.fields.map(([E,T])=>new jt(Z.fromServerFormat(E),T));return new An(c.indexId,c.collectionGroup,g,f)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:x(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=Jr(e),s=Ln(e);return this.fn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>m.forEach(a,u=>s.put(Hd(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return m.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),m.forEach(a,u=>this.gn(e,i,u).next(l=>{const c=this.pn(s,u);return l.isEqual(c)?m.resolve():this.yn(e,s,u,l,c)}))))})}wn(e,t,r,i){return On(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return On(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){const i=On(e);let s=new K(Ct);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(o,a)=>{s=s.add(new en(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}pn(e,t){let r=new K(Ct);const i=this.dn(t,e);if(null==i)return r;const s=ea(t);if(null!=s){const o=e.data.field(s.fieldPath);if(Mr(o))for(const a of o.arrayValue.values||[])r=r.add(new en(t.indexId,e.key,this.In(a),i))}else r=r.add(new en(t.indexId,e.key,ys,i));return r}yn(e,t,r,i,s){v("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(u,l,c,d,f){const g=u.getIterator(),E=l.getIterator();let T=Vn(g),I=Vn(E);for(;T||I;){let D=!1,N=!1;if(T&&I){const R=c(T,I);R<0?N=!0:R>0&&(D=!0)}else null!=T?N=!0:D=!0;D?(d(I),I=Vn(E)):N?(f(T),T=Vn(g)):(T=Vn(g),I=Vn(E))}}(i,s,Ct,a=>{o.push(this.wn(e,t,r,a))},a=>{o.push(this.Sn(e,t,r,a))}),m.waitFor(o)}fn(e){let t=1;return Ln(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Ct(o,a)).filter((o,a,u)=>!a||0!==Ct(o,u[a-1]));const i=[];i.push(e);for(const o of r){const a=Ct(o,e),u=Ct(o,t);if(0===a)i[0]=e.Ht();else if(a>0&&u<0)i.push(o),i.push(o.Ht());else if(u>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,ys,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,ys,[]]))}return s}bn(e,t){return Ct(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(of)}getMinOffset(e,t){return m.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||C())).next(of)}}function sf(n){return fe(n,"collectionParents")}function On(n){return fe(n,"indexEntries")}function Jr(n){return fe(n,"indexConfiguration")}function Ln(n){return fe(n,"indexState")}function of(n){S(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;ta(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Fe(e.readTime,e.documentKey,t)}const af={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ae{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ae(e,Ae.DEFAULT_COLLECTION_PERCENTILE,Ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function uf(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.J({range:o},(c,d,f)=>(a++,f.delete()));s.push(u.next(()=>{S(1===a)}));const l=[];for(const c of t.mutations){const d=Rh(e,c.key.path,t.batchId);s.push(i.delete(d)),l.push(c.key)}return m.waitFor(s).next(()=>l)}function vs(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw C();e=n.noDocument}return JSON.stringify(e).length}Ae.DEFAULT_COLLECTION_PERCENTILE=10,Ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ae.DEFAULT=new Ae(41943040,Ae.DEFAULT_COLLECTION_PERCENTILE,Ae.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ae.DISABLED=new Ae(-1,0,0);class Es{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){S(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Es(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return St(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=Bn(e),o=St(e);return o.add({}).next(a=>{S("number"==typeof a);const u=new ga(a,t,r,i),l=function(g,E,T){const I=T.baseMutations.map(N=>Wr(g.ut,N)),D=T.mutations.map(N=>Wr(g.ut,N));return{userId:E,batchId:T.batchId,localWriteTimeMs:T.localWriteTime.toMillis(),baseMutations:I,mutations:D}}(this.serializer,this.userId,u),c=[];let d=new K((f,g)=>x(f.canonicalString(),g.canonicalString()));for(const f of i){const g=Rh(this.userId,f.key.path,a);d=d.add(f.key.path.popLast()),c.push(o.put(l)),c.push(s.put(g,O_))}return d.forEach(f=>{c.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.Dn[a]=u.keys()}),m.waitFor(c).next(()=>u)})}lookupMutationBatch(e,t){return St(e).get(t).next(r=>r?(S(r.userId===this.userId),Jt(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?m.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return St(e).J({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(S(a.batchId>=r),s=Jt(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return St(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return St(e).U("userMutationsIndex",t).next(r=>r.map(i=>Jt(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=es(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Bn(e).J({range:i},(o,a,u)=>{const[l,c,d]=o,f=He(c);if(l===this.userId&&t.path.isEqual(f))return St(e).get(d).next(g=>{if(!g)throw C();S(g.userId===this.userId),s.push(Jt(this.serializer,g))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new K(x);const i=[];return t.forEach(s=>{const o=es(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=Bn(e).J({range:a},(l,c,d)=>{const[f,g,E]=l,T=He(g);f===this.userId&&s.path.isEqual(T)?r=r.add(E):d.done()});i.push(u)}),m.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=es(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new K(x);return Bn(e).J({range:o},(u,l,c)=>{const[d,f,g]=u,E=He(f);d===this.userId&&r.isPrefixOf(E)?E.length===i&&(a=a.add(g)):c.done()}).next(()=>this.vn(e,a))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(St(e).get(s).next(o=>{if(null===o)throw C();S(o.userId===this.userId),r.push(Jt(this.serializer,o))}))}),m.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return uf(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),m.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return m.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return Bn(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){const u=He(s[1]);i.push(u)}else a.done()}).next(()=>{S(0===i.length)})})}containsKey(e,t){return lf(e,this.userId,t)}Mn(e){return cf(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function lf(n,e,t){const r=es(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Bn(n).J({range:s,H:!0},(a,u,l)=>{const[c,d,f]=a;c===e&&d===i&&(o=!0),l.done()}).next(()=>o)}function St(n){return fe(n,"mutations")}function Bn(n){return fe(n,"documentMutations")}function cf(n){return fe(n,"mutationQueues")}class tn{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new tn(0)}static Nn(){return new tn(-1)}}class Zy{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next(t=>{const r=new tn(t.highestTargetId);return t.highestTargetId=r.next(),this.Bn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ln(e).next(t=>P.fromTimestamp(new X(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ln(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Ln(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Bn(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Ln(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Bn(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Un(e).delete(t.targetId)).next(()=>this.Ln(e)).next(r=>(S(r.targetCount>0),r.targetCount-=1,this.Bn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return Un(e).J((o,a)=>{const u=Hr(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>m.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Un(e).J((r,i)=>{const s=Hr(i);t(s)})}Ln(e){return hf(e).get("targetGlobalKey").next(t=>(S(null!==t),t))}Bn(e,t){return hf(e).put("targetGlobalKey",t)}kn(e,t){return Un(e).put(Qd(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Ln(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Qt(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Un(e).J({range:i,index:"queryTargetsIndex"},(o,a,u)=>{const l=Hr(a);Or(t,l.target)&&(s=l,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Rt(e);return t.forEach(o=>{const a=Te(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),m.waitFor(i)}removeMatchingKeys(e,t,r){const i=Rt(e);return m.forEach(t,s=>{const o=Te(s.path);return m.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Rt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Rt(e);let s=F();return i.J({range:r,H:!0},(o,a,u)=>{const l=He(o[1]),c=new w(l);s=s.add(c)}).next(()=>s)}containsKey(e,t){const r=Te(t.path),i=IDBKeyRange.bound([r],[yh(r)],!1,!0);let s=0;return Rt(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],u,l)=>{0!==o&&(s++,l.done())}).next(()=>s>0)}ot(e,t){return Un(e).get(t).next(r=>r?Hr(r):null)}}function Un(n){return fe(n,"targets")}function hf(n){return fe(n,"targetGlobal")}function Rt(n){return fe(n,"targetDocuments")}function df([n,e],[t,r]){const i=x(n,t);return 0===i?x(e,r):i}class Yy{constructor(e){this.Qn=e,this.buffer=new K(df),this.Kn=0}$n(){return++this.Kn}Un(e){const t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();df(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ff{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return null!==this.Wn}Gn(e){var t=this;v("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,_.Z)(function*(){t.Wn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){yt(r)?v("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield _t(r)}yield t.Gn(3e5)}))}}class Jy{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return m.resolve(ke.oe);const r=new Yy(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(af)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),af):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,o,a,u,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(l=Date.now(),In()<=je.in.DEBUG&&v("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-c}ms\n\tDetermined least recently used ${i} in `+(a-o)+`ms\n\tRemoved ${s} targets in `+(u-a)+`ms\n\tRemoved ${d} documents in `+(l-u)+`ms\nTotal Duration: ${l-c}ms`),m.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})))}}class Xy{constructor(e,t){this.db=e,this.garbageCollector=function mf(n,e){return new Jy(n,e)}(this,t)}jn(e){const t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return Is(e,r)}removeReference(e,t,r){return Is(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Is(e,t)}Xn(e,t){return function(i,s){let o=!1;return cf(i).Y(a=>lf(i,a,s).next(u=>(u&&(o=!0),m.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Zn(e,(o,a)=>{if(a<=t){const u=this.Xn(e,o).next(l=>{if(!l)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,P.min()),Rt(e).delete([0,Te(o.path)])))});i.push(u)}}).next(()=>m.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Is(e,t)}Zn(e,t){const r=Rt(e);let i,s=ke.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:l})=>{0===o?(s!==ke.oe&&t(new w(He(i)),s),s=l,i=u):s=ke.oe}).next(()=>{s!==ke.oe&&t(new w(He(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Is(n,e){return Rt(n).put((i=n.currentSequenceNumber,{targetId:0,path:Te(e.path),sequenceNumber:i}));var i}class gf{constructor(){this.changes=new at(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Y.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?m.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ev{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return nn(e).put(r)}removeEntry(e,t,r){return nn(e).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],gs(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=Y.newInvalidDocument(t);return nn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Xr(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:Y.newInvalidDocument(t)};return nn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Xr(t))},(i,s)=>{r={document:this.tr(t,s),size:vs(s)}}).next(()=>r)}getEntries(e,t){let r=Ne();return this.rr(e,t,(i,s)=>{const o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(e,t){let r=Ne(),i=new Q(w.comparator);return this.rr(e,t,(s,o)=>{const a=this.tr(s,o);r=r.insert(s,a),i=i.insert(s,vs(o))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return m.resolve();let i=new K(vf);t.forEach(u=>i=i.add(u));const s=IDBKeyRange.bound(Xr(i.first()),Xr(i.last())),o=i.getIterator();let a=o.getNext();return nn(e).J({index:"documentKeyIndex",range:s},(u,l,c)=>{const d=w.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;a&&vf(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,l),a=o.hasNext()?o.getNext():null),a?c.$(Xr(a)):c.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),gs(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return nn(e).U(IDBKeyRange.bound(a,u,!0)).next(l=>{s?.incrementDocumentReadCount(l.length);let c=Ne();for(const d of l){const f=this.tr(w.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);f.isFoundDocument()&&(Br(t,f)||i.has(f.key))&&(c=c.insert(f.key,f))}return c})}getAllFromCollectionGroup(e,t,r,i){let s=Ne();const o=yf(t,r),a=yf(t,Fe.max());return nn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,l,c)=>{const d=this.tr(w.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);s=s.insert(d.key,d),s.size===i&&c.done()}).next(()=>s)}newChangeBuffer(e){return new tv(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return _f(e).get("remoteDocumentGlobalKey").next(t=>(S(!!t),t))}er(e,t){return _f(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const r=function qy(n,e){let t;if(e.document)t=Bd(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=w.fromSegments(e.noDocument.path),i=Yt(e.noDocument.readTime);t=Y.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return C();{const r=w.fromSegments(e.unknownDocument.path),i=Yt(e.unknownDocument.version);t=Y.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new X(i[0],i[1]);return P.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(P.min()))return r}return Y.newInvalidDocument(e)}}function pf(n){return new ev(n)}class tv extends gf{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new at(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new K((s,o)=>x(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,a.readTime)),o.isValidDocument()){const u=Kd(this._r.serializer,o);i=i.add(s.path.popLast());const l=vs(u);r+=l-a.size,t.push(this._r.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){const u=Kd(this._r.serializer,o.convertToNoDocument(P.min()));t.push(this._r.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),m.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function _f(n){return fe(n,"remoteDocumentGlobal")}function nn(n){return fe(n,"remoteDocumentsV14")}function Xr(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function yf(n,e){const t=e.documentKey.path.toArray();return[n,gs(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function vf(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=x(t[s],r[s]),i)return i;return i=x(t.length,r.length),i||(i=x(t[t.length-2],r[r.length-2]),i||x(t[t.length-1],r[r.length-1]))}class nv{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ef{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&zr(r.mutation,i,be.empty(),X.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,F()).next(()=>r))}getLocalViewOfDocuments(e,t,r=F()){const i=Ye();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Ur();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Ye();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,F()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Ne();const o=qr(),a=qr();return t.forEach((u,l)=>{const c=r.get(l.key);i.has(l.key)&&(void 0===c||c.mutation instanceof ut)?s=s.insert(l.key,l):void 0!==c?(o.set(l.key,c.mutation.getFieldMask()),zr(c.mutation,l,c.mutation.getFieldMask(),X.now())):o.set(l.key,be.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((l,c)=>o.set(l,c)),t.forEach((l,c)=>{var d;return a.set(l,new nv(c,null!==(d=o.get(l))&&void 0!==d?d:null))}),a))}recalculateAndSaveOverlays(e,t){const r=qr();let i=new Q((o,a)=>o-a),s=F();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const l=t.get(u);if(null===l)return;let c=r.get(u)||be.empty();c=a.applyToLocalView(l,c),r.set(u,c);const d=(i.get(a.batchId)||F()).add(u);i=i.insert(a.batchId,d)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),l=u.key,c=u.value,d=ld();c.forEach(f=>{if(!s.has(f)){const g=yd(t.get(f),r.get(f));null!==g&&d.set(f,g),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,d))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return w.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ha(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i);var o}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):m.resolve(Ye());let a=-1,u=s;return o.next(l=>m.forEach(l,(c,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(c)?m.resolve():this.remoteDocumentCache.getEntry(e,c).next(f=>{u=u.insert(c,f)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,u,l,F())).next(c=>({batchId:a,changes:ud(c)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new w(t)).next(r=>{let i=Ur();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=Ur();return this.indexManager.getCollectionParents(e,s).next(a=>m.forEach(a,u=>{const l=(d=t,f=u.child(s),new ot(f,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt));var d,f;return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(c=>{c.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,l)=>{const c=l.getKey();null===o.get(c)&&(o=o.insert(c,Y.newInvalidDocument(c)))});let a=Ur();return o.forEach((u,l)=>{const c=s.get(u);void 0!==c&&zr(c.mutation,l,be.empty(),X.now()),Br(t,l)&&(a=a.insert(u,l))}),a})}}class rv{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return m.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,{id:(i=t).id,version:i.version,createTime:se(i.createTime)}),m.resolve();var i}getNamedQuery(e,t){return m.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,{name:(i=t).name,query:Va(i.bundledQuery),readTime:se(i.readTime)}),m.resolve();var i}}class iv{constructor(){this.overlays=new Q(w.comparator),this.lr=new Map}getOverlay(e,t){return m.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ye();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),m.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.lr.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),m.resolve()}getOverlaysForCollection(e,t,r){const i=Ye(),s=t.length+1,o=new w(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,l=u.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return m.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Q((l,c)=>l-c);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let c=s.get(l.largestBatchId);null===c&&(c=Ye(),s=s.insert(l.largestBatchId,c)),c.set(l.getKey(),l)}}const a=Ye(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((l,c)=>a.set(l,c)),!(a.size()>=i)););return m.resolve(a)}lt(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new _a(t,r));let s=this.lr.get(t);void 0===s&&(s=F(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}}class ba{constructor(){this.hr=new K(me.Pr),this.Ir=new K(me.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new me(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new me(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new w(new O([])),r=new me(t,e),i=new me(t,e+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new w(new O([])),r=new me(t,e),i=new me(t,e+1);let s=F();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new me(e,0),r=this.hr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class me{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return w.comparator(e.key,t.key)||x(e.gr,t.gr)}static Tr(e,t){return x(e.gr,t.gr)||w.comparator(e.key,t.key)}}class sv{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new K(me.Pr)}checkEmpty(e){return m.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.pr;this.pr++;const o=new ga(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.yr=this.yr.add(new me(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,t){return m.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.Sr(t+1),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new me(t,0),i=new me(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{const a=this.wr(o.gr);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new K(x);return t.forEach(i=>{const s=new me(i,0),o=new me(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),m.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;w.isDocumentKey(s)||(s=s.child(""));const o=new me(new w(s),0);let a=new K(x);return this.yr.forEachWhile(u=>{const l=u.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(a=a.add(u.gr)),!0)},o),m.resolve(this.br(a))}br(e){const t=[];return e.forEach(r=>{const i=this.wr(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){S(0===this.Dr(t.batchId,"removed")),this.mutationQueue.shift();let r=this.yr;return m.forEach(t.mutations,i=>{const s=new me(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new me(t,0),i=this.yr.firstAfterOrEqual(r);return m.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return m.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ov{constructor(e){this.Cr=e,this.docs=new Q(w.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return m.resolve(r?r.document.mutableCopy():Y.newInvalidDocument(t))}getEntries(e,t){let r=Ne();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Y.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ne();const o=t.path,a=new w(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:l,value:{document:c}}=u.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||ta(Eh(c),r)<=0||(i.has(c.key)||Br(t,c))&&(s=s.insert(c.key,c.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,t,r,i){C()}vr(e,t){return m.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new av(this)}getSize(e){return m.resolve(this.size)}}class av extends gf{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),m.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class uv{constructor(e){this.persistence=e,this.Fr=new at(t=>Qt(t),Or),this.lastRemoteSnapshotVersion=P.min(),this.highestTargetId=0,this.Mr=0,this.Or=new ba,this.targetCount=0,this.Nr=tn.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),m.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new tn(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,m.resolve()}updateTargetData(e,t){return this.kn(t),m.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return m.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),m.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),m.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return m.resolve(r)}containsKey(e,t){return m.resolve(this.Or.containsKey(t))}}class Na{constructor(e,t){this.Lr={},this.overlays={},this.Br=new ke(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new uv(this),this.indexManager=new Wy,this.remoteDocumentCache=new ov(r=>this.referenceDelegate.Qr(r)),this.serializer=new $d(t),this.Kr=new rv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new iv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Lr[e.toKey()];return r||(r=new sv(t,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){v("MemoryPersistence","Starting transaction:",e);const i=new lv(this.Br.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return m.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,t)))}}class lv extends Th{constructor(e){super(),this.currentSequenceNumber=e}}class Ts{constructor(e){this.persistence=e,this.Gr=new ba,this.zr=null}static jr(e){return new Ts(e)}get Hr(){if(this.zr)return this.zr;throw C()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),m.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),m.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.Hr,r=>{const i=w.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,P.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return m.or([()=>m.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class cv{constructor(e){this.serializer=e}O(e,t,r,i){const s=new Xi("createOrUpgrade",t);var u;r<1&&i>=1&&(e.createObjectStore("owner"),(u=e).createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Sh,{unique:!0}),u.createObjectStore("documentMutations"),If(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=m.resolve();return r<3&&i>=3&&(0!==r&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),If(e)),o=o.next(()=>function(u){const l=u.store("targetGlobal"),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:P.min().toTimestamp(),targetCount:0};return l.put("targetGlobalKey",c)}(s))),r<4&&i>=4&&(0!==r&&(o=o.next(()=>function(u,l){return l.store("mutations").U().next(c=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Sh,{unique:!0});const d=l.store("mutations"),f=c.map(g=>d.put(g));return m.waitFor(f)})}(e,s))),o=o.next(()=>{!function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(e,s))),r<9&&i>=9&&(o=o.next(()=>{!function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{!function(u){const l=u.createObjectStore("documentOverlays",{keyPath:H_});l.createIndex("collectionPathOverlayIndex",Z_,{unique:!1}),l.createIndex("collectionGroupOverlayIndex",Y_,{unique:!1})}(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){const l=u.createObjectStore("remoteDocumentsV14",{keyPath:L_});l.createIndex("documentKeyIndex",B_),l.createIndex("collectionGroupIndex",U_)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:$_}).createIndex("sequenceNumberIndex",K_,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:Q_}).createIndex("documentKeyIndex",W_,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),o}Xr(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=vs(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>m.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>m.forEach(a,u=>{S(u.userId===s.userId);const l=Jt(this.serializer,u);return uf(e,s.userId,l).next(()=>{})}))}))}ei(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.J((o,a)=>{const u=new O(o),l=[0,Te(u)];s.push(t.get(l).next(c=>c?m.resolve():t.put({targetId:0,path:Te(u),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>m.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:j_});const r=t.store("collectionParents"),i=new xa,s=o=>{if(i.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Te(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const u=new O(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],l)=>{const c=He(a);return s(c.popLast())}))}ni(e){const t=e.store("targets");return t.J((r,i)=>{const s=Hr(i),o=Qd(this.serializer,s);return t.put(o)})}ri(e,t){const r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{const a=t.store("remoteDocumentsV14"),u=(d=o,d.document?new w(O.fromString(d.document.name).popFirst(5)):d.noDocument?w.fromSegments(d.noDocument.path):d.unknownDocument?w.fromSegments(d.unknownDocument.path):C()).path.toArray(),l={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};var d;i.push(a.put(l))}).next(()=>m.waitFor(i))}ii(e,t){const r=t.store("mutations"),i=pf(this.serializer),s=new Na(Ts.jr,this.serializer.ut);return r.U().next(o=>{const a=new Map;return o.forEach(u=>{var l;let c=null!==(l=a.get(u.userId))&&void 0!==l?l:F();Jt(this.serializer,u).keys().forEach(d=>c=c.add(d)),a.set(u.userId,c)}),m.forEach(a,(u,l)=>{const c=new de(l),d=ps.ct(this.serializer,c),f=s.getIndexManager(c),g=Es.ct(c,this.serializer,f,s.referenceDelegate);return new Ef(i,g,d,f).recalculateAndSaveOverlaysForDocumentKeys(new ia(t,ke.oe),u).next()})})}}function If(n){n.createObjectStore("targetDocuments",{keyPath:G_}).createIndex("documentTargetsIndex",z_,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",q_,{unique:!0}),n.createObjectStore("targetGlobal")}const Ma="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Fa{constructor(e,t,r,i,s,o,a,u,l,c,d=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=o,this.document=a,this.oi=l,this._i=c,this.ai=d,this.Br=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=f=>Promise.resolve(),!Fa.D())throw new y(p.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Xy(this,i),this.Ii=t+"main",this.serializer=new $d(u),this.Ti=new We(this.Ii,this.ai,new cv(this.serializer)),this.qr=new Zy(this.referenceDelegate,this.serializer),this.remoteDocumentCache=pf(this.serializer),this.Kr=new Gy,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,!1===c&&ie("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(p.FAILED_PRECONDITION,Ma);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Br=new ke(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){var t=this;return this.Pi=function(){var r=(0,_.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(function(){var t=(0,_.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget((0,_.Z)(function*(){t.started&&(yield t.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ws(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(yt(e))return v("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return v("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return ei(e).get("owner").next(t=>m.resolve(this.wi(t)))}Si(e){return ws(e).delete(this.clientId)}bi(){var e=this;return(0,_.Z)(function*(){if(e.isPrimary&&!e.Di(e.hi,18e5)){e.hi=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=fe(r,"clientMetadata");return i.U().next(s=>{const o=e.Ci(s,18e5),a=s.filter(u=>-1===o.indexOf(u));return m.forEach(a,u=>i.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.Ei)for(const r of t)e.Ei.removeItem(e.vi(r.clientId))}})()}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?m.resolve(!0):ei(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new y(p.FAILED_PRECONDITION,Ma);return!1}}return!(!this.networkEnabled||!this.inForeground)||ws(e).U().next(r=>void 0===this.Ci(r,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&v("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,_.Z)(function*(){e.kr=!1,e.Mi(),e.li&&(e.li.cancel(),e.li=null),e.xi(),e.Oi(),yield e.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new ia(t,ke.oe);return e.pi(r).next(()=>e.Si(r))}),e.Ti.close(),e.Ni()})()}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",e=>ws(e).U().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return Es.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Hy(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return ps.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){v("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=16===(u=this.ai)?X_:15===u?bh:14===u?xh:13===u?Dh:12===u?J_:11===u?Ph:void C();var u;let o;return this.Ti.runTransaction(e,i,s,a=>(o=new ia(a,this.Br?this.Br.next():ke.oe),"readwrite-primary"===t?this.fi(o).next(u=>!!u||this.gi(o)).next(u=>{if(!u)throw ie(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new y(p.FAILED_PRECONDITION,Ih);return r(o)}).next(u=>this.yi(o).next(()=>u)):this.Bi(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Bi(e){return ei(e).get("owner").next(t=>{if(null!==t&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(p.FAILED_PRECONDITION,Ma)})}yi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ei(e).put("owner",t)}static D(){return We.D()}pi(e){const t=ei(e);return t.get("owner").next(r=>this.wi(r)?(v("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):m.resolve())}Di(e,t){const r=Date.now();return!(e<r-t||e>r&&(ie(`Detected an update time that is in the future: ${e} > ${r}`),1))}Ai(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;(0,G.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{const r=null!==(null===(t=this.Ei)||void 0===t?void 0:t.getItem(this.vi(e)));return v("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ie("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){ie("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ei(n){return fe(n,"owner")}function ws(n){return fe(n,"clientMetadata")}function ka(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Oa{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=F(),i=F();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Oa(e,t.fromCache,r,i)}}class hv{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Tf{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=(0,G.G6)()?8:Ah((0,G.z$)())>0?6:4}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.zi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new hv;return this.Hi(e,t,o).next(a=>{if(s.result=a,this.$i)return this.Ji(e,t,o,a.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(In()<=je.in.DEBUG&&v("QueryEngine","SDK will not create cache indexes for query:",Dn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),m.resolve()):(In()<=je.in.DEBUG&&v("QueryEngine","Query:",Dn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(In()<=je.in.DEBUG&&v("QueryEngine","The SDK decides to create cache indexes for query:",Dn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Se(t))):m.resolve())}zi(e,t){if(nd(t))return m.resolve(null);let r=Se(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=ls(t,null,"F"),r=Se(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=F(...s);return this.Gi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const l=this.Yi(t,a);return this.Zi(t,l,o,u.readTime)?this.zi(e,ls(t,null,"F")):this.Xi(e,l,t,u)}))})))}ji(e,t,r,i){return nd(t)||i.isEqual(P.min())?m.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const o=this.Yi(t,s);return this.Zi(t,o,r,i)?m.resolve(null):(In()<=je.in.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Dn(t)),this.Xi(e,o,t,vh(i,-1)).next(a=>a))})}Yi(e,t){let r=new K(od(e));return t.forEach((i,s)=>{Br(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return In()<=je.in.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",Dn(t)),this.Gi.getDocumentsMatchingQuery(e,t,Fe.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class dv{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new Q(x),this.ns=new at(s=>Qt(s),Or),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ef(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function Af(n,e,t,r){return new dv(n,e,t,r)}function wf(n,e){return La.apply(this,arguments)}function La(){return La=(0,_.Z)(function*(n,e){const t=A(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let u=F();for(const l of i){o.push(l.batchId);for(const c of l.mutations)u=u.add(c.key)}for(const l of s){a.push(l.batchId);for(const c of l.mutations)u=u.add(c.key)}return t.localDocuments.getDocuments(r,u).next(l=>({_s:l,removedBatchIds:o,addedBatchIds:a}))})})}),La.apply(this,arguments)}function Vf(n){const e=A(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function Cf(n,e,t){let r=F(),i=F();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Ne();return t.forEach((a,u)=>{const l=s.get(a);u.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(P.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!l.isValidDocument()||u.version.compareTo(l.version)>0||0===u.version.compareTo(l.version)&&l.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):v("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",u.version)}),{us:o,cs:i}})}function gv(n,e){const t=A(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function qn(n,e){const t=A(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):t.qr.allocateTargetId(r).next(o=>(i=new lt(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ts.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}function Gn(n,e,t){return Ba.apply(this,arguments)}function Ba(){return Ba=(0,_.Z)(function*(n,e,t){const r=A(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!yt(o))throw o;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}),Ba.apply(this,arguments)}function Vs(n,e,t){const r=A(n);let i=P.min(),s=F();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,l,c){const d=A(u),f=d.ns.get(c);return void 0!==f?m.resolve(d.ts.get(f)):d.qr.getTargetData(l,c)}(r,o,Se(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,t?i:P.min(),t?s:F())).next(a=>(Pf(r,sd(e),a),{documents:a,ls:s})))}function Sf(n,e){const t=A(n),r=A(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function Rf(n,e){const t=A(n),r=t.rs.get(e)||P.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,vh(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Pf(t,e,i),i))}function Pf(n,e,t){let r=n.rs.get(e)||P.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}function Ua(){return Ua=(0,_.Z)(function*(n,e,t,r){const i=A(n);let s=F(),o=Ne();for(const l of t){const c=e.hs(l.metadata.name);l.document&&(s=s.add(c));const d=e.Ps(l);d.setReadTime(e.Is(l.metadata.readTime)),o=o.insert(c,d)}const a=i.ss.newChangeBuffer({trackRemovals:!0}),u=yield qn(i,(c=r,Se(Rn(O.fromString(`__bundle__/docs/${c}`)))));var c;return i.persistence.runTransaction("Apply bundle documents","readwrite",l=>Cf(l,a,o).next(c=>(a.apply(l),c)).next(c=>i.qr.removeMatchingKeysForTargetId(l,u.targetId).next(()=>i.qr.addMatchingKeys(l,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(l,c.us,c.cs)).next(()=>c.us)))}),Ua.apply(this,arguments)}function _v(n,e){return qa.apply(this,arguments)}function qa(){return qa=(0,_.Z)(function*(n,e,t=F()){const r=yield qn(n,Se(Va(e.bundledQuery))),i=A(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=se(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Kr.saveNamedQuery(s,e);const a=r.withResumeToken(le.EMPTY_BYTE_STRING,o);return i.ts=i.ts.insert(a.targetId,a),i.qr.updateTargetData(s,a).next(()=>i.qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Kr.saveNamedQuery(s,e))})}),qa.apply(this,arguments)}function Df(n,e){return`firestore_clients_${n}_${e}`}function xf(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Ga(n,e){return`firestore_targets_${n}_${e}`}class Cs{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){const i=JSON.parse(r);let s,o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code,o&&(s=new y(i.error.code,i.error.message))),o?new Cs(e,t,i.state,s):(ie("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ti{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new y(r.error.code,r.error.message))),s?new ti(e,r.state,i):(ie("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ss{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=fa();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Vh(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new Ss(e,s):(ie("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class za{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new za(t.clientId,t.onlineState):(ie("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ja{constructor(){this.activeTargetIds=fa()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class $a{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new Q(x),this.started=!1,this.ps=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=Df(this.persistenceKey,this.Rs),this.ws=`firestore_sequence_number_${this.persistenceKey}`,this.gs=this.gs.insert(this.Rs,new ja),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=`firestore_online_state_${this.persistenceKey}`,this.vs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,_.Z)(function*(){const t=yield e.syncEngine.Li();for(const i of t){if(i===e.Rs)continue;const s=e.getItem(Df(e.persistenceKey,i));if(s){const o=Ss.Ts(i,s);o&&(e.gs=e.gs.insert(o.clientId,o))}}e.Fs();const r=e.storage.getItem(e.Cs);if(r){const i=e.Ms(r);i&&e.xs(i)}for(const i of e.ps)e.fs(i);e.ps=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Ga(this.persistenceKey,e));if(r){const i=ti.Ts(e,r);i&&(t=i.state)}}return this.Bs.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Bs.As(e),this.Fs()}isLocalQueryTarget(e){return this.Bs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ga(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Ls(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return v("SharedClientState","READ",e,t),t}setItem(e,t){v("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){v("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){var t=this;const r=e;if(r.storageArea===this.storage){if(v("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ys)return void ie("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable((0,_.Z)(function*(){if(t.started){if(null!==r.key)if(t.Ss.test(r.key)){if(null==r.newValue){const i=t.Ks(r.key);return t.$s(i,null)}{const i=t.Us(r.key,r.newValue);if(i)return t.$s(i.clientId,i)}}else if(t.bs.test(r.key)){if(null!==r.newValue){const i=t.Ws(r.key,r.newValue);if(i)return t.Gs(i)}}else if(t.Ds.test(r.key)){if(null!==r.newValue){const i=t.zs(r.key,r.newValue);if(i)return t.js(i)}}else if(r.key===t.Cs){if(null!==r.newValue){const i=t.Ms(r.newValue);if(i)return t.xs(i)}}else if(r.key===t.ws){const i=function(o){let a=ke.oe;if(null!=o)try{const u=JSON.parse(o);S("number"==typeof u),a=u}catch(u){ie("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(r.newValue);i!==ke.oe&&t.sequenceNumberHandler(i)}else if(r.key===t.vs){const i=t.Hs(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Js(s)))}}else t.ps.push(r)}))}}get Bs(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Bs.Es())}Ns(e,t,r){const i=new Cs(this.currentUser,e,t,r),s=xf(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Ls(e){const t=xf(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){this.storage.setItem(this.Cs,JSON.stringify({clientId:this.Rs,onlineState:e}))}ks(e,t,r){const i=Ga(this.persistenceKey,e),s=new ti(e,t,r);this.setItem(i,s.Es())}Qs(e){const t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){const t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){const r=this.Ks(e);return Ss.Ts(r,t)}Ws(e,t){const r=this.bs.exec(e),i=Number(r[1]);return Cs.Ts(new de(void 0!==r[2]?r[2]:null),i,t)}zs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return ti.Ts(i,t)}Ms(e){return za.Ts(e)}Hs(e){return JSON.parse(e)}Gs(e){var t=this;return(0,_.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Ys(e.batchId,e.state,e.error);v("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.Xs(o,a).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=fa();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class bf{constructor(){this.eo=new ja,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new ja,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class yv{ro(e){}shutdown(){}}class Nf{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Rs=null;function Ka(){return null===Rs?Rs=268435456+Math.round(2147483648*Math.random()):Rs++,"0x"+Rs.toString(16)}const vv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ev{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}Eo(e){this.Ao=e}onMessage(e){this.Ro=e}close(){this.lo()}send(e){this.co(e)}Vo(){this.Po()}mo(){this.To()}fo(e){this.Ao(e)}po(e){this.Ro(e)}}const we="WebChannelConnection";class Iv extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.yo=r+"://"+t.host,this.wo=`projects/${i}/databases/${s}`,this.So="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get bo(){return!1}Do(t,r,i,s,o){const a=Ka(),u=this.Co(t,r.toUriEncodedString());v("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);const l={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(l,s,o),this.Fo(t,u,l,i).then(c=>(v("RestConnection",`Received RPC '${t}' ${a}: `,c),c),c=>{throw xe("RestConnection",`RPC '${t}' ${a} failed with error: `,c,"url: ",u,"request:",i),c})}Mo(t,r,i,s,o,a){return this.Do(t,r,i,s,o)}vo(t,r,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+En,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}Co(t,r){return`${this.yo}/v1/${r}:${vv[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Fo(e,t,r,i){const s=Ka();return new Promise((o,a)=>{const u=new y_;u.setWithCredentials(!0),u.listenOnce(g_.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Jo.NO_ERROR:const c=u.getResponseJson();v(we,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(c)),o(c);break;case Jo.TIMEOUT:v(we,`RPC '${e}' ${s} timed out`),a(new y(p.DEADLINE_EXCEEDED,"Request time out"));break;case Jo.HTTP_ERROR:const d=u.getStatus();if(v(we,`RPC '${e}' ${s} failed with status:`,d,"response text:",u.getResponseText()),d>0){let f=u.getResponseJson();Array.isArray(f)&&(f=f[0]);const g=f?.error;if(g&&g.status&&g.message){const E=function(I){const D=I.toLowerCase().replace(/_/g,"-");return Object.values(p).indexOf(D)>=0?D:p.UNKNOWN}(g.status);a(new y(E,g.message))}else a(new y(p.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new y(p.UNAVAILABLE,"Connection failed."));break;default:C()}}finally{v(we,`RPC '${e}' ${s} completed.`)}});const l=JSON.stringify(i);v(we,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",l,r,15)})}xo(e,t,r){const i=Ka(),s=[this.yo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=f_(),a=m_(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(u.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(u.xmlHttpFactory=new __({})),this.vo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const c=s.join("");v(we,`Creating RPC '${e}' stream ${i}: ${c}`,u);const d=o.createWebChannel(c,u);let f=!1,g=!1;const E=new Ev({co:I=>{g?v(we,`Not sending because RPC '${e}' stream ${i} is closed:`,I):(f||(v(we,`Opening RPC '${e}' stream ${i} transport.`),d.open(),f=!0),v(we,`RPC '${e}' stream ${i} sending:`,I),d.send(I))},lo:()=>d.close()}),T=(I,D,N)=>{I.listen(D,R=>{try{N(R)}catch(M){setTimeout(()=>{throw M},0)}})};return T(d,Ji.EventType.OPEN,()=>{g||(v(we,`RPC '${e}' stream ${i} transport opened.`),E.Vo())}),T(d,Ji.EventType.CLOSE,()=>{g||(g=!0,v(we,`RPC '${e}' stream ${i} transport closed`),E.fo())}),T(d,Ji.EventType.ERROR,I=>{g||(g=!0,xe(we,`RPC '${e}' stream ${i} transport errored:`,I),E.fo(new y(p.UNAVAILABLE,"The operation could not be completed")))}),T(d,Ji.EventType.MESSAGE,I=>{var D;if(!g){const N=I.data[0];S(!!N);const M=N.error||(null===(D=N[0])||void 0===D?void 0:D.error);if(M){v(we,`RPC '${e}' stream ${i} received error:`,M);const q=M.status;let z=function(nA){const hp=ae[nA];if(void 0!==hp)return wd(hp)}(q),oe=M.message;void 0===z&&(z=p.INTERNAL,oe="Unknown error status: "+q+" with message "+M.message),g=!0,E.fo(new y(z,oe)),d.close()}else v(we,`RPC '${e}' stream ${i} received:`,N),E.po(N)}}),T(a,p_.STAT_EVENT,I=>{I.stat===fh.PROXY?v(we,`RPC '${e}' stream ${i} detected buffering proxy`):I.stat===fh.NOPROXY&&v(we,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.mo()},0),E}}function Mf(){return typeof window<"u"?window:null}function Ps(){return typeof document<"u"?document:null}function ni(n){return new xy(n,!0)}class Qa{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Oo=r,this.No=i,this.Lo=s,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(e){this.cancel();const t=Math.floor(this.Bo+this.$o()),r=Math.max(0,Date.now()-this.qo),i=Math.max(0,t-r);i>0&&v("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.qo=Date.now(),e())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){null!==this.ko&&(this.ko.skipDelay(),this.ko=null)}cancel(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}}class Ff{constructor(e,t,r,i,s,o,a,u){this.si=e,this.Wo=r,this.Go=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new Qa(e,t)}Yo(){return 1===this.state||5===this.state||this.Zo()}Zo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Xo()}stop(){var e=this;return(0,_.Z)(function*(){e.Yo()&&(yield e.close(0))})()}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&null===this.jo&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,()=>this.n_()))}r_(e){this.i_(),this.stream.send(e)}n_(){var e=this;return(0,_.Z)(function*(){if(e.Zo())return e.close(0)})()}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}close(e,t){var r=this;return(0,_.Z)(function*(){r.i_(),r.s_(),r.Jo.cancel(),r.zo++,4!==e?r.Jo.reset():t&&t.code===p.RESOURCE_EXHAUSTED?(ie(t.toString()),ie("Using maximum backoff delay to prevent overloading the backend."),r.Jo.Qo()):t&&t.code===p.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.o_(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Eo(t)})()}o_(){}auth(){this.state=1;const e=this.__(this.zo),t=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.zo===t&&this.a_(r,i)},r=>{e(()=>{const i=new y(p.UNKNOWN,"Fetching auth token failed: "+r.message);return this.u_(i)})})}a_(e,t){const r=this.__(this.zo);this.stream=this.c_(e,t),this.stream.ho(()=>{r(()=>this.listener.ho())}),this.stream.Io(()=>{r(()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,()=>(this.Zo()&&(this.state=3),Promise.resolve())),this.listener.Io()))}),this.stream.Eo(i=>{r(()=>this.u_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Xo(){var e=this;this.state=5,this.Jo.Ko((0,_.Z)(function*(){e.state=0,e.start()}))}u_(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}__(e){return t=>{this.si.enqueueAndForget(()=>this.zo===e?t():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Tv extends Ff{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}c_(e,t){return this.connection.xo("Listen",e,t)}onMessage(e){this.Jo.reset();const t=function My(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(l=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===l?1:"REMOVE"===l?2:"CURRENT"===l?3:"RESET"===l?4:C(),i=e.targetChange.targetIds||[],s=function(l,c){return l.useProto3Json?(S(void 0===c||"string"==typeof c),le.fromBase64String(c||"")):(S(void 0===c||c instanceof Buffer||c instanceof Uint8Array),le.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const c=void 0===l.code?p.UNKNOWN:wd(l.code);return new y(c,l.message||"")}(o);t=new Pd(r,i,s,a||null)}else if("documentChange"in e){const r=e.documentChange,i=Je(n,r.document.name),s=se(r.document.updateTime),o=r.document.createTime?se(r.document.createTime):P.min(),a=new ye({mapValue:{fields:r.document.fields}}),u=Y.newFoundDocument(i,s,o,a);t=new ms(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,i=Je(n,r.document),s=r.readTime?se(r.readTime):P.min(),o=Y.newNoDocument(i,s);t=new ms([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,i=Je(n,r.document);t=new ms([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return C();{const r=e.filter,{count:i=0,unchangedNames:s}=r,o=new Vy(i,s);t=new Rd(r.targetId,o)}}var l;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return P.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?P.min():o.readTime?se(o.readTime):P.min()}(e);return this.listener.l_(t,r)}h_(e){const t={};t.database=Ta(this.serializer),t.addTarget=function(s,o){let a;const u=o.target;if(a=as(u)?{documents:Ud(s,u)}:{query:wa(s,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Nd(s,o.resumeToken);const l=va(s,o.expectedCount);null!==l&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(P.min())>0){a.readTime=Fn(s,o.snapshotVersion.toTimestamp());const l=va(s,o.expectedCount);null!==l&&(a.expectedCount=l)}return a}(this.serializer,e);const r=function ky(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return C()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.r_(t)}P_(e){const t={};t.database=Ta(this.serializer),t.removeTarget=e,this.r_(t)}}class Av extends Ff{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(e,t){return this.connection.xo("Write",e,t)}onMessage(e){if(S(!!e.streamToken),this.lastStreamToken=e.streamToken,this.I_){this.Jo.reset();const t=function Fy(n,e){return n&&n.length>0?(S(void 0!==e),n.map(t=>function(i,s){let o=se(i.updateTime?i.updateTime:s);return o.isEqual(P.min())&&(o=se(s)),new Iy(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=se(e.commitTime);return this.listener.d_(r,t)}return S(!e.writeResults||0===e.writeResults.length),this.I_=!0,this.listener.A_()}R_(){const e={};e.database=Ta(this.serializer),this.r_(e)}E_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Wr(this.serializer,r))};this.r_(t)}}class wv extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.V_=!1}m_(){if(this.V_)throw new y(p.FAILED_PRECONDITION,"The client has already been terminated.")}Do(e,t,r,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Do(e,Ia(t,r),i,s,o)).catch(s=>{throw"FirebaseError"===s.name?(s.code===p.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(p.UNKNOWN,s.toString())})}Mo(e,t,r,i,s){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Mo(e,Ia(t,r),i,o,a,s)).catch(o=>{throw"FirebaseError"===o.name?(o.code===p.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new y(p.UNKNOWN,o.toString())})}terminate(){this.V_=!0,this.connection.terminate()}}class Cv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(ie(t),this.y_=!1):v("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class Sv{constructor(e,t,r,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.ro(a=>{r.enqueueAndForget((0,_.Z)(function*(){var u;Pt(o)&&(v("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,_.Z)(function*(c){const d=A(c);d.M_.add(4),yield zn(d),d.N_.set("Unknown"),d.M_.delete(4),yield ri(d)}),function l(c){return u.apply(this,arguments)})(o))}))}),this.N_=new Cv(r,i)}}function ri(n){return Ha.apply(this,arguments)}function Ha(){return Ha=(0,_.Z)(function*(n){if(Pt(n))for(const e of n.x_)yield e(!0)}),Ha.apply(this,arguments)}function zn(n){return Za.apply(this,arguments)}function Za(){return Za=(0,_.Z)(function*(n){for(const e of n.x_)yield e(!1)}),Za.apply(this,arguments)}function Ds(n,e){const t=A(n);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),Xa(t)?Ja(t):Kn(t).Zo()&&Ya(t,e))}function jn(n,e){const t=A(n),r=Kn(t);t.F_.delete(e),r.Zo()&&kf(t,e),0===t.F_.size&&(r.Zo()?r.t_():Pt(t)&&t.N_.set("Unknown"))}function Ya(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(P.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Kn(n).h_(e)}function kf(n,e){n.L_.xe(e),Kn(n).P_(e)}function Ja(n){n.L_=new Sy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Kn(n).start(),n.N_.w_()}function Xa(n){return Pt(n)&&!Kn(n).Yo()&&n.F_.size>0}function Pt(n){return 0===A(n).M_.size}function Of(n){n.L_=void 0}function Rv(n){return eu.apply(this,arguments)}function eu(){return eu=(0,_.Z)(function*(n){n.N_.set("Online")}),eu.apply(this,arguments)}function Pv(n){return tu.apply(this,arguments)}function tu(){return tu=(0,_.Z)(function*(n){n.F_.forEach((e,t)=>{Ya(n,e)})}),tu.apply(this,arguments)}function Dv(n,e){return nu.apply(this,arguments)}function nu(){return nu=(0,_.Z)(function*(n,e){Of(n),Xa(n)?(n.N_.D_(e),Ja(n)):n.N_.set("Unknown")}),nu.apply(this,arguments)}function xv(n,e,t){return ru.apply(this,arguments)}function ru(){return ru=(0,_.Z)(function*(n,e,t){if(n.N_.set("Online"),e instanceof Pd&&2===e.state&&e.cause)try{yield(r=(0,_.Z)(function*(s,o){const a=o.cause;for(const u of o.targetIds)s.F_.has(u)&&(yield s.remoteSyncer.rejectListen(u,a),s.F_.delete(u),s.L_.removeTarget(u))}),function i(s,o){return r.apply(this,arguments)})(n,e)}catch(r){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield xs(n,r)}else if(e instanceof ms?n.L_.Ke(e):e instanceof Rd?n.L_.He(e):n.L_.We(e),!t.isEqual(P.min()))try{const r=yield Vf(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){const a=s.L_.rt(o);return a.targetChanges.forEach((u,l)=>{if(u.resumeToken.approximateByteSize()>0){const c=s.F_.get(l);c&&s.F_.set(l,c.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,l)=>{const c=s.F_.get(u);if(!c)return;s.F_.set(u,c.withResumeToken(le.EMPTY_BYTE_STRING,c.snapshotVersion)),kf(s,u);const d=new lt(c.target,u,l,c.sequenceNumber);Ya(s,d)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){v("RemoteStore","Failed to raise snapshot:",r),yield xs(n,r)}var r}),ru.apply(this,arguments)}function xs(n,e,t){return iu.apply(this,arguments)}function iu(){return iu=(0,_.Z)(function*(n,e,t){if(!yt(e))throw e;n.M_.add(1),yield zn(n),n.N_.set("Offline"),t||(t=()=>Vf(n.localStore)),n.asyncQueue.enqueueRetryable((0,_.Z)(function*(){v("RemoteStore","Retrying IndexedDB access"),yield t(),n.M_.delete(1),yield ri(n)}))}),iu.apply(this,arguments)}function Lf(n,e){return e().catch(t=>xs(n,t,e))}function $n(n){return su.apply(this,arguments)}function su(){return su=(0,_.Z)(function*(n){const e=A(n),t=Dt(e);let r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;bv(e);)try{const i=yield gv(e.localStore,r);if(null===i){0===e.v_.length&&t.t_();break}r=i.batchId,Nv(e,i)}catch(i){yield xs(e,i)}Bf(e)&&Uf(e)}),su.apply(this,arguments)}function bv(n){return Pt(n)&&n.v_.length<10}function Nv(n,e){n.v_.push(e);const t=Dt(n);t.Zo()&&t.T_&&t.E_(e.mutations)}function Bf(n){return Pt(n)&&!Dt(n).Yo()&&n.v_.length>0}function Uf(n){Dt(n).start()}function Mv(n){return ou.apply(this,arguments)}function ou(){return ou=(0,_.Z)(function*(n){Dt(n).R_()}),ou.apply(this,arguments)}function Fv(n){return au.apply(this,arguments)}function au(){return au=(0,_.Z)(function*(n){const e=Dt(n);for(const t of n.v_)e.E_(t.mutations)}),au.apply(this,arguments)}function kv(n,e,t){return uu.apply(this,arguments)}function uu(){return uu=(0,_.Z)(function*(n,e,t){const r=n.v_.shift(),i=pa.from(r,e,t);yield Lf(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield $n(n)}),uu.apply(this,arguments)}function Ov(n,e){return lu.apply(this,arguments)}function lu(){return lu=(0,_.Z)(function*(n,e){var t;e&&Dt(n).T_&&(yield(t=(0,_.Z)(function*(i,s){if(Ad(a=s.code)&&a!==p.ABORTED){const o=i.v_.shift();Dt(i).e_(),yield Lf(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield $n(i)}var a}),function r(i,s){return t.apply(this,arguments)})(n,e)),Bf(n)&&Uf(n)}),lu.apply(this,arguments)}function qf(n,e){return cu.apply(this,arguments)}function cu(){return cu=(0,_.Z)(function*(n,e){const t=A(n);t.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");const r=Pt(t);t.M_.add(3),yield zn(t),r&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield ri(t)}),cu.apply(this,arguments)}function hu(n,e){return du.apply(this,arguments)}function du(){return du=(0,_.Z)(function*(n,e){const t=A(n);e?(t.M_.delete(2),yield ri(t)):e||(t.M_.add(2),yield zn(t),t.N_.set("Unknown"))}),du.apply(this,arguments)}function Kn(n){return n.B_||(n.B_=function(t,r,i){const s=A(t);return s.m_(),new Tv(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:Rv.bind(null,n),Io:Pv.bind(null,n),Eo:Dv.bind(null,n),l_:xv.bind(null,n)}),n.x_.push(function(){var e=(0,_.Z)(function*(t){t?(n.B_.e_(),Xa(n)?Ja(n):n.N_.set("Unknown")):(yield n.B_.stop(),Of(n))});return function(t){return e.apply(this,arguments)}}())),n.B_}function Dt(n){return n.k_||(n.k_=function(t,r,i){const s=A(t);return s.m_(),new Av(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:()=>Promise.resolve(),Io:Mv.bind(null,n),Eo:Ov.bind(null,n),A_:Fv.bind(null,n),d_:kv.bind(null,n)}),n.x_.push(function(){var e=(0,_.Z)(function*(t){t?(n.k_.e_(),yield $n(n)):(yield n.k_.stop(),n.v_.length>0&&(v("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))});return function(t){return e.apply(this,arguments)}}())),n.k_}class fu{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ue,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new fu(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new y(p.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Qn(n,e){if(ie("AsyncQueue",`${e}: ${n}`),yt(n))return new y(p.UNAVAILABLE,`${e}: ${n}`);throw n}class Wn{constructor(e){this.comparator=e?(t,r)=>e(t,r)||w.comparator(t.key,r.key):(t,r)=>w.comparator(t.key,r.key),this.keyedMap=Ur(),this.sortedSet=new Q(this.comparator)}static emptySet(e){return new Wn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Wn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Wn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Gf{constructor(){this.q_=new Q(w.comparator)}track(e){const t=e.doc.key,r=this.q_.get(t);r?0!==e.type&&3===r.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==r.type?this.q_=this.q_.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.q_=this.q_.remove(t):1===e.type&&2===r.type?this.q_=this.q_.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):C():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Hn{constructor(e,t,r,i,s,o,a,u,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Hn(e,t,Wn.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Lr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class Lv{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class Bv{constructor(){this.queries=new at(e=>id(e),Lr),this.onlineState="Unknown",this.z_=new Set}}function mu(n,e){return gu.apply(this,arguments)}function gu(){return gu=(0,_.Z)(function*(n,e){const t=A(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new Lv,r=e.G_()?0:1);try{switch(r){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){const a=Qn(o,`Initialization of query '${Dn(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&yu(t)}),gu.apply(this,arguments)}function pu(n,e){return _u.apply(this,arguments)}function _u(){return _u=(0,_.Z)(function*(n,e){const t=A(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const o=s.U_.indexOf(e);o>=0&&(s.U_.splice(o,1),0===s.U_.length?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}),_u.apply(this,arguments)}function Uv(n,e){const t=A(n);let r=!1;for(const i of e){const o=t.queries.get(i.query);if(o){for(const a of o.U_)a.H_(i)&&(r=!0);o.K_=i}}r&&yu(t)}function qv(n,e,t){const r=A(n),i=r.queries.get(e);if(i)for(const s of i.U_)s.onError(t);r.queries.delete(e)}function yu(n){n.z_.forEach(e=>{e.next()})}var vu,zf;(zf=vu||(vu={})).J_="default",zf.Cache="cache";class Eu{constructor(e,t,r){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Hn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){return!e.fromCache||!this.G_()||(!this.options.ra||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}na(e){e=Hn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==vu.Cache}}class Gv{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}}class jf{constructor(e){this.serializer=e}hs(e){return Je(this.serializer,e)}Ps(e){return e.metadata.exists?Bd(this.serializer,e.document,!1):Y.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return se(e)}}class zv{constructor(e,t,r){this.oa=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=$f(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;const r=O.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){const t=new Map,r=new jf(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.hs(i.metadata.name);for(const o of i.metadata.queries){const a=(t.get(o)||F()).add(s);t.set(o,a)}}return t}complete(){var e=this;return(0,_.Z)(function*(){const t=yield function pv(n,e,t,r){return Ua.apply(this,arguments)}(e.localStore,new jf(e.serializer),e.documents,e.oa.id),r=e.aa(e.documents);for(const i of e.queries)yield _v(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,ua:e.collectionGroups,ca:t}})()}}function $f(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Kf{constructor(e){this.key=e}}class Qf{constructor(e){this.key=e}}class Wf{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=F(),this.mutatedKeys=F(),this.Ia=od(e),this.Ta=new Wn(this.Ia)}get Ea(){return this.la}da(e,t){const r=t?t.Aa:new Gf,i=t?t.Ta:this.Ta;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const u="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((c,d)=>{const f=i.get(c),g=Br(this.query,d)?d:null,E=!!f&&this.mutatedKeys.has(f.key),T=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let I=!1;f&&g?f.data.isEqual(g.data)?E!==T&&(r.track({type:3,doc:g}),I=!0):this.Ra(f,g)||(r.track({type:2,doc:g}),I=!0,(u&&this.Ia(g,u)>0||l&&this.Ia(g,l)<0)&&(a=!0)):!f&&g?(r.track({type:0,doc:g}),I=!0):f&&!g&&(r.track({type:1,doc:f}),I=!0,(u||l)&&(a=!0)),I&&(g?(o=o.add(g),s=T?s.add(c):s.delete(c)):(o=o.delete(c),s=s.delete(c)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const c="F"===this.query.limitType?o.last():o.first();o=o.delete(c.key),s=s.delete(c.key),r.track({type:1,doc:c})}return{Ta:o,Aa:r,Zi:a,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const o=e.Aa.Q_();o.sort((c,d)=>function(g,E){const T=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return C()}};return T(g)-T(E)}(c.type,d.type)||this.Ia(c.doc,d.doc)),this.Va(r),i=null!=i&&i;const a=t&&!i?this.ma():[],u=0===this.Pa.size&&this.current&&!i?1:0,l=u!==this.ha;return this.ha=u,0!==o.length||l?{snapshot:new Hn(this.query,e.Ta,s,o,e.mutatedKeys,0===u,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Gf,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=F(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});const t=[];return e.forEach(r=>{this.Pa.has(r)||t.push(new Qf(r))}),this.Pa.forEach(r=>{e.has(r)||t.push(new Kf(r))}),t}pa(e){this.la=e.ls,this.Pa=F();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Hn.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class jv{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class $v{constructor(e){this.key=e,this.wa=!1}}class Kv{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new at(a=>id(a),Lr),this.Da=new Map,this.Ca=new Set,this.va=new Q(w.comparator),this.Fa=new Map,this.Ma=new ba,this.xa={},this.Oa=new Map,this.Na=tn.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}function Qv(n,e){return Iu.apply(this,arguments)}function Iu(){return Iu=(0,_.Z)(function*(n,e,t=!0){const r=bs(n);let i;const s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield Hf(r,e,t,!0),i}),Iu.apply(this,arguments)}function Wv(n,e){return Tu.apply(this,arguments)}function Tu(){return Tu=(0,_.Z)(function*(n,e){const t=bs(n);yield Hf(t,e,!0,!1)}),Tu.apply(this,arguments)}function Hf(n,e,t,r){return Au.apply(this,arguments)}function Au(){return Au=(0,_.Z)(function*(n,e,t,r){const i=yield qn(n.localStore,Se(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current";let a;return r&&(a=yield wu(n,e,s,"current"===o,i.resumeToken)),n.isPrimaryClient&&t&&Ds(n.remoteStore,i),a}),Au.apply(this,arguments)}function wu(n,e,t,r,i){return Vu.apply(this,arguments)}function Vu(){return Vu=(0,_.Z)(function*(n,e,t,r,i){n.Ba=(d,f,g)=>{return(E=(0,_.Z)(function*(I,D,N,R){let M=D.view.da(N);M.Zi&&(M=yield Vs(I.localStore,D.query,!1).then(({documents:Ue})=>D.view.da(Ue,M)));const q=R&&R.targetChanges.get(D.targetId),z=R&&null!=R.targetMismatches.get(D.targetId),oe=D.view.applyChanges(M,I.isPrimaryClient,q,z);return ku(I,D.targetId,oe.fa),oe.snapshot}),function T(I,D,N,R){return E.apply(this,arguments)})(n,d,f,g);var E};const s=yield Vs(n.localStore,e,!0),o=new Wf(e,s.ls),a=o.da(s.documents),u=Kr.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),l=o.applyChanges(a,n.isPrimaryClient,u);ku(n,t,l.fa);const c=new jv(e,t,o);return n.ba.set(e,c),n.Da.has(t)?n.Da.get(t).push(e):n.Da.set(t,[e]),l.snapshot}),Vu.apply(this,arguments)}function Hv(n,e,t){return Cu.apply(this,arguments)}function Cu(){return Cu=(0,_.Z)(function*(n,e,t){const r=A(n),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!Lr(o,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Gn(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&jn(r.remoteStore,i.targetId),Zn(r,i.targetId)}).catch(_t))):(Zn(r,i.targetId),yield Gn(r.localStore,i.targetId,!0))}),Cu.apply(this,arguments)}function Zv(n,e){return Su.apply(this,arguments)}function Su(){return Su=(0,_.Z)(function*(n,e){const t=A(n),r=t.ba.get(e),i=t.Da.get(r.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),jn(t.remoteStore,r.targetId))}),Su.apply(this,arguments)}function Ru(){return Ru=(0,_.Z)(function*(n,e,t){const r=Qu(n);try{const i=yield function(o,a){const u=A(o),l=X.now(),c=a.reduce((g,E)=>g.add(E.key),F());let d,f;return u.persistence.runTransaction("Locally write mutations","readwrite",g=>{let E=Ne(),T=F();return u.ss.getEntries(g,c).next(I=>{E=I,E.forEach((D,N)=>{N.isValidDocument()||(T=T.add(D))})}).next(()=>u.localDocuments.getOverlayedDocuments(g,E)).next(I=>{d=I;const D=[];for(const N of a){const R=Ay(N,d.get(N.key).overlayedDocument);null!=R&&D.push(new ut(N.key,R,zh(R.value.mapValue),ee.exists(!0)))}return u.mutationQueue.addMutationBatch(g,l,D,a)}).next(I=>{f=I;const D=I.applyToLocalDocumentSet(d,T);return u.documentOverlayCache.saveOverlays(g,I.batchId,D)})}).then(()=>({batchId:f.batchId,changes:ud(d)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let l=o.xa[o.currentUser.toKey()];l||(l=new Q(x)),l=l.insert(a,u),o.xa[o.currentUser.toKey()]=l}(r,i.batchId,t),yield ct(r,i.changes),yield $n(r.remoteStore)}catch(i){const s=Qn(i,"Failed to persist write");t.reject(s)}}),Ru.apply(this,arguments)}function Zf(n,e){return Pu.apply(this,arguments)}function Pu(){return Pu=(0,_.Z)(function*(n,e){const t=A(n);try{const r=yield function mv(n,e){const t=A(n),r=e.snapshotVersion;let i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;const a=[];e.targetChanges.forEach((c,d)=>{const f=i.get(d);if(!f)return;a.push(t.qr.removeMatchingKeys(s,c.removedDocuments,d).next(()=>t.qr.addMatchingKeys(s,c.addedDocuments,d)));let g=f.withSequenceNumber(s.currentSequenceNumber);var T,I,D;null!==e.targetMismatches.get(d)?g=g.withResumeToken(le.EMPTY_BYTE_STRING,P.min()).withLastLimboFreeSnapshotVersion(P.min()):c.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(c.resumeToken,r)),i=i.insert(d,g),I=g,D=c,(0===(T=f).resumeToken.approximateByteSize()||I.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=3e8||D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0)&&a.push(t.qr.updateTargetData(s,g))});let u=Ne(),l=F();if(e.documentUpdates.forEach(c=>{e.resolvedLimboDocuments.has(c)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,c))}),a.push(Cf(s,o,e.documentUpdates).next(c=>{u=c.us,l=c.cs})),!r.isEqual(P.min())){const c=t.qr.getLastRemoteSnapshotVersion(s).next(d=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(c)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,l)).next(()=>u)}).then(s=>(t.ts=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Fa.get(s);o&&(S(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?S(o.wa):i.removedDocuments.size>0&&(S(o.wa),o.wa=!1))}),yield ct(t,r,e)}catch(r){yield _t(r)}}),Pu.apply(this,arguments)}function Yf(n,e,t){const r=A(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ba.forEach((s,o)=>{const a=o.view.j_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=A(o);u.onlineState=a;let l=!1;u.queries.forEach((c,d)=>{for(const f of d.U_)f.j_(a)&&(l=!0)}),l&&yu(u)}(r.eventManager,e),i.length&&r.Sa.l_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Jv(n,e,t){return Du.apply(this,arguments)}function Du(){return Du=(0,_.Z)(function*(n,e,t){const r=A(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Fa.get(e),s=i&&i.key;if(s){let o=new Q(w.comparator);o=o.insert(s,Y.newNoDocument(s,P.min()));const a=F().add(s),u=new $r(P.min(),new Map,new Q(x),o,a);yield Zf(r,u),r.va=r.va.remove(s),r.Fa.delete(e),Ou(r)}else yield Gn(r.localStore,e,!1).then(()=>Zn(r,e,t)).catch(_t)}),Du.apply(this,arguments)}function Xv(n,e){return xu.apply(this,arguments)}function xu(){return xu=(0,_.Z)(function*(n,e){const t=A(n),r=e.batch.batchId;try{const i=yield function fv(n,e){const t=A(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(a,u,l,c){const d=l.batch,f=d.keys();let g=m.resolve();return f.forEach(E=>{g=g.next(()=>c.getEntry(u,E)).next(T=>{const I=l.docVersions.get(E);S(null!==I),T.version.compareTo(I)<0&&(d.applyToRemoteDocument(T,l),T.isValidDocument()&&(T.setReadTime(l.commitVersion),c.addEntry(T)))})}),g.next(()=>a.mutationQueue.removeMutationBatch(u,d))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=F();for(let l=0;l<a.mutationResults.length;++l)a.mutationResults[l].transformResults.length>0&&(u=u.add(a.batch.mutations[l].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}(t.localStore,e);Fu(t,r,null),Mu(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ct(t,i)}catch(i){yield _t(i)}}),xu.apply(this,arguments)}function eE(n,e,t){return bu.apply(this,arguments)}function bu(){return bu=(0,_.Z)(function*(n,e,t){const r=A(n);try{const i=yield function(o,a){const u=A(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let c;return u.mutationQueue.lookupMutationBatch(l,a).next(d=>(S(null!==d),c=d.keys(),u.mutationQueue.removeMutationBatch(l,d))).next(()=>u.mutationQueue.performConsistencyCheck(l)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(l,c,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,c)).next(()=>u.localDocuments.getDocuments(l,c))})}(r.localStore,e);Fu(r,e,t),Mu(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ct(r,i)}catch(i){yield _t(i)}}),bu.apply(this,arguments)}function Nu(){return Nu=(0,_.Z)(function*(n,e){const t=A(n);Pt(t.remoteStore)||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(o){const a=A(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(-1===r)return void e.resolve();const i=t.Oa.get(r)||[];i.push(e),t.Oa.set(r,i)}catch(r){const i=Qn(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),Nu.apply(this,arguments)}function Mu(n,e){(n.Oa.get(e)||[]).forEach(t=>{t.resolve()}),n.Oa.delete(e)}function Fu(n,e,t){const r=A(n);let i=r.xa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function Zn(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Da.get(e))n.ba.delete(r),t&&n.Sa.ka(r,t);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Rr(e).forEach(r=>{n.Ma.containsKey(r)||Jf(n,r)})}function Jf(n,e){n.Ca.delete(e.path.canonicalString());const t=n.va.get(e);null!==t&&(jn(n.remoteStore,t),n.va=n.va.remove(e),n.Fa.delete(t),Ou(n))}function ku(n,e,t){for(const r of t)r instanceof Kf?(n.Ma.addReference(r.key,e),nE(n,r)):r instanceof Qf?(v("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,e),n.Ma.containsKey(r.key)||Jf(n,r.key)):C()}function nE(n,e){const t=e.key,r=t.path.canonicalString();n.va.get(t)||n.Ca.has(r)||(v("SyncEngine","New document in limbo: "+t),n.Ca.add(r),Ou(n))}function Ou(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){const e=n.Ca.values().next().value;n.Ca.delete(e);const t=new w(O.fromString(e)),r=n.Na.next();n.Fa.set(r,new $v(t)),n.va=n.va.insert(t,r),Ds(n.remoteStore,new lt(Se(Rn(t.path)),r,"TargetPurposeLimboResolution",ke.oe))}}function ct(n,e,t){return Lu.apply(this,arguments)}function Lu(){return Lu=(0,_.Z)(function*(n,e,t){const r=A(n),i=[],s=[],o=[];var a;r.ba.isEmpty()||(r.ba.forEach((a,u)=>{o.push(r.Ba(u,e,t).then(l=>{if((l||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,l?.fromCache?"not-current":"current"),l){i.push(l);const c=Oa.Qi(u.targetId,l);s.push(c)}}))}),yield Promise.all(o),r.Sa.l_(i),yield(a=(0,_.Z)(function*(l,c){const d=A(l);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>m.forEach(c,g=>m.forEach(g.ki,E=>d.persistence.referenceDelegate.addReference(f,g.targetId,E)).next(()=>m.forEach(g.qi,E=>d.persistence.referenceDelegate.removeReference(f,g.targetId,E)))))}catch(f){if(!yt(f))throw f;v("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const E=d.ts.get(g),I=E.withLastLimboFreeSnapshotVersion(E.snapshotVersion);d.ts=d.ts.insert(g,I)}}}),function u(l,c){return a.apply(this,arguments)})(r.localStore,s))}),Lu.apply(this,arguments)}function rE(n,e){return Bu.apply(this,arguments)}function Bu(){return Bu=(0,_.Z)(function*(n,e){const t=A(n);if(!t.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());const r=yield wf(t.localStore,e);t.currentUser=e,(s=t).Oa.forEach(a=>{a.forEach(u=>{u.reject(new y(p.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Oa.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield ct(t,r._s)}var s}),Bu.apply(this,arguments)}function iE(n,e){const t=A(n),r=t.Fa.get(e);if(r&&r.wa)return F().add(r.key);{let i=F();const s=t.Da.get(e);if(!s)return i;for(const o of s){const a=t.ba.get(o);i=i.unionWith(a.view.Ea)}return i}}function sE(n,e){return Uu.apply(this,arguments)}function Uu(){return Uu=(0,_.Z)(function*(n,e){const t=A(n),r=yield Vs(t.localStore,e.query,!0),i=e.view.pa(r);return t.isPrimaryClient&&ku(t,e.targetId,i.fa),i}),Uu.apply(this,arguments)}function oE(n,e){return qu.apply(this,arguments)}function qu(){return qu=(0,_.Z)(function*(n,e){const t=A(n);return Rf(t.localStore,e).then(r=>ct(t,r))}),qu.apply(this,arguments)}function aE(n,e,t,r){return Gu.apply(this,arguments)}function Gu(){return Gu=(0,_.Z)(function*(n,e,t,r){const i=A(n),s=yield function(a,u){const l=A(a),c=A(l.mutationQueue);return l.persistence.runTransaction("Lookup mutation documents","readonly",d=>c.Cn(d,u).next(f=>f?l.localDocuments.getDocuments(d,f):m.resolve(null)))}(i.localStore,e);var u;null!==s?("pending"===t?yield $n(i.remoteStore):"acknowledged"===t||"rejected"===t?(Fu(i,e,r||null),Mu(i,e),u=e,A(A(i.localStore).mutationQueue).Fn(u)):C(),yield ct(i,s)):v("SyncEngine","Cannot apply mutation batch with id: "+e)}),Gu.apply(this,arguments)}function zu(){return zu=(0,_.Z)(function*(n,e){const t=A(n);if(bs(t),Qu(t),!0===e&&!0!==t.La){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Xf(t,r.toArray());t.La=!0,yield hu(t.remoteStore,!0);for(const s of i)Ds(t.remoteStore,s)}else if(!1===e&&!1!==t.La){const r=[];let i=Promise.resolve();t.Da.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Zn(t,o),Gn(t.localStore,o,!0))),jn(t.remoteStore,o)}),yield i,yield Xf(t,r),function(o){const a=A(o);a.Fa.forEach((u,l)=>{jn(a.remoteStore,l)}),a.Ma.Vr(),a.Fa=new Map,a.va=new Q(w.comparator)}(t),t.La=!1,yield hu(t.remoteStore,!1)}}),zu.apply(this,arguments)}function Xf(n,e,t){return ju.apply(this,arguments)}function ju(){return ju=(0,_.Z)(function*(n,e,t){const r=A(n),i=[],s=[];for(const o of e){let a;const u=r.Da.get(o);if(u&&0!==u.length){a=yield qn(r.localStore,Se(u[0]));for(const l of u){const c=r.ba.get(l),d=yield sE(r,c);d.snapshot&&s.push(d.snapshot)}}else{const l=yield Sf(r.localStore,o);a=yield qn(r.localStore,l),yield wu(r,em(l),o,!1,a.resumeToken)}i.push(a)}return r.Sa.l_(s),i}),ju.apply(this,arguments)}function em(n){return td(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function lE(n){return t=A(n).localStore,A(A(t).persistence).Li();var t}function cE(n,e,t,r){return $u.apply(this,arguments)}function $u(){return $u=(0,_.Z)(function*(n,e,t,r){const i=A(n);if(i.La)return void v("SyncEngine","Ignoring unexpected query state notification.");const s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=yield Rf(i.localStore,sd(s[0])),a=$r.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,le.EMPTY_BYTE_STRING);yield ct(i,o,a);break}case"rejected":yield Gn(i.localStore,e,!0),Zn(i,e,r);break;default:C()}}),$u.apply(this,arguments)}function hE(n,e,t){return Ku.apply(this,arguments)}function Ku(){return Ku=(0,_.Z)(function*(n,e,t){const r=bs(n);if(r.La){for(const i of e){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){v("SyncEngine","Adding an already active target "+i);continue}const s=yield Sf(r.localStore,i),o=yield qn(r.localStore,s);yield wu(r,em(s),o.targetId,!1,o.resumeToken),Ds(r.remoteStore,o)}for(const i of t)r.Da.has(i)&&(yield Gn(r.localStore,i,!1).then(()=>{jn(r.remoteStore,i),Zn(r,i)}).catch(_t))}}),Ku.apply(this,arguments)}function bs(n){const e=A(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Zf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=iE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Jv.bind(null,e),e.Sa.l_=Uv.bind(null,e.eventManager),e.Sa.ka=qv.bind(null,e.eventManager),e}function Qu(n){const e=A(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Xv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=eE.bind(null,e),e}class ii{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,_.Z)(function*(){t.serializer=ni(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Af(this.persistence,new Tf,e.initialUser,this.serializer)}createPersistence(e){return new Na(Ts.jr,this.serializer)}createSharedClientState(e){return new bf}terminate(){var e=this;return(0,_.Z)(function*(){var t,r;null===(t=e.gcScheduler)||void 0===t||t.stop(),null===(r=e.indexBackfillerScheduler)||void 0===r||r.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Wu extends ii{constructor(e,t,r){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,_.Z)(function*(){yield t().call(r,e),yield r.Qa.initialize(r,e),yield Qu(r.Qa.syncEngine),yield $n(r.Qa.remoteStore),yield r.persistence.mi(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return Af(this.persistence,new Tf,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new ff(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new F_(t,this.persistence);return new M_(e.asyncQueue,r)}createPersistence(e){const t=ka(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Ae.withCacheSize(this.cacheSizeBytes):Ae.DEFAULT;return new Fa(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Mf(),Ps(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new bf}}class tm extends Wu{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,_.Z)(function*(){yield t().call(r,e);const i=r.Qa.syncEngine;r.sharedClientState instanceof $a&&(r.sharedClientState.syncEngine={Ys:aE.bind(null,i),Zs:cE.bind(null,i),Xs:hE.bind(null,i),Li:lE.bind(null,i),Js:oE.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.mi(function(){var s=(0,_.Z)(function*(o){yield function uE(n,e){return zu.apply(this,arguments)}(r.Qa.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return s.apply(this,arguments)}}())})()}createSharedClientState(e){const t=Mf();if(!$a.D(t))throw new y(p.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=ka(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new $a(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Yn{initialize(e,t){var r=this;return(0,_.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Yf(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=rE.bind(null,r.syncEngine),yield hu(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Bv}createDatastore(e){const t=ni(e.databaseInfo.databaseId),r=new Iv(e.databaseInfo);return new wv(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return r=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>Yf(this.syncEngine,t,0),a=Nf.D()?new Nf:new yv,new Sv(r,i,s,o,a);var r,i,s,o,a}createSyncEngine(e,t){return function(i,s,o,a,u,l,c){const d=new Kv(i,s,o,a,u,l);return c&&(d.La=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){var e=this;return(0,_.Z)(function*(){var t,r;yield(r=(0,_.Z)(function*(s){const o=A(s);v("RemoteStore","RemoteStore shutting down."),o.M_.add(5),yield zn(o),o.O_.shutdown(),o.N_.set("Unknown")}),function i(s){return r.apply(this,arguments)})(e.remoteStore),null===(t=e.datastore)||void 0===t||t.terminate()})()}}function nm(n,e=10240){let t=0;return{read:()=>(0,_.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,_.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Ns{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):ie("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class mE{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new ue,this.buffer=new Uint8Array,this.Wa=new TextDecoder("utf-8"),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(r?.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){var e=this;return(0,_.Z)(function*(){return e.metadata.promise})()}qa(){var e=this;return(0,_.Z)(function*(){return yield e.getMetadata(),e.Ga()})()}Ga(){var e=this;return(0,_.Z)(function*(){const t=yield e.za();if(null===t)return null;const r=e.Wa.decode(t),i=Number(r);isNaN(i)&&e.ja(`length string (${r}) is not valid number`);const s=yield e.Ha(i);return new Gv(JSON.parse(s),t.length+i)})()}Ja(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}za(){var e=this;return(0,_.Z)(function*(){for(;e.Ja()<0&&!(yield e.Ya()););if(0===e.buffer.length)return null;const t=e.Ja();t<0&&e.ja("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Ha(e){var t=this;return(0,_.Z)(function*(){for(;t.buffer.length<e;)(yield t.Ya())&&t.ja("Reached the end of bundle when more is expected.");const r=t.Wa.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){var e=this;return(0,_.Z)(function*(){const t=yield e.Ua.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class gE{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,_.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new y(p.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const r=yield(i=(0,_.Z)(function*(o,a){const u=A(o),l={documents:a.map(g=>Qr(u.serializer,g))},c=yield u.Mo("BatchGetDocuments",u.serializer.databaseId,O.emptyPath(),l,a.length),d=new Map;c.forEach(g=>{const E=function Ny(n,e){return"found"in e?function(r,i){S(!!i.found);const s=Je(r,i.found.name),o=se(i.found.updateTime),a=i.found.createTime?se(i.found.createTime):P.min(),u=new ye({mapValue:{fields:i.found.fields}});return Y.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){S(!!i.missing),S(!!i.readTime);const s=Je(r,i.missing),o=se(i.readTime);return Y.newNoDocument(s,o)}(n,e):C()}(u.serializer,g);d.set(E.key.toString(),E)});const f=[];return a.forEach(g=>{const E=d.get(g.toString());S(!!E),f.push(E)}),f}),function s(o,a){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Mn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,_.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=w.fromPath(i);e.mutations.push(new ma(s,e.precondition(s)))}),yield(r=(0,_.Z)(function*(s,o){const a=A(s),u={writes:o.map(l=>Wr(a.serializer,l))};yield a.Do("Commit",a.serializer.databaseId,O.emptyPath(),u)}),function i(s,o){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw C();t=P.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new y(p.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(P.min())?ee.exists(!1):ee.updateTime(t):ee.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(P.min()))throw new y(p.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ee.updateTime(t)}return ee.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class pE{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Jo=new Qa(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){var e=this;this.Jo.Ko((0,_.Z)(function*(){const t=new gE(e.datastore),r=e.tu(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.nu(s)}))}).catch(i=>{e.nu(i)})}))}tu(e){try{const t=this.updateFunction(e);return!Dr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Ad(t)}return!1}}class _E{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=de.UNAUTHENTICATED,this.clientId=_h.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,_.Z)(function*(a){v("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(v("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(p.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ue;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,_.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Qn(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Ms(n,e){return Hu.apply(this,arguments)}function Hu(){return Hu=(0,_.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,_.Z)(function*(s){r.isEqual(s)||(yield wf(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),Hu.apply(this,arguments)}function Zu(n,e){return Yu.apply(this,arguments)}function Yu(){return Yu=(0,_.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Ju(n);v("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>qf(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>qf(e.remoteStore,i)),n._onlineComponents=e}),Yu.apply(this,arguments)}function rm(n){return"FirebaseError"===n.name?n.code===p.FAILED_PRECONDITION||n.code===p.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function Ju(n){return Xu.apply(this,arguments)}function Xu(){return Xu=(0,_.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ms(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!rm(t))throw t;xe("Error using user provided cache. Falling back to memory cache: "+t),yield Ms(n,new ii)}}else v("FirestoreClient","Using default OfflineComponentProvider"),yield Ms(n,new ii);return n._offlineComponents}),Xu.apply(this,arguments)}function Fs(n){return el.apply(this,arguments)}function el(){return el=(0,_.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),yield Zu(n,n._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),yield Zu(n,new Yn))),n._onlineComponents}),el.apply(this,arguments)}function im(n){return Ju(n).then(e=>e.persistence)}function Jn(n){return Ju(n).then(e=>e.localStore)}function sm(n){return Fs(n).then(e=>e.remoteStore)}function tl(n){return Fs(n).then(e=>e.syncEngine)}function Xn(n){return nl.apply(this,arguments)}function nl(){return nl=(0,_.Z)(function*(n){const e=yield Fs(n),t=e.eventManager;return t.onListen=Qv.bind(null,e.syncEngine),t.onUnlisten=Hv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Wv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Zv.bind(null,e.syncEngine),t}),nl.apply(this,arguments)}function am(n,e,t={}){const r=new ue;return n.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return function(s,o,a,u,l){const c=new Ns({next:f=>{o.enqueueAndForget(()=>pu(s,d));const g=f.docs.has(a);!g&&f.fromCache?l.reject(new y(p.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&f.fromCache&&u&&"server"===u.source?l.reject(new y(p.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(f)},error:f=>l.reject(f)}),d=new Eu(Rn(a.path),c,{includeMetadataChanges:!0,ra:!0});return mu(s,d)}(yield Xn(n),n.asyncQueue,e,t,r)})),r.promise}function um(n,e,t={}){const r=new ue;return n.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return function(s,o,a,u,l){const c=new Ns({next:f=>{o.enqueueAndForget(()=>pu(s,d)),f.fromCache&&"server"===u.source?l.reject(new y(p.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(f)},error:f=>l.reject(f)}),d=new Eu(a,c,{includeMetadataChanges:!0,ra:!0});return mu(s,d)}(yield Xn(n),n.asyncQueue,e,t,r)})),r.promise}function lm(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const cm=new Map;function rl(n,e,t){if(!t)throw new y(p.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function hm(n,e,t,r){if(!0===e&&!0===r)throw new y(p.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function dm(n){if(!w.isDocumentKey(n))throw new y(p.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function fm(n){if(w.isDocumentKey(n))throw new y(p.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ks(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(r=n).constructor?r.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var r;return"function"==typeof n?"a function":C()}function k(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(p.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ks(n);throw new y(p.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function mm(n,e){if(e<=0)throw new y(p.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class gm{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new y(p.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new y(p.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}hm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=lm(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new y(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new y(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new y(p.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class si{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gm({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(p.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new y(p.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gm(e),void 0!==e.credentials&&(this._authCredentials=function(r){if(!r)return new T_;switch(r.type){case"firstParty":return new C_(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new y(p.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=cm.get(t);r&&(v("ComponentProvider","Removing Datastore"),cm.delete(t),r.terminate())}(this),Promise.resolve()}}class ve{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ve(this.firestore,e,this._query)}}class J{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xe(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new J(this.firestore,e,this._key)}}class Xe extends ve{constructor(e,t,r){super(e,t,Rn(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new J(this.firestore,null,new w(e))}withConverter(e){return new Xe(this.firestore,e,this._path)}}function _m(n,e,...t){if(n=(0,G.m9)(n),rl("collection","path",e),n instanceof si){const r=O.fromString(e,...t);return fm(r),new Xe(n,null,r)}{if(!(n instanceof J||n instanceof Xe))throw new y(p.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(O.fromString(e,...t));return fm(r),new Xe(n.firestore,null,r)}}function Os(n,e,...t){if(n=(0,G.m9)(n),1===arguments.length&&(e=_h.newId()),rl("doc","path",e),n instanceof si){const r=O.fromString(e,...t);return dm(r),new J(n,null,new w(r))}{if(!(n instanceof J||n instanceof Xe))throw new y(p.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(O.fromString(e,...t));return dm(r),new J(n.firestore,n instanceof Xe?n.converter:null,new w(r))}}function ym(n,e){return n=(0,G.m9)(n),e=(0,G.m9)(e),(n instanceof J||n instanceof Xe)&&(e instanceof J||e instanceof Xe)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function il(n,e){return n=(0,G.m9)(n),e=(0,G.m9)(e),n instanceof ve&&e instanceof ve&&n.firestore===e.firestore&&Lr(n._query,e._query)&&n.converter===e.converter}class PE{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new Qa(this,"async_queue_retry"),this.hu=()=>{const t=Ps();t&&v("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Jo.Uo()};const e=Ps();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=Ps();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});const t=new ue;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){var e=this;return(0,_.Z)(function*(){if(0!==e.su.length){try{yield e.su[0](),e.su.shift(),e.Jo.reset()}catch(t){if(!yt(t))throw t;v("AsyncQueue","Operation failed with retryable error: "+t)}e.su.length>0&&e.Jo.Ko(()=>e.Tu())}})()}Iu(e){const t=this.iu.then(()=>(this.uu=!0,e().catch(r=>{throw this.au=r,this.uu=!1,ie("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(r)),r}).then(r=>(this.uu=!1,r))));return this.iu=t,t}enqueueAfterDelay(e,t,r){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const i=fu.createAndSchedule(this,e,t,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&C()}verifyOperationInProgress(){}du(){var e=this;return(0,_.Z)(function*(){let t;do{t=e.iu,yield t}while(t!==e.iu)})()}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function sl(n){return function(t,r){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(n)}class DE{constructor(){this._progressObserver={},this._taskCompletionResolver=new ue,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class W extends si{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new PE,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||vm(this),this._firestoreClient.terminate()}}function re(n){return n._firestoreClient||vm(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function vm(n){var e,t,r;const i=n._freezeSettings(),s=(u=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new ny(n._databaseId,u,n._persistenceKey,(c=i).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,lm(c.experimentalLongPollingOptions),c.useFetchStreams));var u,c;n._firestoreClient=new _E(n._authCredentials,n._appCheckCredentials,n._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=i.localCache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Em(n,e,t){const r=new ue;return n.asyncQueue.enqueue((0,_.Z)(function*(){try{yield Ms(n,t),yield Zu(n,e),r.resolve()}catch(i){const s=i;if(!rm(s))throw s;xe("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function Im(n){if(n._initialized||n._terminated)throw new y(p.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class et{constructor(e){this._byteString=e}static fromBase64String(e){try{return new et(le.fromBase64String(e))}catch(t){throw new y(p.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new et(le.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ht{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new y(p.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Z(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class rn{constructor(e){this._methodName=e}}class Ls{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(p.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(p.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return x(this._lat,e._lat)||x(this._long,e._long)}}const qE=/^__.*__$/;class GE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new ut(e,this.data,this.fieldMask,t,this.fieldTransforms):new Nn(e,this.data,t,this.fieldTransforms)}}class Tm{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ut(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Am(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw C()}}class Bs{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===s&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new Bs(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return Gs(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(Am(this.fu)&&qE.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class zE{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ni(e)}Fu(e,t,r,i=!1){return new Bs({fu:e,methodName:t,vu:r,path:Z.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sn(n){const e=n._freezeSettings(),t=ni(n._databaseId);return new zE(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Us(n,e,t,r,i,s={}){const o=n.Fu(s.merge||s.mergeFields?2:0,e,t,i);dl("Data must be an object, but it was:",o,r);const a=Cm(r,o);let u,l;if(s.merge)u=new be(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const c=[];for(const d of s.mergeFields){const f=ui(e,d,t);if(!o.contains(f))throw new y(p.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);Rm(c,f)||c.push(f)}u=new be(c),l=o.fieldTransforms.filter(d=>u.covers(d.field))}else u=null,l=o.fieldTransforms;return new GE(new ye(a),u,l)}class ai extends rn{_toFieldTransform(e){if(2!==e.fu)throw e.Du(1===e.fu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ai}}function wm(n,e,t){return new Bs({fu:3,vu:e.settings.vu,methodName:n._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class ol extends rn{_toFieldTransform(e){return new Gr(e.path,new xn)}isEqual(e){return e instanceof ol}}class al extends rn{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=wm(this,e,!0),r=this.Mu.map(s=>on(s,t)),i=new Wt(r);return new Gr(e.path,i)}isEqual(e){return e instanceof al&&(0,G.vZ)(this.Mu,e.Mu)}}class ul extends rn{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=wm(this,e,!0),r=this.Mu.map(s=>on(s,t)),i=new Ht(r);return new Gr(e.path,i)}isEqual(e){return e instanceof ul&&(0,G.vZ)(this.Mu,e.Mu)}}class ll extends rn{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){const t=new bn(e.serializer,dd(e.serializer,this.xu));return new Gr(e.path,t)}isEqual(e){return e instanceof ll&&this.xu===e.xu}}function cl(n,e,t,r){const i=n.Fu(1,e,t);dl("Data must be an object, but it was:",i,r);const s=[],o=ye.empty();vt(r,(u,l)=>{const c=qs(e,u,t);l=(0,G.m9)(l);const d=i.Su(c);if(l instanceof ai)s.push(c);else{const f=on(l,d);null!=f&&(s.push(c),o.set(c,f))}});const a=new be(s);return new Tm(o,a,i.fieldTransforms)}function hl(n,e,t,r,i,s){const o=n.Fu(1,e,t),a=[ui(e,r,t)],u=[i];if(s.length%2!=0)throw new y(p.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(ui(e,s[f])),u.push(s[f+1]);const l=[],c=ye.empty();for(let f=a.length-1;f>=0;--f)if(!Rm(l,a[f])){const g=a[f];let E=u[f];E=(0,G.m9)(E);const T=o.Su(g);if(E instanceof ai)l.push(g);else{const I=on(E,T);null!=I&&(l.push(g),c.set(g,I))}}const d=new be(l);return new Tm(c,d,o.fieldTransforms)}function Vm(n,e,t,r=!1){return on(t,n.Fu(r?4:3,e))}function on(n,e){if(Sm(n=(0,G.m9)(n)))return dl("Unsupported field value:",e,n),Cm(n,e);if(n instanceof rn)return function(r,i){if(!Am(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&4!==e.fu)throw e.Du("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let u=on(a,i.bu(o));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if(null===(r=(0,G.m9)(r)))return{nullValue:"NULL_VALUE"};if("number"==typeof r)return dd(i.serializer,r);if("boolean"==typeof r)return{booleanValue:r};if("string"==typeof r)return{stringValue:r};if(r instanceof Date){const s=X.fromDate(r);return{timestampValue:Fn(i.serializer,s)}}if(r instanceof X){const s=new X(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Fn(i.serializer,s)}}if(r instanceof Ls)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof et)return{bytesValue:Nd(i.serializer,r._byteString)};if(r instanceof J){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Ea(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${ks(r)}`)}(n,e)}function Cm(n,e){const t={};return Mh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vt(n,(r,i)=>{const s=on(i,e.pu(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function Sm(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof X||n instanceof Ls||n instanceof et||n instanceof J||n instanceof rn)}function dl(n,e,t){if(!Sm(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const r=ks(t);throw e.Du("an object"===r?n+" a custom object":n+" "+r)}var i}function ui(n,e,t){if((e=(0,G.m9)(e))instanceof ht)return e._internalPath;if("string"==typeof e)return qs(n,e);throw Gs("Field path arguments must be of type string or ",n,!1,void 0,t)}const jE=new RegExp("[~\\*/\\[\\]]");function qs(n,e,t){if(e.search(jE)>=0)throw Gs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ht(...e.split("."))._internalPath}catch{throw Gs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Gs(n,e,t,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new y(p.INVALID_ARGUMENT,a+n+u)}function Rm(n,e){return n.some(t=>t.isEqual(e))}class li{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new J(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new $E(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(zs("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class $E extends li{data(){return super.data()}}function zs(n,e){return"string"==typeof e?qs(n,e):e instanceof ht?e._internalPath:e._delegate._internalPath}function Pm(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new y(p.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class fl{}class ci extends fl{}function xt(n,e,...t){let r=[];e instanceof fl&&r.push(e),r=r.concat(t),function(s){const o=s.filter(u=>u instanceof er).length,a=s.filter(u=>u instanceof hi).length;if(o>1||o>0&&a>0)throw new y(p.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class hi extends ci{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new hi(e,t,r)}_apply(e){const t=this._parse(e);return Nm(e._query,t),new ve(e.firestore,e.converter,da(e._query,t))}_parse(e){const t=sn(e.firestore);return function(s,o,a,u,l,c,d){let f;if(l.isKeyField()){if("array-contains"===c||"array-contains-any"===c)throw new y(p.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if("in"===c||"not-in"===c){bm(d,c);const g=[];for(const E of d)g.push(xm(u,s,E));f={arrayValue:{values:g}}}else f=xm(u,s,d)}else"in"!==c&&"not-in"!==c&&"array-contains-any"!==c||bm(d,c),f=Vm(a,"where",d,"in"===c||"not-in"===c);return L.create(l,c,f)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class er extends fl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new er(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:$.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const u of a)Nm(o,u),o=da(o,u)}(e._query,t),new ve(e.firestore,e.converter,da(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class ml extends ci{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ml(e,t)}_apply(e){const t=function(i,s,o){if(null!==i.startAt)throw new y(p.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new y(p.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new kr(s,o)}(e._query,this._field,this._direction);return new ve(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new ot(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class js extends ci{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new js(e,t,r)}_apply(e){return new ve(e.firestore,e.converter,ls(e._query,this._limit,this._limitType))}}class $s extends ci{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new $s(e,t,r)}_apply(e){const t=Dm(e,this.type,this._docOrFields,this._inclusive);return new ve(e.firestore,e.converter,(s=t,new ot((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class Ks extends ci{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ks(e,t,r)}_apply(e){const t=Dm(e,this.type,this._docOrFields,this._inclusive);return new ve(e.firestore,e.converter,(s=t,new ot((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function Dm(n,e,t,r){if(t[0]=(0,G.m9)(t[0]),t[0]instanceof li)return function(s,o,a,u,l){if(!u)throw new y(p.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const c=[];for(const d of Pn(s))if(d.field.isKeyField())c.push(Kt(o,u.key));else{const f=u.data.field(d.field);if(ns(f))throw new y(p.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+d.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===f){const g=d.field.canonicalString();throw new y(p.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${g}' (used as the orderBy) does not exist.`)}c.push(f)}return new wt(c,l)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=sn(n.firestore);return function(o,a,u,l,c,d){const f=o.explicitOrderBy;if(c.length>f.length)throw new y(p.INVALID_ARGUMENT,`Too many arguments provided to ${l}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const g=[];for(let E=0;E<c.length;E++){const T=c[E];if(f[E].field.isKeyField()){if("string"!=typeof T)throw new y(p.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${l}(), but got a ${typeof T}`);if(!ha(o)&&-1!==T.indexOf("/"))throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${l}() must be a plain document ID, but '${T}' contains a slash.`);const I=o.path.child(O.fromString(T));if(!w.isDocumentKey(I))throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${l}() must result in a valid document path, but '${I}' is not because it contains an odd number of segments.`);const D=new w(I);g.push(Kt(a,D))}else{const I=Vm(u,l,T);g.push(I)}}return new wt(g,d)}(n._query,n.firestore._databaseId,i,e,t,r)}}function xm(n,e,t){if("string"==typeof(t=(0,G.m9)(t))){if(""===t)throw new y(p.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ha(e)&&-1!==t.indexOf("/"))throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(O.fromString(t));if(!w.isDocumentKey(r))throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Kt(n,new w(r))}if(t instanceof J)return Kt(n,t._key);throw new y(p.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ks(t)}.`)}function bm(n,e){if(!Array.isArray(n)||0===n.length)throw new y(p.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Nm(n,e){const t=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new y(p.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class gl{convertValue(e,t="none"){switch(Tt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ne(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(st(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw C()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return vt(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Ls(ne(e.latitude),ne(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=rs(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(br(e));default:return null}}convertTimestamp(e){const t=it(e);return new X(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=O.fromString(e);S(jd(r));const i=new Et(r.get(1),r.get(3)),s=new w(r.popFirst(5));return i.isEqual(t)||ie(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Qs(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class eI extends gl{constructor(e){super(),this.firestore=e}convertBytes(e){return new et(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new J(this.firestore,null,t)}}class an{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class dt extends li{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new di(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(zs("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class di extends dt{data(e={}){return super.data(e)}}class bt{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new an(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new di(this._firestore,this._userDataWriter,r.key,r,new an(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(p.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>({type:"added",doc:new di(i._firestore,i._userDataWriter,a.doc.key,a.doc,new an(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||3!==a.type).map(a=>{const u=new di(i._firestore,i._userDataWriter,a.doc.key,a.doc,new an(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,c=-1;return 0!==a.type&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),1!==a.type&&(o=o.add(a.doc),c=o.indexOf(a.doc.key)),{type:nI(a.type),doc:u,oldIndex:l,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function nI(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return C()}}function Fm(n,e){return n instanceof dt&&e instanceof dt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof bt&&e instanceof bt&&n._firestore===e._firestore&&il(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class Nt extends gl{constructor(e){super(),this.firestore=e}convertBytes(e){return new et(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new J(this.firestore,null,t)}}function km(n,e,t){n=k(n,J);const r=k(n.firestore,W),i=Qs(n.converter,e,t);return tr(r,[Us(sn(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,ee.none())])}function Om(n,e,t,...r){n=k(n,J);const i=k(n.firestore,W),s=sn(i);let o;return o="string"==typeof(e=(0,G.m9)(e))||e instanceof ht?hl(s,"updateDoc",n._key,e,t,r):cl(s,"updateDoc",n._key,e),tr(i,[o.toMutation(n._key,ee.exists(!0))])}function Lm(n,...e){var t,r,i;n=(0,G.m9)(n);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||sl(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(sl(e[o])){const d=e[o];e[o]=null===(t=d.next)||void 0===t?void 0:t.bind(d),e[o+1]=null===(r=d.error)||void 0===r?void 0:r.bind(d),e[o+2]=null===(i=d.complete)||void 0===i?void 0:i.bind(d)}let u,l,c;if(n instanceof J)l=k(n.firestore,W),c=Rn(n._key.path),u={next:d=>{e[o]&&e[o](pl(l,n,d))},error:e[o+1],complete:e[o+2]};else{const d=k(n,ve);l=k(d.firestore,W),c=d._query;const f=new Nt(l);u={next:g=>{e[o]&&e[o](new bt(l,f,d,g))},error:e[o+1],complete:e[o+2]},Pm(n._query)}return function(f,g,E,T){const I=new Ns(T),D=new Eu(g,I,E);return f.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return mu(yield Xn(f),D)})),()=>{I.$a(),f.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return pu(yield Xn(f),D)}))}}(re(l),c,a,u)}function tr(n,e){return function(r,i){const s=new ue;return r.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return function Yv(n,e,t){return Ru.apply(this,arguments)}(yield tl(r),i,s)})),s.promise}(re(n),e)}function pl(n,e,t){const r=t.docs.get(e._key),i=new Nt(n);return new dt(n,i,e._key,r,new an(t.hasPendingWrites,t.fromCache),e.converter)}const EI={maxAttempts:5};class Bm{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=sn(e)}set(e,t,r){this._verifyNotCommitted();const i=Mt(e,this._firestore),s=Qs(i.converter,t,r),o=Us(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(o.toMutation(i._key,ee.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=Mt(e,this._firestore);let o;return o="string"==typeof(t=(0,G.m9)(t))||t instanceof ht?hl(this._dataReader,"WriteBatch.update",s._key,t,r,i):cl(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,ee.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Mt(e,this._firestore);return this._mutations=this._mutations.concat(new Mn(t._key,ee.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(p.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Mt(n,e){if((n=(0,G.m9)(n)).firestore!==e)throw new y(p.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class II extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=sn(t)}get(t){const r=Mt(t,this._firestore),i=new eI(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||1!==s.length)return C();const o=s[0];if(o.isFoundDocument())return new li(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new li(this._firestore,i,r._key,null,r.converter);throw C()})}set(t,r,i){const s=Mt(t,this._firestore),o=Qs(s.converter,r,i),a=Us(this._dataReader,"Transaction.set",s._key,o,null!==s.converter,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){const o=Mt(t,this._firestore);let a;return a="string"==typeof(r=(0,G.m9)(r))||r instanceof ht?hl(this._dataReader,"Transaction.update",o._key,r,i,s):cl(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Mt(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Mt(e,this._firestore),r=new Nt(this._firestore);return super.get(e).then(i=>new dt(this._firestore,r,t._key,i._document,new an(!1,!1),t.converter))}}function Um(){return new ol("serverTimestamp")}!function(e,t=!0){En=Ci.SDK_VERSION,(0,Ci._registerComponent)(new Zl.wA("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new W(new w_(r.getProvider("auth-internal")),new S_(r.getProvider("app-check-internal")),function(l,c){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new y(p.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Et(l.options.projectId,c)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),(0,Ci.registerVersion)(mh,"4.6.1",e),(0,Ci.registerVersion)(mh,"4.6.1","esm2017")}();var ft=U(7213),Oe=U(8326),Hs=U(7217),RI=U(6321),jm=U(5592),fi=U(2459),$m=U(2096),yl=U(7921),PI=U(9360),Km=U(8251);function vl(){return(0,PI.e)((n,e)=>{let t,r=!1;n.subscribe((0,Km.x)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}var ze=U(7398),El=U(6699),DI=U(3997),Qm=U(2181),xI=(U(340),U(3106));function Il(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Wm(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function Hm(){if(!function ey(){return typeof atob<"u"}())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}class mi{constructor(e){this._delegate=e}static fromBase64String(e){return Hm(),new mi(et.fromBase64String(e))}static fromUint8Array(e){return Wm(),new mi(et.fromUint8Array(e))}toBase64(){return Hm(),this._delegate.toBase64()}toUint8Array(){return Wm(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Tl(n){return function MI(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class FI{enableIndexedDbPersistence(e,t){return function bE(n,e){Im(n=k(n,W));const t=re(n);if(t._uninitializedComponentsProvider)throw new y(p.FAILED_PRECONDITION,"SDK cache is already specified.");xe("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new Yn;return Em(t,i,new Wu(i,r.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function NE(n){Im(n=k(n,W));const e=re(n);if(e._uninitializedComponentsProvider)throw new y(p.FAILED_PRECONDITION,"SDK cache is already specified.");xe("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new Yn;return Em(e,r,new tm(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function ME(n){if(n._initialized&&!n._terminated)throw new y(p.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ue;return n._queue.enqueueAndForgetEvenWhileRestricted((0,_.Z)(function*(){try{yield(t=(0,_.Z)(function*(i){if(!We.D())return Promise.resolve();const s=i+"main";yield We.delete(s)}),function r(i){return t.apply(this,arguments)})(ka(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Zm{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Et||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&xe("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function pm(n,e,t,r={}){var i;const s=(n=k(n,si))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&xe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if("string"==typeof r.mockUserToken)a=r.mockUserToken,u=de.MOCK_USER;else{a=(0,G.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const l=r.mockUserToken.sub||r.mockUserToken.user_id;if(!l)throw new y(p.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new de(l)}n._authCredentials=new A_(new gh(a,u))}}(this._delegate,e,t,r)}enableNetwork(){return function kE(n){return function yE(n){return n.asyncQueue.enqueue((0,_.Z)(function*(){const e=yield im(n),t=yield sm(n);return e.setNetworkEnabled(!0),function(i){const s=A(i);return s.M_.delete(0),ri(s)}(t)}))}(re(n=k(n,W)))}(this._delegate)}disableNetwork(){return function OE(n){return function vE(n){return n.asyncQueue.enqueue((0,_.Z)(function*(){const e=yield im(n),t=yield sm(n);return e.setNetworkEnabled(!1),(r=(0,_.Z)(function*(s){const o=A(s);o.M_.add(0),yield zn(o),o.N_.set("Offline")}),function i(s){return r.apply(this,arguments)})(t);var r}))}(re(n=k(n,W)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,hm("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function FE(n){return function(t){const r=new ue;return t.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return function tE(n,e){return Nu.apply(this,arguments)}(yield tl(t),r)})),r.promise}(re(n=k(n,W)))}(this._delegate)}onSnapshotsInSync(e){return function hI(n,e){return function TE(n,e){const t=new Ns(e);return n.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return i=yield Xn(n),s=t,A(i).z_.add(s),void s.next();var i,s})),()=>{t.$a(),n.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return i=yield Xn(n),s=t,void A(i).z_.delete(s);var i,s}))}}(re(n=k(n,W)),sl(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new nr(this,_m(this._delegate,e))}catch(t){throw Re(t,"collection()","Firestore.collection()")}}doc(e){try{return new Be(this,Os(this._delegate,e))}catch(t){throw Re(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Pe(this,function RE(n,e){if(n=k(n,si),rl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(p.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ve(n,null,(r=e,new ot(O.emptyPath(),r)));var r}(this._delegate,e))}catch(t){throw Re(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function TI(n,e,t){n=k(n,W);const r=Object.assign(Object.assign({},EI),t);return function(s){if(s.maxAttempts<1)throw new y(p.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){const u=new ue;return s.asyncQueue.enqueueAndForget((0,_.Z)(function*(){const l=yield function om(n){return Fs(n).then(e=>e.datastore)}(s);new pE(s.asyncQueue,l,a,o,u).Xa()})),u.promise}(re(n),i=>e(new II(n,i)),r)}(this._delegate,t=>e(new Ym(this,t)))}batch(){return re(this._delegate),new Jm(new Bm(this._delegate,e=>tr(this._delegate,e)))}loadBundle(e){return function LE(n,e){const t=re(n=k(n,W)),r=new DE;return function AE(n,e,t,r){const i=function(o,a){let u;return u="string"==typeof o?Vd().encode(o):o,c=function(c,d){if(c instanceof Uint8Array)return nm(c,d);if(c instanceof ArrayBuffer)return nm(new Uint8Array(c),d);if(c instanceof ReadableStream)return c.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),new mE(c,a);var c}(t,ni(e));n.asyncQueue.enqueueAndForget((0,_.Z)(function*(){!function dE(n,e,t){const r=A(n);var i;(i=(0,_.Z)(function*(o,a,u){try{const l=yield a.getMetadata();if(yield function(E,T){const I=A(E),D=se(T.createTime);return I.persistence.runTransaction("hasNewerBundle","readonly",N=>I.Kr.getBundleMetadata(N,T.id)).then(N=>!!N&&N.createTime.compareTo(D)>=0)}(o.localStore,l))return yield a.close(),u._completeWith({taskState:"Success",documentsLoaded:(E=l).totalDocuments,bytesLoaded:E.totalBytes,totalDocuments:E.totalDocuments,totalBytes:E.totalBytes}),Promise.resolve(new Set);u._updateProgress($f(l));const c=new zv(l,o.localStore,a.serializer);let d=yield a.qa();for(;d;){const g=yield c._a(d);g&&u._updateProgress(g),d=yield a.qa()}const f=yield c.complete();return yield ct(o,f.ca,void 0),yield function(E,T){const I=A(E);return I.persistence.runTransaction("Save bundle","readwrite",D=>I.Kr.saveBundleMetadata(D,T))}(o.localStore,l),u._completeWith(f.progress),Promise.resolve(f.ua)}catch(l){return xe("SyncEngine",`Loading bundle failed with ${l}`),u._failWith(l),Promise.resolve(new Set)}var E}),function s(o,a,u){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield tl(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function BE(n,e){return function wE(n,e){return n.asyncQueue.enqueue((0,_.Z)(function*(){return function(r,i){const s=A(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(yield Jn(n),e)}))}(re(n=k(n,W)),e).then(t=>t?new ve(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Pe(this,t):null)}}class Zs extends gl{constructor(e){super(),this.firestore=e}convertBytes(e){return new mi(new et(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Be.forKey(t,this.firestore,null)}}class Ym{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Zs(e)}get(e){const t=ln(e);return this._delegate.get(t).then(r=>new gi(this._firestore,new dt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=ln(e);return r?(Il("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=ln(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=ln(e);return this._delegate.delete(t),this}}class Jm{constructor(e){this._delegate=e}set(e,t,r){const i=ln(e);return r?(Il("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=ln(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=ln(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class un{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new di(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new pi(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=un.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new un(e,new Zs(e),t),i.set(t,s)),s}}un.INSTANCES=new WeakMap;class Be{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Zs(e)}static forPath(e,t,r){if(e.length%2!=0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Be(t,new J(t._delegate,r,new w(e)))}static forKey(e,t,r){return new Be(t,new J(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new nr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new nr(this.firestore,_m(this._delegate,e))}catch(t){throw Re(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,G.m9)(e))instanceof J&&ym(this._delegate,e)}set(e,t){t=Il("DocumentReference.set",t);try{return t?km(this._delegate,e,t):km(this._delegate,e)}catch(r){throw Re(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Om(this._delegate,e):Om(this._delegate,e,t,...r)}catch(i){throw Re(i,"updateDoc()","DocumentReference.update()")}}delete(){return function lI(n){return tr(k(n.firestore,W),[new Mn(n._key,ee.none())])}(this._delegate)}onSnapshot(...e){const t=Xm(e),r=eg(e,i=>new gi(this.firestore,new dt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Lm(this._delegate,t,r)}get(e){let t;return t="cache"===e?.source?function iI(n){n=k(n,J);const e=k(n.firestore,W),t=re(e),r=new Nt(e);return function EE(n,e){const t=new ue;return n.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return(r=(0,_.Z)(function*(s,o,a){try{const u=yield function(c,d){const f=A(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(s,o);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new y(p.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){const l=Qn(u,`Failed to get document '${o} from cache`);a.reject(l)}}),function i(s,o,a){return r.apply(this,arguments)})(yield Jn(n),e,t);var r})),t.promise}(t,n._key).then(i=>new dt(e,r,n._key,i,new an(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===e?.source?function sI(n){n=k(n,J);const e=k(n.firestore,W);return am(re(e),n._key,{source:"server"}).then(t=>pl(e,n,t))}(this._delegate):function rI(n){n=k(n,J);const e=k(n.firestore,W);return am(re(e),n._key).then(t=>pl(e,n,t))}(this._delegate),t.then(r=>new gi(this.firestore,new dt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Be(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}function Re(n,e,t){return n.message=n.message.replace(e,t),n}function Xm(n){for(const e of n)if("object"==typeof e&&!Tl(e))return e;return{}}function eg(n,e){var t,r;let i;return i=Tl(n[0])?n[0]:Tl(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class gi{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Be(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Fm(this._delegate,e._delegate)}}class pi extends gi{data(e){const t=this._delegate.data(e);return this._delegate._converter||function I_(n,e){n||C()}(void 0!==t),t}}class Pe{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Zs(e)}where(e,t,r){try{return new Pe(this.firestore,xt(this._delegate,function KE(n,e,t){const r=e,i=zs("where",n);return hi._create(i,r,t)}(e,t,r)))}catch(i){throw Re(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Pe(this.firestore,xt(this._delegate,function QE(n,e="asc"){const t=e,r=zs("orderBy",n);return ml._create(r,t)}(e,t)))}catch(r){throw Re(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Pe(this.firestore,xt(this._delegate,function WE(n){return mm("limit",n),js._create("limit",n,"F")}(e)))}catch(t){throw Re(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Pe(this.firestore,xt(this._delegate,function HE(n){return mm("limitToLast",n),js._create("limitToLast",n,"L")}(e)))}catch(t){throw Re(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Pe(this.firestore,xt(this._delegate,function ZE(...n){return $s._create("startAt",n,!0)}(...e)))}catch(t){throw Re(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Pe(this.firestore,xt(this._delegate,function YE(...n){return $s._create("startAfter",n,!1)}(...e)))}catch(t){throw Re(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Pe(this.firestore,xt(this._delegate,function JE(...n){return Ks._create("endBefore",n,!1)}(...e)))}catch(t){throw Re(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Pe(this.firestore,xt(this._delegate,function XE(...n){return Ks._create("endAt",n,!0)}(...e)))}catch(t){throw Re(t,"endAt()","Query.endAt()")}}isEqual(e){return il(this._delegate,e._delegate)}get(e){let t;return t="cache"===e?.source?function aI(n){n=k(n,ve);const e=k(n.firestore,W),t=re(e),r=new Nt(e);return function IE(n,e){const t=new ue;return n.asyncQueue.enqueueAndForget((0,_.Z)(function*(){return(r=(0,_.Z)(function*(s,o,a){try{const u=yield Vs(s,o,!0),l=new Wf(o,u.ls),c=l.da(u.documents),d=l.applyChanges(c,!1);a.resolve(d.snapshot)}catch(u){const l=Qn(u,`Failed to execute query '${o} against cache`);a.reject(l)}}),function i(s,o,a){return r.apply(this,arguments)})(yield Jn(n),e,t);var r})),t.promise}(t,n._query).then(i=>new bt(e,r,n,i))}(this._delegate):"server"===e?.source?function uI(n){n=k(n,ve);const e=k(n.firestore,W),t=re(e),r=new Nt(e);return um(t,n._query,{source:"server"}).then(i=>new bt(e,r,n,i))}(this._delegate):function oI(n){n=k(n,ve);const e=k(n.firestore,W),t=re(e),r=new Nt(e);return Pm(n._query),um(t,n._query).then(i=>new bt(e,r,n,i))}(this._delegate),t.then(r=>new Al(this.firestore,new bt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Xm(e),r=eg(e,i=>new Al(this.firestore,new bt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Lm(this._delegate,t,r)}withConverter(e){return new Pe(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}class OI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new pi(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Al{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Pe(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new pi(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new OI(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new pi(this._firestore,r))})}isEqual(e){return Fm(this._delegate,e._delegate)}}class nr extends Pe{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Be(this.firestore,e):null}doc(e){try{return new Be(this.firestore,void 0===e?Os(this._delegate):Os(this._delegate,e))}catch(t){throw Re(t,"doc()","CollectionReference.doc()")}}add(e){return function cI(n,e){const t=k(n.firestore,W),r=Os(n),i=Qs(n.converter,e);return tr(t,[Us(sn(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,ee.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Be(this.firestore,t))}isEqual(e){return ym(this._delegate,e._delegate)}withConverter(e){return new nr(this.firestore,this._delegate.withConverter(e?un.getInstance(this.firestore,e):null))}}function ln(n){return k(n,J)}class wl{constructor(...e){this._delegate=new ht(...e)}static documentId(){return new wl(Z.keyField().canonicalString())}isEqual(e){return(e=(0,G.m9)(e))instanceof ht&&this._delegate._internalPath.isEqual(e._internalPath)}}class cn{constructor(e){this._delegate=e}static serverTimestamp(){const e=Um();return e._methodName="FieldValue.serverTimestamp",new cn(e)}static delete(){const e=function AI(){return new ai("deleteField")}();return e._methodName="FieldValue.delete",new cn(e)}static arrayUnion(...e){const t=function wI(...n){return new al("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new cn(t)}static arrayRemove(...e){const t=function VI(...n){return new ul("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new cn(t)}static increment(e){const t=function CI(n){return new ll("increment",n)}(e);return t._methodName="FieldValue.increment",new cn(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const LI={Firestore:Zm,GeoPoint:Ls,Timestamp:X,Blob:mi,Transaction:Ym,WriteBatch:Jm,DocumentReference:Be,DocumentSnapshot:gi,Query:Pe,QueryDocumentSnapshot:pi,QuerySnapshot:Al,CollectionReference:nr,FieldPath:wl,FieldValue:cn,setLogLevel:function kI(n){!function E_(n){pt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};function tg(n,e){return function qI(n,e=RI.z){return new jm.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}(n,e)}function Vl(n,e){return tg(n,e).pipe((0,ze.U)(t=>({payload:t,type:"query"})))}!function UI(n){(function BI(n,e){n.INTERNAL.registerComponent(new Zl.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},LI)))})(n,(e,t)=>new Zm(e,t,new FI)),n.registerVersion("@firebase/firestore-compat","0.3.30")}(xI.Z),U(7142);class ng{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=og(r,t);return new sg(i,s,this.afs)}snapshotChanges(){return function GI(n,e){return tg(n,e).pipe((0,yl.O)(void 0),vl(),(0,ze.U)(t=>{const[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Oe.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,ze.U)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,fi.D)(this.ref.get(e)).pipe(Oe.iC)}}function Ys(n,e){return Vl(n,e).pipe((0,yl.O)(void 0),vl(),(0,ze.U)(t=>{const[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{const l=s.find(d=>d.doc.ref.isEqual(a.ref)),c=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));l&&JSON.stringify(l.doc.metadata)===JSON.stringify(a.metadata)||!l&&c&&JSON.stringify(c.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function rg(n,e,t){return Ys(n,t).pipe((0,El.R)((r,i)=>function zI(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function jI(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Cl(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Cl(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Cl(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,DI.x)(),(0,ze.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function Cl(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function ig(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class sg{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Ys(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,ze.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,yl.O)(void 0),vl(),(0,Qm.h)(([r,i])=>i.length>0||!r),(0,ze.U)(([,r])=>r),Oe.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,El.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=ig(e);return rg(this.query,t,this.afs.schedulers.outsideAngular).pipe(Oe.iC)}valueChanges(e={}){return Vl(this.query,this.afs.schedulers.outsideAngular).pipe((0,ze.U)(t=>t.payload.docs.map(r=>e.idField?{...r.data(),[e.idField]:r.id}:r.data())),Oe.iC)}get(e){return(0,fi.D)(this.query.get(e)).pipe(Oe.iC)}add(e){return this.ref.add(e)}doc(e){return new ng(this.ref.doc(e),this.afs)}}class $I{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Ys(this.query,this.afs.schedulers.outsideAngular).pipe((0,ze.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,Qm.h)(t=>t.length>0),Oe.iC):Ys(this.query,this.afs.schedulers.outsideAngular).pipe(Oe.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,El.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=ig(e);return rg(this.query,t,this.afs.schedulers.outsideAngular).pipe(Oe.iC)}valueChanges(e={}){return Vl(this.query,this.afs.schedulers.outsideAngular).pipe((0,ze.U)(r=>r.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),Oe.iC)}get(e){return(0,fi.D)(this.query.get(e)).pipe(Oe.iC)}}const KI=new h.OlP("angularfire2.enableFirestorePersistence"),QI=new h.OlP("angularfire2.firestore.persistenceSettings"),WI=new h.OlP("angularfire2.firestore.settings"),HI=new h.OlP("angularfire2.firestore.use-emulator");function og(n,e=(t=>t)){return{query:e(n),ref:n}}let ZI=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,u,l,c,d,f,g,E,T,I,D,N){this.schedulers=u;const R=(0,Hs.on)(t,a,r),M=c;d&&(0,ft.nw)(R,a,f,E,T,I,g,D),[this.firestore,this.persistenceEnabled$]=(0,Hs.cc)(`${R.name}.firestore`,"AngularFirestore",R.name,()=>{const q=a.runOutsideAngular(()=>R.firestore());if(s&&q.settings(s),M&&q.useEmulator(...M),i&&!(0,sr.PM)(o)){const z=()=>{try{return(0,fi.D)(q.enablePersistence(l||void 0).then(()=>!0,()=>!1))}catch(oe){return typeof console<"u"&&console.warn(oe),(0,$m.of)(!1)}};return[q,a.runOutsideAngular(z)]}return[q,(0,$m.of)(!1)]},[s,M,i])}collection(t,r){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:o}=og(i,r),a=this.schedulers.ngZone.run(()=>s);return new sg(a,o,this)}collectionGroup(t,r){const i=r||(o=>o),s=this.firestore.collectionGroup(t);return new $I(i(s),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>r);return new ng(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(h.LFG(Hs.Dh),h.LFG(Hs.xv,8),h.LFG(KI,8),h.LFG(WI,8),h.LFG(h.Lbi),h.LFG(h.R0b),h.LFG(Oe.HU),h.LFG(QI,8),h.LFG(HI,8),h.LFG(ft.zQ,8),h.LFG(ft.Qv,8),h.LFG(ft.L6,8),h.LFG(ft._Q,8),h.LFG(ft.rT,8),h.LFG(ft.lh,8),h.LFG(ft.f7,8),h.LFG(Oe.Rf,8))};static \u0275prov=h.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Sl=(()=>{class n{constructor(t,r){this.afAuth=t,this.afs=r,this.userData=new dp.x,this.afAuth.authState.subscribe(i=>{i?(this.userData.next(i),localStorage.setItem("user",JSON.stringify(i))):(this.userData.next(null),localStorage.removeItem("user"))})}login(t,r){var i=this;return(0,_.Z)(function*(){return yield i.afAuth.signInWithEmailAndPassword(t,r)})()}register(t){return this.afAuth.createUserWithEmailAndPassword(t.email,t.password).then(r=>{this.setUserData(r.user,t.name)})}setUserData(t,r){const i=this.afs.doc(`users/${t.uid}`),s={uid:t.uid,email:t.email,displayName:r||"",photoURL:t.photoURL,emailVerified:t.emailVerified,createAt:Um()};return i.set(s,{merge:!0})}signOut(){this.afAuth.signOut().then(t=>{localStorage.removeItem("user")})}get isLoogedIn(){return null!==JSON.parse(localStorage.getItem("user"))}get loggedInUserId(){const t=localStorage.getItem("user");return t?JSON.parse(t).uid:""}static#e=this.\u0275fac=function(r){return new(r||n)(h.LFG(ft.zQ),h.LFG(ZI))};static#t=this.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function YI(n,e){if(1&n&&(h.TgZ(0,"div")(1,"p"),h._uU(2),h.qZA(),h.TgZ(3,"p"),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._uU(6),h.qZA()()),2&n){const t=h.oxw();h.xp6(2),h.hij("Usuario: ",t.user.username,""),h.xp6(2),h.hij("Email: ",t.user.email,""),h.xp6(2),h.hij("Numero de afiliado: ",t.user.uid,"")}}let JI=(()=>{class n{constructor(t){this.authService=t}ngOnInit(){this.authService.userData.subscribe(t=>{this.user=t})}static#e=this.\u0275fac=function(r){return new(r||n)(h.Y36(Sl))};static#t=this.\u0275cmp=h.Xpm({type:n,selectors:[["app-layout"]],decls:8,vars:1,consts:[["routerLink","login"],["routerLink","register"],[4,"ngIf"]],template:function(r,i){1&r&&(h.TgZ(0,"p"),h._uU(1,"layout works!"),h.qZA(),h.TgZ(2,"div")(3,"button",0),h._uU(4,"Login"),h.qZA(),h.TgZ(5,"button",1),h._uU(6,"Register"),h.qZA()(),h.YNc(7,YI,7,3,"div",2)),2&r&&(h.xp6(7),h.Q6J("ngIf",i.user))},dependencies:[sr.O5,Vi.rH]})}return n})();var XI=U(7453),eT=U(4829),tT=U(4564),nT=U(7400),rT=U(2714);let ag=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static#e=this.\u0275fac=function(r){return new(r||n)(h.Y36(h.Qsj),h.Y36(h.SBq))};static#t=this.\u0275dir=h.lG2({type:n})}return n})(),hn=(()=>{class n extends ag{static#e=this.\u0275fac=function(){let t;return function(i){return(t||(t=h.n5z(n)))(i||n)}}();static#t=this.\u0275dir=h.lG2({type:n,features:[h.qOj]})}return n})();const tt=new h.OlP("NgValueAccessor"),oT={provide:tt,useExisting:(0,h.Gpc)(()=>_i),multi:!0},uT=new h.OlP("CompositionEventMode");let _i=(()=>{class n extends ag{constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function aT(){const n=(0,sr.q)()?(0,sr.q)().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static#e=this.\u0275fac=function(r){return new(r||n)(h.Y36(h.Qsj),h.Y36(h.SBq),h.Y36(uT,8))};static#t=this.\u0275dir=h.lG2({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){1&r&&h.NdJ("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[h._Bn([oT]),h.qOj]})}return n})();function Ft(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function lg(n){return null!=n&&"number"==typeof n.length}const Ve=new h.OlP("NgValidators"),kt=new h.OlP("NgAsyncValidators"),lT=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Ot{static min(e){return function cg(n){return e=>{if(Ft(e.value)||Ft(n))return null;const t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}(e)}static max(e){return function hg(n){return e=>{if(Ft(e.value)||Ft(n))return null;const t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}(e)}static required(e){return function dg(n){return Ft(n.value)?{required:!0}:null}(e)}static requiredTrue(e){return function fg(n){return!0===n.value?null:{required:!0}}(e)}static email(e){return function mg(n){return Ft(n.value)||lT.test(n.value)?null:{email:!0}}(e)}static minLength(e){return function gg(n){return e=>Ft(e.value)||!lg(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}(e)}static maxLength(e){return function pg(n){return e=>lg(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}(e)}static pattern(e){return function _g(n){if(!n)return Js;let e,t;return"string"==typeof n?(t="","^"!==n.charAt(0)&&(t+="^"),t+=n,"$"!==n.charAt(n.length-1)&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(Ft(r.value))return null;const i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}(e)}static nullValidator(e){return null}static compose(e){return Ag(e)}static composeAsync(e){return wg(e)}}function Js(n){return null}function yg(n){return null!=n}function vg(n){return(0,h.QGY)(n)?(0,fi.D)(n):n}function Eg(n){let e={};return n.forEach(t=>{e=null!=t?{...e,...t}:e}),0===Object.keys(e).length?null:e}function Ig(n,e){return e.map(t=>t(n))}function Tg(n){return n.map(e=>function cT(n){return!n.validate}(e)?e:t=>e.validate(t))}function Ag(n){if(!n)return null;const e=n.filter(yg);return 0==e.length?null:function(t){return Eg(Ig(t,e))}}function Rl(n){return null!=n?Ag(Tg(n)):null}function wg(n){if(!n)return null;const e=n.filter(yg);return 0==e.length?null:function(t){return function iT(...n){const e=(0,tT.jO)(n),{args:t,keys:r}=(0,XI.D)(n),i=new jm.y(s=>{const{length:o}=t;if(!o)return void s.complete();const a=new Array(o);let u=o,l=o;for(let c=0;c<o;c++){let d=!1;(0,eT.Xf)(t[c]).subscribe((0,Km.x)(s,f=>{d||(d=!0,l--),a[c]=f},()=>u--,void 0,()=>{(!u||!d)&&(l||s.next(r?(0,rT.n)(r,a):a),s.complete())}))}});return e?i.pipe((0,nT.Z)(e)):i}(Ig(t,e).map(vg)).pipe((0,ze.U)(Eg))}}function Pl(n){return null!=n?wg(Tg(n)):null}function Vg(n,e){return null===n?[e]:Array.isArray(n)?[...n,e]:[n,e]}function Cg(n){return n._rawValidators}function Sg(n){return n._rawAsyncValidators}function Dl(n){return n?Array.isArray(n)?n:[n]:[]}function Xs(n,e){return Array.isArray(n)?n.includes(e):n===e}function Rg(n,e){const t=Dl(e);return Dl(n).forEach(i=>{Xs(t,i)||t.push(i)}),t}function Pg(n,e){return Dl(e).filter(t=>!Xs(n,t))}class Dg{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Rl(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Pl(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}class De extends Dg{get formDirective(){return null}get path(){return null}}class Lt extends Dg{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class xg{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let xl=(()=>{class n extends xg{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||n)(h.Y36(Lt,2))};static#t=this.\u0275dir=h.lG2({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){2&r&&h.ekj("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[h.qOj]})}return n})(),bl=(()=>{class n extends xg{constructor(t){super(t)}static#e=this.\u0275fac=function(r){return new(r||n)(h.Y36(De,10))};static#t=this.\u0275dir=h.lG2({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){2&r&&h.ekj("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[h.qOj]})}return n})();const yi="VALID",to="INVALID",rr="PENDING",vi="DISABLED";function Fl(n){return(no(n)?n.validators:n)||null}function kl(n,e){return(no(e)?e.asyncValidators:n)||null}function no(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}function Ng(n,e,t){const r=n.controls;if(!(e?Object.keys(r):r).length)throw new h.vHH(1e3,"");if(!r[t])throw new h.vHH(1001,"")}function Mg(n,e,t){n._forEachChild((r,i)=>{if(void 0===t[i])throw new h.vHH(1002,"")})}class ro{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===yi}get invalid(){return this.status===to}get pending(){return this.status==rr}get disabled(){return this.status===vi}get enabled(){return this.status!==vi}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(Rg(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Rg(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(Pg(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(Pg(e,this._rawAsyncValidators))}hasValidator(e){return Xs(this._rawValidators,e)}hasAsyncValidator(e){return Xs(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=rr,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=vi,this.errors=null,this._forEachChild(r=>{r.disable({...e,onlySelf:!0})}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...e,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=yi,this._forEachChild(r=>{r.enable({...e,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors({...e,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===yi||this.status===rr)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?vi:yi}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=rr,this._hasOwnPendingAsyncValidator=!0;const t=vg(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){let t=e;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new h.vpe,this.statusChanges=new h.vpe}_calculateStatus(){return this._allControlsDisabled()?vi:this.errors?to:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(rr)?rr:this._anyControlsHaveStatus(to)?to:yi}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){no(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=function mT(n){return Array.isArray(n)?Rl(n):n||null}(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=function gT(n){return Array.isArray(n)?Pl(n):n||null}(this._rawAsyncValidators)}}class Ei extends ro{constructor(e,t,r){super(Fl(t),kl(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){Mg(this,0,e),Object.keys(e).forEach(r=>{Ng(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(r=>{const i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}}class Fg extends Ei{}const ir=new h.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>io}),io="always";function Ii(n,e,t=io){Ol(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||"always"===t)&&e.valueAccessor.setDisabledState?.(n.disabled),function _T(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&kg(n,e)})}(n,e),function vT(n,e){const t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}(n,e),function yT(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&kg(n,e),"submit"!==n.updateOn&&n.markAsTouched()})}(n,e),function pT(n,e){if(e.valueAccessor.setDisabledState){const t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}(n,e)}function oo(n,e,t=!0){const r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),uo(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function ao(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function Ol(n,e){const t=Cg(n);null!==e.validator?n.setValidators(Vg(t,e.validator)):"function"==typeof t&&n.setValidators([t]);const r=Sg(n);null!==e.asyncValidator?n.setAsyncValidators(Vg(r,e.asyncValidator)):"function"==typeof r&&n.setAsyncValidators([r]);const i=()=>n.updateValueAndValidity();ao(e._rawValidators,i),ao(e._rawAsyncValidators,i)}function uo(n,e){let t=!1;if(null!==n){if(null!==e.validator){const i=Cg(n);if(Array.isArray(i)&&i.length>0){const s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(null!==e.asyncValidator){const i=Sg(n);if(Array.isArray(i)&&i.length>0){const s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}const r=()=>{};return ao(e._rawValidators,r),ao(e._rawAsyncValidators,r),t}function kg(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Bg(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}function Ug(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const Ai=class extends ro{constructor(e=null,t,r){super(Fl(t),kl(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),no(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=Ug(e)?e.value:e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Bg(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Bg(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){Ug(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};let Gl=(()=>{class n{static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275dir=h.lG2({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return n})(),Kg=(()=>{class n{static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275mod=h.oAB({type:n});static#n=this.\u0275inj=h.cJS({})}return n})();const zl=new h.OlP("NgModelWithFormControlWarning"),NT={provide:De,useExisting:(0,h.Gpc)(()=>wi)};let wi=(()=>{class n extends De{constructor(t,r,i){super(),this.callSetDisabledState=i,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new h.vpe,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(uo(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const r=this.form.get(t.path);return Ii(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){oo(t.control||null,t,!1),function AT(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this.submitted=!0,function Lg(n,e){n._syncPendingControls(),e.forEach(t=>{const r=t.control;"submit"===r.updateOn&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const r=t.control,i=this.form.get(t.path);r!==i&&(oo(r||null,t),(n=>n instanceof Ai)(i)&&(Ii(i,t,this.callSetDisabledState),t.control=i))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const r=this.form.get(t.path);(function Og(n,e){Ol(n,e)})(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const r=this.form.get(t.path);r&&function ET(n,e){return uo(n,e)}(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Ol(this.form,this),this._oldForm&&uo(this._oldForm,this)}_checkFormPresent(){}static#e=this.\u0275fac=function(r){return new(r||n)(h.Y36(Ve,10),h.Y36(kt,10),h.Y36(ir,8))};static#t=this.\u0275dir=h.lG2({type:n,selectors:[["","formGroup",""]],hostBindings:function(r,i){1&r&&h.NdJ("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[h._Bn([NT]),h.qOj,h.TTD]})}return n})();const kT={provide:Lt,useExisting:(0,h.Gpc)(()=>lo)};let lo=(()=>{class n extends Lt{set isDisabled(t){}static#e=this._ngModelWarningSentOnce=!1;constructor(t,r,i,s,o){super(),this._ngModelWarningConfig=o,this._added=!1,this.name=null,this.update=new h.vpe,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=function Ul(n,e){if(!e)return null;let t,r,i;return Array.isArray(e),e.forEach(s=>{s.constructor===_i?t=s:function TT(n){return Object.getPrototypeOf(n.constructor)===hn}(s)?r=s:i=s}),i||r||t||null}(0,s)}ngOnChanges(t){this._added||this._setUpControl(),function Bl(n,e){if(!n.hasOwnProperty("model"))return!1;const t=n.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function so(n,e){return[...e.path,n]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static#t=this.\u0275fac=function(r){return new(r||n)(h.Y36(De,13),h.Y36(Ve,10),h.Y36(kt,10),h.Y36(tt,10),h.Y36(zl,8))};static#n=this.\u0275dir=h.lG2({type:n,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[h._Bn([kT]),h.qOj,h.TTD]})}return n})(),YT=(()=>{class n{static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275mod=h.oAB({type:n});static#n=this.\u0275inj=h.cJS({imports:[Kg]})}return n})();class up extends ro{constructor(e,t,r){super(Fl(t),kl(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){Mg(this,0,e),e.forEach((r,i)=>{Ng(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>!!r._syncPendingControls()||t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}}function lp(n){return!!n&&(void 0!==n.asyncValidators||void 0!==n.validators||void 0!==n.updateOn)}let cp=(()=>{class n{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new n;return t.useNonNullable=!0,t}group(t,r=null){const i=this._reduceControls(t);let s={};return lp(r)?s=r:null!==r&&(s.validators=r.validator,s.asyncValidators=r.asyncValidator),new Ei(i,s)}record(t,r=null){const i=this._reduceControls(t);return new Fg(i,r)}control(t,r,i){let s={};return this.useNonNullable?(lp(r)?s=r:(s.validators=r,s.asyncValidators=i),new Ai(t,{...s,nonNullable:!0})):new Ai(t,r,i)}array(t,r,i){const s=t.map(o=>this._createControl(o));return new up(s,r,i)}_reduceControls(t){const r={};return Object.keys(t).forEach(i=>{r[i]=this._createControl(t[i])}),r}_createControl(t){return t instanceof Ai||t instanceof ro?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),JT=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:zl,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:ir,useValue:t.callSetDisabledState??io}]}}static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275mod=h.oAB({type:n});static#n=this.\u0275inj=h.cJS({imports:[YT]})}return n})();const XT=[{path:"",component:JI},{path:"login",component:(()=>{class n{constructor(t,r,i){this.fb=t,this.authService=r,this.router=i}ngOnInit(){this.loginForm=this.fb.group({email:["",[Ot.required,Ot.email]],password:["",[Ot.required]]})}handleSubmit(){if(this.loginForm.valid){const{email:t,password:r}=this.loginForm.value;this.authService.login(t,r).then(()=>{console.log("Usuario autenticado correctamente"),this.router.navigate(["/"])}).catch(i=>{console.error("Error al autenticar usuario:",i)})}else console.log("Formulario inv\xe1lido. Por favor, complete todos los campos correctamente.")}static#e=this.\u0275fac=function(r){return new(r||n)(h.Y36(cp),h.Y36(Sl),h.Y36(Vi.F0))};static#t=this.\u0275cmp=h.Xpm({type:n,selectors:[["app-login"]],decls:5,vars:1,consts:[[3,"formGroup","ngSubmit"],["type","text","placeholder","Email","formControlName","email"],["type","password","placeholder","Password","formControlName","password"],["type","submit"]],template:function(r,i){1&r&&(h.TgZ(0,"form",0),h.NdJ("ngSubmit",function(){return i.handleSubmit()}),h._UZ(1,"input",1)(2,"input",2),h.TgZ(3,"button",3),h._uU(4,"Sign In"),h.qZA()()),2&r&&h.Q6J("formGroup",i.loginForm)},dependencies:[Gl,_i,xl,bl,wi,lo]})}return n})()},{path:"register",component:(()=>{class n{constructor(t,r){this.fb=t,this.authService=r}ngOnInit(){this.registerForm=this.fb.group({email:["",[Ot.required,Ot.email]],password:["",[Ot.required,Ot.minLength(6)]],name:["",Ot.required]})}handleSubmit(){if(this.registerForm.valid){const{email:t,password:r,name:i}=this.registerForm.value;this.authService.register({email:t,password:r,name:i}).then(()=>{console.log("Usuario registrado exitosamente en Firebase")}).catch(s=>{console.error("Error al registrar usuario en Firebase:",s)})}else console.log("Formulario inv\xe1lido. Por favor, complete todos los campos correctamente.")}static#e=this.\u0275fac=function(r){return new(r||n)(h.Y36(cp),h.Y36(Sl))};static#t=this.\u0275cmp=h.Xpm({type:n,selectors:[["app-register"]],decls:6,vars:1,consts:[[3,"formGroup","ngSubmit"],["type","text","placeholder","Email","formControlName","email"],["type","text","placeholder","Name","formControlName","name"],["type","password","placeholder","Password","formControlName","password"],["type","submit"]],template:function(r,i){1&r&&(h.TgZ(0,"form",0),h.NdJ("ngSubmit",function(){return i.handleSubmit()}),h._UZ(1,"input",1)(2,"input",2)(3,"input",3),h.TgZ(4,"button",4),h._uU(5,"Sign Up"),h.qZA()()),2&r&&h.Q6J("formGroup",i.registerForm)},dependencies:[Gl,_i,xl,bl,wi,lo]})}return n})()}];let eA=(()=>{class n{static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275mod=h.oAB({type:n});static#n=this.\u0275inj=h.cJS({imports:[Vi.Bz.forChild(XT),Vi.Bz]})}return n})(),tA=(()=>{class n{static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275mod=h.oAB({type:n});static#n=this.\u0275inj=h.cJS({imports:[sr.ez,eA,JT]})}return n})()}}]);